
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<title>Workbench</title>
 <link rel="shortcut icon" href="../shared/ico/favicon.ico" type="image/x-icon" /> 
<meta name="description" content="" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=3.0, user-scalable=yes" />
<meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
<meta http-equiv="Pragma" content="no-cache" />
<meta http-equiv="Expires" content="0" />


<!-- imported -->
		<!--basic styles-->

		<link href="../shared/ace/assets/css/bootstrap.min.css" rel="stylesheet" />
		<link href="../shared/ace/assets/css/bootstrap-responsive.min.css" rel="stylesheet" />
		<link rel="stylesheet" href="../shared/ace/assets/css/font-awesome.min.css" />

		<!--[if IE 7]>
		  <link rel="stylesheet" href="../shared/ace/assets/css/font-awesome-ie7.min.css" />
		<![endif]-->

		<!--page specific plugin styles-->

		<link rel="stylesheet" href="../shared/ace/assets/css/jquery-ui-1.10.3.custom.min.css" />
		<link rel="stylesheet" href="../shared/ace/assets/css/jquery.gritter.css" />
		
		
		<link rel="stylesheet" href="../shared/ace/assets/css/colorbox.css" />

		<!--fonts-->

		<link rel="stylesheet" href="../shared/ace/assets/css/ace-fonts.css" />

		<!--ace styles-->
        <link rel="stylesheet" href="../shared/ace/assets/css/chosen.css" />
		<link rel="stylesheet" href="../shared/ace/assets/css/uncompressed2/ace.css" />
		<link rel="stylesheet" href="../shared/ace/assets/css/ace-responsive.min.css" />
		<link rel="stylesheet" href="../shared/ace/assets/css/ace-skins.min.css" />
        <link rel="stylesheet" href="../shared/ace/assets/css/datepicker.css" />
        <link rel="stylesheet" href="../shared/ace/assets/css/jsPanel.css" />
        
    <!-- Add the slick-theme.css if you want default styling -->
    <link rel="stylesheet" type="text/css" href="../shared/slick/slick.css"/>
    <link rel="stylesheet" type="text/css" href="../shared/slick/slick-theme.css"/>



		<!--[if lte IE 8]>
		  <link rel="stylesheet" href="../shared/ace/assets/css/ace-ie.min.css" />
		<![endif]-->

		<!-- Vocareum styles -->
		
		<link rel="stylesheet" href="../main/vocareum.css" />
		<script src="../main/localStorage.js"></script>



<!-- js start -->
	<!-- jquery start -->
		<!--[if !IE]>-->
		<script type="text/javascript">
                  window.jQuery || document.write("<script src='../shared/ace/assets/js/jquery-2.0.3.min.js'>"+"<"+"/script>");
		</script>

		<!--<![endif]-->

		<!--[if IE]>
<script type="text/javascript">
 window.jQuery || document.write("<script src='../shared/ace/assets/js/jquery-1.10.2.min.js'>"+"<"+"/script>");
</script>
<![endif]-->
		<script type="text/javascript">
			if("ontouchend" in document) document.write("<script src='../shared/ace/assets/js/jquery.mobile.custom.min.js'>"+"<"+"/script>");
		</script>

		<script src="../shared/ace/assets/js/jquery-ui-1.10.3.custom.min.js"></script>
		<script src="../shared/ace/assets/js/jquery.ui.touch-punch.min.js"></script>
		<script src="../shared/ace/assets/js/jquery.easy-pie-chart.min.js"></script>
		<script src="../shared/ace/assets/js/fuelux/fuelux.wizard.min.js"></script>
		<script src="../shared/ace/assets/js/jquery.jspanel.js"></script>
	<!-- jquery end -->

<!-- js end -->

		<script src="../shared/ace/assets/js/bootstrap.min.js"></script>
		<script src="../shared/ace/assets/js/uncompressed2/ace.js"></script>
		<script src="../shared/ace/assets/js/ace-extra.min.js"></script>
		<script src="../shared/ace/assets/js/bootbox.min.js"></script>

		<script src="../shared/ace/assets/js/jquery.autosize-min.js"></script>
		<script src="../shared/ace/assets/js/chosen.jquery.min.js"></script>
        <script src="../shared/ace/assets/js/date-time/bootstrap-datepicker.min.js"></script>
        
        <script src="../shared/ace/assets/js/bootstrap-tag.min.js"></script>
		
        <script src="../shared/ace/assets/js/jquery-validation-1.11.1/jquery.validate.min.js"></script>
        <script src="../shared/ace/assets/js/jquery-validation-1.11.1/additional-methods.min.js"></script>
		<script src="../shared/ace/assets/js/jquery-tmpl/jquery.tmpl.min.js"></script>
        <script src="../shared/ace/assets/js/jquery.cookie.js"></script>

<style type="text/css">
  html,
  body {
	height: 100%;
	font-size: 95%;
	background-color: rgb(255,255,255)!important;
  }

  .vocbtn-round-corner {
	border-radius: 3px!important;
	margin: 0 5px 2px 0px !important;
  }

  #wrap {
	min-height: 100%;
	height: auto !important;
	height: 100%;
	/* Negative indent footer by it's height */
	margin: 0 auto -30px;
  }

  /* Set the fixed height of the footer here */
  #push,
  #footer {
	height: 30px;
  }
  #footer {
	background-color: #333;
	color: #ccc;
  }

  /* Lastly, apply responsive CSS fixes as necessary */
  @media (max-width: 767px) {
	#footer {
	  margin-left: -20px;
	  margin-right: -20px;
	  padding-left: 20px;
	  padding-right: 20px;
	}
  }
  
    /* one more CSS fixes as necessary */
  @media (max-width: 979px) {
	#page-content {
	}
  }
  

  /* Custom page CSS
  -------------------------------------------------- */
  /* Not required for template or sticky footer method. */

  #wrap > .container {
	padding-top: 60px;
  }
  .container .credit {
	margin: 20px 0;
  }

  code {
	font-size: 80%;
  }

.dropdown-menu > li > div:hover,
.dropdown-menu > li > div:focus {
  color: #ffffff;
  text-decoration: none;
  background-color: #0081c2;
  background-image: -moz-linear-gradient(top, #0088cc, #0077b3);
  background-image: -webkit-gradient(linear, 0 0, 0 100%, from(#0088cc), to(#0077b3));
  background-image: -webkit-linear-gradient(top, #0088cc, #0077b3);
  background-image: -o-linear-gradient(top, #0088cc, #0077b3);
  background-image: linear-gradient(to bottom, #0088cc, #0077b3);
  background-repeat: repeat-x;
  filter: progid:DXImageTransform.Microsoft.gradient(startColorstr='#ff0088cc', endColorstr='#ff0077b3', GradientType=0);
}

.dropdown-menu > li > div {
  display: block;
  padding: 3px 20px;
  clear: both;
  font-weight: normal;
  line-height: 20px;
  color: #333333;
  white-space: nowrap;
}

.ace-nav > li > div {
  position: relative;
  color: #EEE;
  display: block;
  height: 100%;
  padding: 0 8px !important;
  background-color: transparent;
}

.ace-nav > li > div > [class*="icon-"] {
  font-size: 16px;
  color: #EEE;
  display: inline-block;
  width: 20px;
  text-align: center;
}

.tree .tree-selected > [class*="icon-"]:first-child {
  color: 0 !important;
}

</style>

		<style>
			.spinner-preview {
				width:100px;
				height:100px;
				text-align:center;
				margin-top:60px;
			}

			.dropdown-preview {
				margin:0 5px;
				display:inline-block;
			}
			.dropdown-preview  > .dropdown-menu {
				display: block;
				position: static;
				margin-bottom: 5px;
			}
		</style>

<!-- style for accessibility -->
<style>

.btn-group > .btn,
.btn-group + .btn {
  margin: 0 1px 0 0;
  border-width: 1px !important;
}

/*
.alert {
  color: black;
}
*/

.alert-success {
  color: #155724 !important;
}

.alert-error, .alert-danger {
  color: #721c24 !important;
}

.alert-warning {
  color: #856404 !important;
}

.chosen-container-single .chosen-default {
  color: black;
}

.vocbtn-ac {
  border-radius: 3px!important;
  padding: 1px 12px!important;
  margin: 0 8px 5px 0px !important;
  min-width: 60px!important;
  line-height: 30px!important;
  border-width: 1px !important;
}

.vocbtn2 {
  border-radius: 3px!important;
  padding: 1px 8px!important;
  margin: 0 8px 5px 0px !important;
  margin: 0 0px 0 0px !important;
  min-width: 40px!important;
  line-height: 30px!important;
  border-width: 1px !important;
}

.vocbtn-action {
  background: none repeat scroll 0% 0% rgb(0, 109, 204)!important;
  border-color: rgb(0, 109, 204)!important;
}
.vocbtn-action:hover, .vocbtn-primary:focus {
  background: none repeat scroll 0% 0% rgb(0, 109, 204)!important;
  border-color: rgb(0, 109, 204)!important;
}

.vocbtn-status {
  background: #f5f5f5 !important;
  text-shadow: 0 0 0 !important;
  color: #2D3B45 !important;
  border: 1px solid !important;
  border-color: #C7CDD1 !important;
}

.vocbtn-status:hover, .vocbtn-default:focus {
  background: #C7CDD1 !important;
}

.table-header {
  background-color:#394B58 !important;
}

.tree .tree-item, .tree .tree-folder .tree-folder-header {
    color: black;
}

.voc-link, .breadcrumb li a {
  color: rgb(32, 57, 157);
}

.table thead tr {
  color: #000 !important;
}

.breadcrumb li, .breadcrumb li .divider {
  color: #000 !important;
}

</style>
</head>
<body>

<script type="text/javascript">
  function escapeHtml(unsafe) {
    return unsafe
         .replace(/&/g, "&amp;")
         .replace(/</g, "&lt;")
         .replace(/>/g, "&gt;")
         .replace(/"/g, "&quot;")
         .replace(/'/g, "&#039;");
   }


  
    /* for CSRF tokens */
    /* NOTE: ajaxPreFilter works better than the ajaxSetup where ajax happens when form.serialize is called */
    var csrfToken = "JPu2MF7MPbsPpHMAZIPBAg%3D%3D";
    $.ajaxPrefilter(function(options, originalData, xhr) {
      if (options.data) {
        if (options.data instanceof FormData) {
          //let the form send the vockey
        } else {
          try {
            pdata = JSON.parse(options.data);
            pdata['vockey'] = csrfToken;
            options.data = JSON.stringify(pdata);
          } catch (e) {
            options.data += "&vockey=" + csrfToken;
          }
        }
      } else {
        options.data = "vockey=" + csrfToken;
      }
    });

    /*
    $('form').submit(function(){
      $(this).append("<input type='hidden' name='vockey' value='"+csrfToken+"' />");
      return true;
    });
    $.ajaxSetup({
      data: {
          vockey: csrfToken
      }
    });
    */

    function refreshNewSessionPage() {
      var url = window.location.href;
      var msg = 'Redirected+to+newly+logged+in+session.+Please+retry+the+operation';
      if (url.indexOf('?') > -1){
         url += '&w=' + msg;
      } else {
         url += '?w=' + msg;
      }
      window.location.href = url;
    }
</script>

		<div class="clearfix">

					
<!-- moved to different functions -->
		


				
			<div id="page-content" class="clearfix" style="background-color:rgb(255,255,255);margin: 5px 10px 0px 10px;">
				<div class="row-fluid">
				




			



<script src="../shared/ace/assets/js/jquery.gritter.min.js"></script>



<!-- Displays Maintenance Banner on top of page -->

<!-- Function used to hide the Maintenance Banner -->
<script type="text/javascript">
  function closeMaintenanceBanner() {
    document.getElementById("maintenance-alert").classList.add('hidden-1');
        
  }
  
</script>


<!-- PAGE CONTENT BEGINS HERE -->
<!--  script type="text/javascript" src="https://www.google.com/jsapi"></script -->
<script type="text/javascript">

var vcUploadMaxSize = 104857600; // 100MB
var vcUploadChunkSize = 1048576; // 1MB
function vcUploadCheckMsg(status, msg)
{
   var progressFile = document.createElement('div');
   var meterFile = document.createElement('span');
   status.appendChild(progressFile);
   progressFile.appendChild(meterFile);
   meterFile.textContent = msg;
   return false;
}
function vcUploadCheckDone(status, buckets, cnt, args, endFP)
{
   buckets[0] = buckets[0] - cnt;
   if( buckets[0]<1 ){
     if( endFP ){
       var msg = endFP(args);
       if( msg && msg.length>0 ){
         vcUploadCheckMsg(status, 'NOTE: ' + msg);
       }
     }
     vcUploadCheckMsg(status, 'NOTE: All files were processed, you may close the window and proceed.');
   }
   return false;
}
function vcUploadFileCheckStatus(status, buckets, path, meterFile, fn, args, endFP)
{
  'use strict';
  var xhr = new XMLHttpRequest();
  xhr.open('GET', '../util/vcput.php?vockey=JPu2MF7MPbsPpHMAZIPBAg%3D%3D&a=checkUpload&fn=' + encodeURIComponent(fn) + '&path=' + encodeURIComponent(path) + args, true);
  xhr.onreadystatechange = function () {
    if (xhr.readyState!=4) return false;
    if (xhr.status!=200 || !xhr.responseText ){
      meterFile.textContent += ' failed';
      vcUploadCheckDone(status, buckets, 1, args, endFP)
      return false;
    }
    var arr = xhr.responseText.split('VOC::');
    if(arr.length != 3){
       meterFile.textContent += ' failed';
       vcUploadCheckDone(status, buckets, 1, args, endFP)
       return false;
    }
    meterFile.textContent += arr[1];
    if( arr[1] != '.' ) {
      if (typeof refreshFileTree !== 'undefined' && $.isFunction(refreshFileTree)){
        refreshFileTree(true, true);
      }
      vcUploadCheckDone(status, buckets, 1, args, endFP)
      return false;
    }
    //mhui
    if (typeof(appsIde) != 'undefined' && appsIde)
		{
    	meterFile.textContent += ' Done';
		  refreshS3HomeTree(0);
		  return false;
		}
    setTimeout(function(){ vcUploadFileCheckStatus(status, buckets, path, meterFile, fn, args, endFP);}, 
               1000);
    return false;
  }
  xhr.send();
  return false;
}
function vcUploadFile(status, path, meterFile, blobOrFile, fn, st, sz, file_size, args, buckets, endFP)
{
     'use strict';
     var successful = false;

     var xhr = new XMLHttpRequest();
     if(!path){
       // need a path to store the uploaded file.
       xhr.open('GET', '../util/vcput.php?vockey=JPu2MF7MPbsPpHMAZIPBAg%3D%3D&a=getPath&fn=' + encodeURIComponent(fn), true);
       xhr.onreadystatechange = function () {
         if (xhr.readyState!=4) return false;
         if (xhr.status!=200 || !xhr.responseText ){
            meterFile.textContent = '    ' + fn + ' : terminating due to failure to obtain file path in the server';
            vcUploadCheckDone(status, buckets, 1, args, endFP);
            return false;
         }
         var arr = xhr.responseText.split('VOC::');
         if(arr.length != 3){
            meterFile.textContent = '    ' + fn + ' : terminating due to failure to obtain unique file path in the server';
            vcUploadCheckDone(status, buckets, 1, args, endFP);
            return false;
         }
         path = arr[1];
         if( !path || path.length<1 ){
            meterFile.textContent = '    ' + fn + ' : terminating due to empty file path in the server';
            vcUploadCheckDone(status, buckets, 1, args, endFP);
            return false;
         }
         vcUploadFile(status, path, meterFile, blobOrFile, fn, st, sz, file_size, args, buckets, endFP);
         return false;
       }
       xhr.send();
       return false;
     }
         xhr.open('POST', '../util/vcput.php?vockey=JPu2MF7MPbsPpHMAZIPBAg%3D%3D&a=batchUpload&fn=' + encodeURIComponent(fn) + '&path=' + encodeURIComponent(path) + args, true);
     // report chunk progress
         xhr.upload.onprogress = function (e) {
             if (e.lengthComputable) {
                 var msz = file_size - st;
                 if( sz<msz ) msz = sz;
                 if( file_size>0 ){
                   meterFile.value = Math.round((( (e.loaded/e.total)*msz + st) / file_size) * 100);
                 } else {
                   meterFile.value = '100';
                 }
                 var val = parseFloat(meterFile.value);
                 if( val>=100 ){
                   meterFile.textContent = '    ' + fn + ' (' + file_size + ' bytes) : ' + val + '% uploaded. Processing ...';
                 } else {
                   meterFile.textContent = '    ' + fn + ' (' + file_size + ' bytes) : ' + val + '%';
                 }
             }
         };
     // upload stopped
        xhr.onloadend = function (e) {
           if( successful ){
             // next chunk, if any
             if( (st+sz)<file_size ){
               vcUploadFile(status, path, meterFile, blobOrFile, fn, st+sz, sz, file_size, args, buckets, endFP);
             } else {
               vcUploadFileCheckStatus(status, buckets, path, meterFile, fn, args, endFP);
             }
           } else {
             vcUploadCheckDone(status, buckets, 1, args, endFP);
             meterFile.textContent += ' failed';
           }
         };
     // upload chunk successful
         xhr.onload = function (e) {
           meterFile.textContent += '.';
           successful = true;
         };
     // report chunk error
         xhr.ontimeout = function (e) {
            meterFile.textContent += '... terminating due to timeout';
            successful = false;
         };
         xhr.onerror = function (e) {
            meterFile.textContent += '... terminating due to error in fetching file';
            successful = false;
         };
         xhr.onabort = function (e) {
            meterFile.textContent += '... terminating due to aborting event';
            successful = false;
         };
     // 
     // send this chunk fn[st, st+sz-1]    
     var data = new FormData();
         data.append("file", blobOrFile.slice(st, st+sz));
         xhr.overrideMimeType('application/octet-stream');
         xhr.setRequestHeader('Content-Range', 'bytes ' + st + '-' + (st+sz) + '/' + file_size);
         xhr.send(data);
         successful = true;
     // return value
     return false;
}
function vcUploadFiles(modalStr, divStatus, validateFP, inputFile, maxsz, args, endFP)
{
  'use strict';
  var status = document.getElementById(divStatus);
  var listFile = document.getElementById(inputFile);
  var buckets = [];
  var filesz = maxsz<=0? vcUploadMaxSize : (maxsz*1024*1024);
  var listener = function (e) {
     var self = e.currentTarget;
     // disable the listener right-away
     listFile.removeEventListener('change', listener, false);
     $('#' + modalStr).modal('show');
     status.innerHTML = ' Processing <b>' + self.files.length + '</b> file' + (self.files.length>1? 's' : '') + ':<br>';
     buckets = [ self.files.length ];
     for(var i=0; i<self.files.length; ++i){
       var blob = self.files[i];
       var progressFile = document.createElement('div');
       var meterFile = document.createElement('span');
       status.appendChild(progressFile);
       progressFile.appendChild(meterFile);
       if( !validateFP || validateFP(blob['name']) ){
         if( filesz < blob.size ){
           meterFile.textContent = '    ' + blob['name'] + ' : size (' + blob.size + ' bytes) exceeded the maximum file size (' + filesz + ')' +
                                   '. To increase the allowed size, please contact your TA or Vocareum for assistance.';
           --buckets[0];
         } else {
           vcUploadFile(status, false, meterFile, blob, blob['name'], 0, vcUploadChunkSize, blob.size, args, buckets, endFP);
         }
       } else {
         --buckets[0];
         meterFile.textContent = '    ' + blob['name'] + ' : skipped as it is not valid for this operation';
       }
     }
     status.scrollTop = status.scrollHeight;
     vcUploadCheckDone(status, buckets, 0, args, endFP);
   };

  listFile.addEventListener('change', listener, false);
  return listener;
}
</script>


<script>
     function showdbDetail(host,port,name,pwd){
       var target = document.getElementById("report_db_msg_box");
       target.innerHTML = "<strong>Host:</strong>" + host + '<br>' +
                          "<strong>Port:</strong>" + port + '<br>';
       if(name!='') target.innerHTML +=
                          "<strong>Name:</strong>" + name + '<br>';
        target.innerHTML += pwd;
       $("#modal-table-report-db").modal("show");
     }
	function show_voc_gritter($sticky, $msg, failed) {
		if (failed) {
			color_string = "gritter-error gritter-light";

		} else {
			color_string = "gritter-note gritter-light";
		}
		var duration = 2000;
		// if ($sticky) $duration = 10000;
		
		$.extend($.gritter.options, {
			position: 'bottom-right'
		});
		$.gritter.add({
			title: $msg,
			time: 2000,
			sticky: $sticky,
			class_name: color_string	
		});
	}

	function show_voc_gritter_duration($sticky, $msg, failed, duration) {
		if (failed) {
			color_string = "gritter-error gritter-light";

		} else {
			color_string = "gritter-note gritter-light";
		}
		$.extend($.gritter.options, {
			position: 'bottom-right'
		});
		$.gritter.add({
			title: $msg,
			time: duration,
			sticky: $sticky,
			class_name: color_string	
		});
	}

        var advance_features = "1";

        function show_grades(panel, fullwidth) {
            // mhui
            var jde = true;
            var rde = false;

            if (panel == 0)
            {
            	$('#grades-modal').modal('show');
            	return;
            }
            var element =  document.getElementById('gradeframe');
        	if (element == null || typeof(element) == 'undefined')
        	{
        		$('#grades-modal').modal('show');
        		return;
        	}

            // show the grade panel
            document.getElementById('gradeframe').style.display = "block";
            document.getElementById('gradeframedivider').style.display = "block";

            if (fullwidth) {
              document.getElementById('gradeframe').style.width = "100%";
              document.getElementById('gradeframe').style.height = "100vh";
              document.getElementById('gradeframedivider').style.display = "none";
              document.getElementById('gradeframehide').style.display = "none";
              document.getElementById('gradedetails').style.display = "block";
            }

            // mhui
            if (jde || rde) {
              $('#jupyterIframeParent').width(document.getElementById('gradeframedivider').offsetLeft-5);

           	  // hack to fix the grade panel height in jidebox
              $('#gradeframe').height($('#jidebox').height()-50);
              $('#gradeframedivider').height($('#jidebox').height()-50);
            }

              var gradesPanel = $('#grades-panel'),
                  gradesPanelIframe = gradesPanel.find('iframe'),
                  gradesSpinner = gradesPanel.find('#gradespinner');

              gradesSpinner.removeClass('hidden-1');
              var url = 'main.php?m=grades_review&modalMode=1&asnId=201916&stepid=201917&userid=1165740';
                              gradesPanelIframe.prop('src', url);

              gradesPanelIframe.on('load', function() {
                gradesSpinner.addClass('hidden-1');
              });
          }
</script>




<div class="breadcrumbs  hidden-1"  style="float: left; position: absolute; background-color:transparent; border-bottom:0px">
  <ul class="breadcrumb voctext" id="breadcrumb" style="margin-left: 12px !important;">
    <li>
      <span id="breadcrumb-user-link" class=" hidden-1"></span>
    </li>
    <li class="liprojbc">
      <span class="divider  hidden-1">/</span>
      <span id="breadcrumb-proj-link" class=" hidden-1"></span>
    </li> <!-- proj end -->
    <li id="breadcrumb-step-block" class="dropdown"> <!-- step start -->
      <span class="divider  hidden-1">/</span>
      <a data-toggle="dropdown" class="dropdown-toggle" href="#">
      <i class="icon-caret-down voc-link"></i>
      <span id="breadcrumb-step-name" class="voc-link"></span>
      </a>
      <ul id="breadcrumb-select-step" class="dropdown-menu dropdown-info  dropdown-navbar dropdown-yellow dropdown-caret dropdown-close" style="margin-left: 18px;" role="menu" aria-label="Assignment dropdown">
      </ul>
    </li>
    <li id="breadcrumb-vers-block" class="dropdown voc-link"> <!-- version selection -->
      <span class="divider  hidden-1">/</span>
      <a data-toggle="dropdown" class="dropdown-toggle" href="#">
      <i class="icon-caret-down voc-link"></i>
      <span id="breadcrumb-vers-name" class="voc-link"></span>
      </a>
      <ul id="breadcrumb-select-vers" class="dropdown-menu dropdown-info  dropdown-navbar dropdown-yellow dropdown-caret dropdown-close" style="margin-left: 18px;" role="menu">
      </ul>
    </li>
  </ul>
  <!-- TODO: cleanup -->
  <div class="pull-right" id="breadcrumb-step-status">
  </div>		
</div>

<script type="text/javascript">	
  var vocdomain = document.domain.split('.').slice(-2).join('.')
  document.domain = vocdomain;

  //mhui
  var clabsamis = [];

  function updateClusterAMIs()
  {
	  $('#clabstbl tr').each(function (i, row) {
          var myrow = $('#clabstbl tr:eq(' + i + ')');
          if (i > 0)
          {
              myrow.find('td:eq(7)').html('<select style="width:100px;margin-bottom:0px;" onchange="chgvm(' + i + ')">'+ $('#clabsamis').html()+'</select>');
              myrow.find('td:eq(7) select').val(clabsobj[i-1]['ami']);
          }
        });  
  }
  
  function retrieveOrgAMIs()
  {
    var orgid = 214;
    var labtype = "ct";

    var jqxhr = $.ajax('../util/vcput.php?a=getClusterAmisForOrg'
                     + '&orgid='  + orgid)
                 .done(function(data, textStatus, jqXHR) {
                   //console.log(data);
                   try {
             	     var result = JSON.parse(data);
                     if (result['status'] == 'Error') {
                       //alert("Unable to retrieve ami list: " + result['msg'])
                     }
                     else {
                       var foundSelected = false;
                       if (typeof(result['amis']) !== undefined)
                       {
                    	   clabsamis = result['amis']
                         var select = document.getElementById("clabsamis");
                         select.options.length = 0;
                         select.options[select.options.length] = new Option('', '');
                         for (index in clabsamis)
                         {
                           select.options[select.options.length] = new Option(clabsamis[index], index);
                           if (index == "")
                           {
                             //console.log("Index = " + index);
                             select.value = index;
                             foundSelected = true;
                           }
                         }              
                       }
                       if (foundSelected === false)
                       {
                         select.value = '';
                       }
                       if (labtype == 'cl') // update the AMI dropdowns
                       {
                         chgvmtype();
                         //updateClusterAMIs();
                       }
                     }
                   }
                   catch (err) {
                     //alert("Exception retrieving ami list: " + err)
                   }
                 })
                 .fail(function(data, textStatus, jqXHR) {
                   //alert("Error retrieving ami list");
                 });
  }


  function endawslabconfirmed(v) {
    }
  function endawslab(v) {
     }
  function awslabchkdone() {
     }
  function startawslab(v) {
     }
    function showawsact(v){
     }
  function showclabs(str){
     $('#detailspinbox').show();
     $.ajax({
        url: "../util/vcput.php?a=getclabs&stepid=201917&version=0&labworkdir=/mnt/data2/students/ccc_v1_w_NmY0_110384/asn201916_23/asn201917_1/work",
     })
     .done(function(ret_val) {
         var target = document.getElementById("report_clabs_msg_box");
         target.innerHTML = (str? str : '');
         try {
           resp = jQuery.parseJSON(ret_val);
           target.innerHTML += resp.message;
         } catch(err) {
           target.innerHTML += 'Failed to obtain lab status. If the problem persists, please report this problem to support@vocareum.com.';
         }
         //$('#modal-table-report-clabs').appendTo("#editordiv");
         $('#modal-table-report-clabs').modal('show');
         $('#detailspinbox').hide();
      })
     .fail(function(ret_val) {
       alert('failed to retrieve Labs credentials');
       $('#detailspinbox').hide();
     });
  }
  function cdbtime(resp)
  {
    if( (typeof resp['session_time'] != 'undefined') && resp['session_time'] ){
      awsstime = new Date().getTime();
      awsstime = Math.round( awsstime/1000 );
      awsscnt = resp['session_time'];
      if( awshandle ) clearTimeout(awshandle);
      awshandle = window.setTimeout(awscoundown , 300);
    }
  }
  function showcdbdetails(dbtype){
    str = false;
     $('#detailspinbox').show();
     $.ajax({
        url: "../util/vcput.php?a=getcdb&stepid=201917&version=0&labworkdir=/mnt/data2/students/ccc_v1_w_NmY0_110384/asn201916_23/asn201917_1/work&dbtype="+dbtype,
     })
     .done(function(ret_val) {
         var target = document.getElementById("report_cdb_msg_box");
         target.innerHTML = (str? str : '');
         try {
           resp = jQuery.parseJSON(ret_val);
           cdbtime(resp);
           target.innerHTML += resp.message;
         } catch(err) {
           target.innerHTML += 'Failed to obtain DB status. If the problem persists, please report this problem to support@vocareum.com.';
         }
         //$('#modal-table-report-cdb').appendTo("#editordiv");
         $('#modal-table-report-cdb').modal('show');
         $('#detailspinbox').hide();
      })
     .fail(function(ret_val) {
       alert('failed to retrieve DB credentials');
       $('#detailspinbox').hide();
     });
  }
  function launchclabs_confirmed(ischk)
  {
    if (true) {
      changeClabsState("Start", 'Starting', $('#labspinbox'), ischk);
    }
    else {
      launchclabs_confirmed_1(ischk);
    }
  }

  var clabshandle = false;
  function launchclabs_confirmed_1(ischk){
    if(clabshandle) clearTimeout(clabshandle);
    clabshandle = false;
    if( !ischk ) $('#labspinbox').show();

     $.ajax({
        url: "../util/vcput.php?a=" + (ischk? 'getclabs' : 'launchclabs') + "&stepid=201917&version=0&labworkdir=/mnt/data2/students/ccc_v1_w_NmY0_110384/asn201916_23/asn201917_1/work",
     })
     .done(function(ret_val) {
         if( !ischk && ret_val.indexOf('success')<0 ){
           var target = document.getElementById("report_clabs_msg_box");
           target.innerHTML = '<br>Failed to launch your lab. If the problem persists, please report to support@vocareum.com for assistance.';
           $('#modal-table-report-clabs').modal('show');
         } else if ( ischk && ret_val.indexOf('NotReady')>=0 ){
           clabshandle = setTimeout(function() { launchclabs_confirmed(1); }, 1000);
         } else if ( ischk && ret_val.indexOf('Ready')>=0 ){
           $('#labspinbox').hide();
           var target = document.getElementById("report_clabs_msg_box");
           target.innerHTML = '<br>Lab is ready';
         } else if ( ischk && (ret_val.indexOf('Terminated')>=0 || ret_val.indexOf('Stopped')>=0) ){
           $('#labspinbox').hide();
           var target = document.getElementById("report_clabs_msg_box");
           target.innerHTML = '<br>Please re-launch the lab through Start Lab.';
         } else {
           clabshandle = setTimeout(function() { launchclabs_confirmed(1); }, 1000);
         }
      })
     .fail(function(ret_val) {
       alert('failed to launch Lab');
       $('#labspinbox').hide();
     });
  }


  var clabsStateData = null;
  function showEmptyClabsStateModal()
  {
    $('#clabsStateModal_vms').hide();
    $('#clabsStateModal_body').hide();
    $('#clabsStateModal_ta').text('Retrieving lab information...');
    $('#clabsStateModal_ta').show();
    $("#clabsStateModal").css('height', 'auto');
    $('#clabsStateModal').modal();
  }

  function clabsStateModalSetMsg(msg)
  {
    $('#clabsStateModal_ta').text(msg);
    $('#clabsStateModal_ta').show();
    $("#clabsStateModal").css('height', 'auto');
    $('#clabsStateModal').modal();
  }

  function clabsStateModalSetFinalState(state, msg)
  {
    var status = "";

    vms = clabsStateData['vms'];
    for (var i = 0; i < vms.length; i++)
    {
      $('#clabs_modal_vm_' + i).hide();
      $('#clabs_modal_vm_spinner_' + i).hide();
      var vm = vms[i];
      var mc = vm['machine'];
      if (mc)
      {
        if (mc['state'] == "Failed")
        {
          if (mc['status'] != "")
          {
            status += "\n  " + mc['hostname'] + ': ' + mc['status'];
          }
        }
      }
    }

    clabsStateModalSetMsg(msg + status);
  }

  var clabsVmLastState = [];
  function buildAndShowClabsStateModal(clabs_data, start_state)
  {
    vms = clabs_data['vms'];

    data = '<table class="table table-first-column-check table-hover" style="margin-bottom:0px" border=1 frame=void rules=rows>';
    for (var i = 0; i < vms.length; i++)
    {
      vm = vms[i];
      data += '<tr id="vm_' + i + '" class="clabs-state-modal-tr-vm">';
      data += '<td class="clabs-state-modal-td-vm span4">';
      data += vm['name'];
      data += '</td>';
      data += '<td class="clabs-state-modal-td-state span4" id="clabs_modal_vm_state_' + i + '">';
      data += start_state + '&nbsp; <i id="clabs_modal_vm_spinner_' + i + '" class="icon-spin icon-spinner"></i>';
      data += '</td></tr>';
      clabsVmLastState.push(start_state);
    }
    data += '</table>';

    $('#clabsStateModal_body').show();
    $('#clabsStateModal_vms').html(data);
    $('#clabsStateModal_vms').show();
    $('#clabsStateModal_ta').hide();
    $("#clabsStateModal").css('height', 'auto');
    $('#clabsStateModal').modal();
  }

  var clabsChangeStateTimer = null;
  function changeClabsState(ctrl, printState, spinner, chkCounter)
  {
    clearTimeout(clabsChangeStateTimer);

    if (chkCounter == 0)
    {
      op = (ctrl == "Stop") ? 'endclabs' : 'launchclabs';
      $.ajax({
      url: "../util/vcput.php?a=" + op + "&stepid=201917&version=0&version=0&labworkdir=/mnt/data2/students/ccc_v1_w_NmY0_110384/asn201916_23/asn201917_1/work",
      })
      .done(function(ret_val) 
       {
         showEmptyClabsStateModal();
         console.log(ret_val);
         try 
         {
           var result = JSON.parse(ret_val);
           if (result['status'] != 'success')
           {
             clabsStateModalSetMsg('Failed to ' + ctrl + ' your lab. If the problem persists, please report to support@vocareum.com for assistance.');
             spinner.hide();
           }
           else 
           {
             clabsChangeStateTimer = setTimeout(changeClabsState, 100, ctrl, printState, spinner, 1);
           }
         }
         catch(err) 
         {
           clabsStateModalSetMsg('Exception changing state of lab1: ' + err);
           spinner.hide();
         }
       })
       .fail(function(data, textStatus, jqXHR)
       {
         clabsStateModalSetMsg("Failed to get lab1 information");
         spinner.hide();
       });
    }
    else
    {
      var jqxhr = $.ajax("../util/vcput.php?a=vcGetLabInfo&stepid=201917&version=0&labworkdir=/mnt/data2/students/ccc_v1_w_NmY0_110384/asn201916_23/asn201917_1/work")
        .done(function(data, textStatus, jqXHR)
        {
          try 
          {
            console.log(data);
            var result = JSON.parse(data);
            if (result['status'] == 'Error')
            {
              clabsStateModalSetMsg("Could not get lab information: " + result['msg']);
              spinner.hide();
            }
            else
            {
              clabsStateData = result;
              if (chkCounter == 1)
              {
                buildAndShowClabsStateModal(result, printState);
                clabsChangeStateTimer = setTimeout(changeClabsState, 1000, ctrl, printState, spinner, chkCounter + 1);
              }
              else
              {
                // check the state - if we've reached a good final state, all done
              
                state = result['lab_state'];
                status = result['lab_status']

                // let's first update all the vm individual states
                vms = result['vms'];
                for (var i = 0; i < vms.length; i++)
                {
                  vm = vms[i];
                  st = vm['state'];
                  if (st != clabsVmLastState[i])
                  {
                    var msg = st;
	            if (  (st != "Ready")
                       && (st != "Stopped")
                       && (st != "Terminated")
                       && (st != "Failed") )
                    {
                      msg += '&nbsp; <i id="clabs_modal_vm_spinner_' + i + '" class="icon-spin icon-spinner"></i>';
                    }
                    $('#clabs_modal_vm_state_' + i).html(msg);
                    clabsVmLastState[i] = st;
                  }
                }

                if (state == "Failed")
                {
                  msg = 'Failed to launch lab';
                  if (status != "")
                  {
                    msg += ": " + status;
                  }
                  clabsStateModalSetFinalState('Failed', msg);
                  spinner.hide();
                }
                else if (  (ctrl == "Stop")
                        && ( (state == "None")
                          || (state == "Stopped")
                          || (state == "Terminated") ) )
                {
                  // done!!
                  var print_state = state;
                  if (state == "None")
                  {
                    print_state = "Stopped";
                  }
                  clabsStateModalSetFinalState(state, 'Your lab is now ' + print_state);
                  spinner.hide();
                  awslabtimer(''); // end-timer
                }
                else if (ctrl == "Start")
                {
                  if (state == "Ready")
                  {
                    // done!!
                    cdbtime(result);
                    clabsStateModalSetFinalState(state, 'Your lab is now ' + state + '. The session time is ' + awsscnt + ' seconds (' + Math.ceil(awsscnt/60) + ' minutes)');
                    spinner.hide();
                  }
                  else if ( (state == "Stopped")
                         || (state == "Terminated") )
                  {
                    // something went wrong
                    msg = 'Please re-launch your lab';
                    if (status != "")
                    {
                      msg += ": " + status;
                    }
                    clabsStateModalSetFinalState(state, msg);
                    spinner.hide();
                  }
                  else
                  {
                    clabsChangeStateTimer = setTimeout(changeClabsState, 1000, ctrl, printState, spinner, chkCounter + 1);
                  }
                }
                else
                {
                  clabsChangeStateTimer = setTimeout(changeClabsState, 1000, ctrl, printState, spinner, chkCounter + 1);
                }
              }
            }
          }
          catch(err)
          {
            console.log("Exception: " + err);
            clabsStateModalSetMsg('Exception stopping lab2: ' + err);
            spinner.hide();
          }
        })
        .fail(function(data, textStatus, jqXHR)
        {
          clabsStateModalSetMsg("Failed to get lab2 information");
          spinner.hide();
        });
    }
  }

  function endclabs_confirmed(ischk)
  {
    if (true) {
      changeClabsState("Stop", 'Shutting down', $('#endclabspinbox'), ischk);
    }
    else {
      endclabs_confirmed_1(ischk);
    }
  }

  var endclabshandle = null;
  function endclabs_confirmed_1(ischk) {
    clearTimeout(endclabshandle);
    if (! ischk) $('#endclabspinbox').show();

    $.ajax({
      url: "../util/vcput.php?a=" + (ischk? 'stateclabs' : 'endclabs') + "&stepid=201917&version=0&labworkdir=/mnt/data2/students/ccc_v1_w_NmY0_110384/asn201916_23/asn201917_1/work",
    })
     .done(function(ret_val) {
       console.log(ret_val);
       try {
         var result = JSON.parse(ret_val);
         if (!ischk) {
           if (result['status'] != 'success') {
             $('#endclabspinbox').hide();
             var target = document.getElementById("report_clabs_msg_box");
             target.innerHTML = '<br>Failed to end your lab. If the problem persists, please report to support@vocareum.com for assistance.';
             $('#modal-table-report-clabs').modal('show');
           }
           else {
             clabshandle = setTimeout(function() { endclabs_confirmed(1); }, 1000);
           }
         } else {
           if (   (result['state'] == "None")
               || (result['state'] == "Stopped")
               || (result['state'] == "Terminated") ) {
             $('#endclabspinbox').hide();
             var target = document.getElementById("report_clabs_msg_box");
             target.innerHTML = '<br>Your lab has been stopped.';
             $('#modal-table-report-clabs').modal('show');
             awslabtimer(''); // end-timer
           } else {
             clabshandle = setTimeout(function() { endclabs_confirmed(1); }, 1000);
           }
         }
       }
       catch(err) {
         $('#endclabspinbox').hide();
         var target = document.getElementById("report_clabs_msg_box");
         target.innerHTML = '<br>Exception stopping lab: ' + err;
         $('#modal-table-report-clabs').modal('show');
       }
     })
     .fail(function(ret_val) {
       $('#endclabspinbox').hide();
       var target = document.getElementById("report_clabs_msg_box");
       target.innerHTML = '<br>Failed to end Lab.';
       $('#modal-table-report-clabs').modal('show');
     });
  }

  function endclabs_question(str){
    bootbox.dialog(str,
         [
           {
             "label" : "Yes",
             "class" : "btn vocbtn-ac vocbtn-action",
             "callback": function() {
               endclabs_confirmed(0);
             }
           },
           {
             "label" : "No",
             "class" : "btn vocbtn-ac vocbtn-status",
             "callback": function() {
               $('#endclabspinbox').hide();
             }
           }
         ]);
  }
  function endclabs_note(str){
    bootbox.dialog(str,
         [
           {
             "label" : "Close",
             "class" : "btn vocbtn-ac vocbtn-action",
             "callback": function() {
               $('#endclabspinbox').hide();
             }
           }
         ]);
  }
  function launchclabs_note(str){
    bootbox.dialog(str,
         [
           {
             "label" : "Close",
             "class" : "btn vocbtn-ac vocbtn-action",
             "callback": function() {
               $('#labspinbox').hide();
             }
           }
         ]);
  }
  function launchclabs_question(str){
    bootbox.dialog(str,
         [
           {
             "label" : "Yes",
             "class" : "btn vocbtn-ac vocbtn-action",
             "callback": function() {
               launchclabs_confirmed(0);
             }
           },
           {
             "label" : "No",
             "class" : "btn vocbtn-ac vocbtn-status",
             "callback": function() {
               $('#labspinbox').hide();
             }
           }
         ]);
  }
  function endclabs(){
    $('#endclabspinbox').show();
    $.ajax({
        url: "../util/vcput.php?a=getclabs&stepid=201917&version=0&labworkdir=/mnt/data2/students/ccc_v1_w_NmY0_110384/asn201916_23/asn201917_1/work",
     })
     .done(function(ret_val) {
         var resp;
         var target = document.getElementById("report_clabs_msg_box");
         try {
           resp = jQuery.parseJSON(ret_val);
           if( resp.status=='Ready' || resp.status=='stopped' ){
             endclabs_question('Are you sure you want to end the following? <br><br>' + resp.message + '<br>');
           } else {
             endclabs_note('Your lab has not started yet.');
           }
         } catch(err) {
           endclabs_note('Your lab has not started yet.');
         }
      })
     .fail(function(ret_val) {
       alert('failed to retrieve Labs credentials, report this problem to support@vocareum.com if the problem persists.');
       $('#labspinbox').hide();
     });
  }
  function launchclabs(){
    $('#labspinbox').show();
    $.ajax({
        url: "../util/vcput.php?a=getclabs&stepid=201917&version=0&labworkdir=/mnt/data2/students/ccc_v1_w_NmY0_110384/asn201916_23/asn201917_1/work",
     })
     .done(function(ret_val) {
         var resp;
         var target = document.getElementById("report_clabs_msg_box");
         try {
           resp = jQuery.parseJSON(ret_val);
           if( resp.status=='Ready' ){
             if (true) {
               launchclabs_confirmed(0);
             } else {
               launchclabs_question('Are you sure you want to launch a new lab? When you launch a new lab, the earlier one shown below will be terminated and its content will be deleted completely.<br><br>' + resp.message + '<br>');
             }
           } else {
             launchclabs_confirmed(0);
           }
         } catch(err) {
           launchclabs_confirmed(0); 
         }
      })
     .fail(function(ret_val) {
       alert('failed to retrieve Labs credentials, report this problem to support@vocareum.com if the problem persists.');
       $('#labspinbox').hide();
     });
  }

  // set the cookie for the web stuff
  var str;
  if (true)
  {
    str = "domain_latestWebProxy" + "=" + "https://proxy.vocareum.com/hostip/172.31.20.230:5000/vocproxy/1321432282116574011657402019170160512d70843755.93220026" + "; path=/" + "; domain=vocareum.com";
  }
  // else
  // {
  //   str = "domain_latestWebProxy" + "=" + "expired" + "; path=/; Expires=Thu, 01 Jan 1970 00:00:01 GMT" + "; domain=vocareum.com";
  // }
  document.cookie = str;
  
  function vocWebSocket() {
    // should we have our own class and wait for server connection?
    var url = "wss://services.vocareum.com";
    var ws = new WebSocket(url + "/xfer/" + "" + "/client");
    // var ws = new WebSocket("ws://jag.vocareum.com:8088/xfer/" + "" + "/client");
    return ws;
  }

  function vocWebSocketUrl() {
    var baseUrl = "wss://services.vocareum.com";
    var fullUrl = baseUrl + "/xfer/" + "" + "/client";
    return fullUrl;
  }

  function vocProxyShowErrMsg(msg) {
    bootbox.dialog(msg, 
                   [{
                     "label" : "Ok",
                     "class" : "btn vocbtn-ac vocbtn-action",
                    }]
    );
  }
  
  function vocProxyGetWsUrl() {
    url = "wss://proxy.vocareum.com/hostip/172.31.20.230:5000/vocproxy/1321432282116574011657402019170160512d70843755.93220026";
    console.log("Proxy URL: " + url);
    return url;
  }

  function vocProxyWebSocket() {
    if (false)
    {
      vocProxyShowErrMsg("Error: proxy setup failed.<br><br>If a page reload does not resolve it, please contact Vocareum Technical Support");
      return null;
    }
    var url = vocProxyGetWsUrl();
    var ws = new WebSocket(url);
    // Note: this error callback may be overridden by calling code
    //       in that case, it is up to that code to handle the error appropriately
    ws.onerror = function() {
      vocProxyShowErrMsg("Error: WebSocket connection closed due to error - is your WebSocket server running?<br><br>If it is running (and listening on the correct port) and a page reload does not resolve it, please contact Vocareum Technical Support");
    };
    return ws;
  }

  function vocProxyWebSocketUrl() {
    if (false)
    {
      vocProxyShowErrMsg("Error: proxy setup failed.<br><br>If a page reload does not resolve it, please contact Vocareum Technical Support");
      return null;
    }
    return vocProxyGetWsUrl();
  }

  function vocProxyWebUrl() {
    if (false)
    {
      vocProxyShowErrMsg("Error: proxy setup failed.<br><br>If a page reload does not resolve it, please contact Vocareum Technical Support");
      return null;
    }
    url = "https://proxy.vocareum.com/hostip/172.31.20.230:5000/vocproxy/1321432282116574011657402019170160512d70843755.93220026";
    console.log("Proxy URL: " + url);
    return url;
  }

  function vocCommShowErrMsg(msg) {
    vocProxyShowErrMsg(msg);
  }
  function vocCommGetWsUrl() {
    url = "wss://proxy.vocareum.com/hostip//voccomm/";
    console.log("Proxy URL: " + url);
    return url;
  }
  function vocCommWebSocket(type) {
    if (true)
    {
      vocCommShowErrMsg("Error: comm channel setup failed.<br><br>If a page reload does not resolve it, please contact Vocareum Technical Support");
      return null;
    }
    var url = vocCommGetWsUrl();
    var ws = new WebSocket(url + "/" + type + "?vocmsgs=1");
    // Note: this error callback may be overridden by calling code
    //       in that case, it is up to that code to handle the error appropriately
    ws.onerror = function() {
      vocCommShowErrMsg("Error: WebSocket connection closed due to error - if a page reload does not resolve it, please contact Vocareum Technical Support");
    };
    return ws;
  }
  function vocCommWebSocketUrl() {
    if (true)
    {
      vocCommShowErrMsg("Error: comm channel setup failed.<br><br>If a page reload does not resolve it, please contact Vocareum Technical Support");
      return null;
    }
    return vocCommGetWsUrl();
  }

  var imageBuildModalDotTimer;
  var checkImageBuildTimer;
  var vocBuildImages = null;
  var vocImageBuildNew = true;

  var lastImageName = "";
  var lastBaseImage = null;
  var lastDockerFile = "";

  var savedBuildAccessElements = document.createElement("div");
  var savedBuildAccessActualElement = document.createElement("div");

  function imageBuildClearAccessOptions(saveFirst)
  {
    // remove all .image-build-access - except the first one
    // remove the first .image-build-access-actual

    var currentAccessElements = document.getElementsByClassName("image-build-access");
    for (var i = currentAccessElements.length - 1; i > 0; i--)
    {
      if (saveFirst)
      {
        savedBuildAccessElements.appendChild(currentAccessElements[i]);
      }
      else
      {
        currentAccessElements[i].remove();
      }
    }

    var currentActualAccessElements = document.getElementsByClassName("image-build-access-actual");
    if (currentActualAccessElements.length > 0)
    {
      if (saveFirst)
      {
        savedBuildAccessActualElement.appendChild(currentActualAccessElements[0]);
      }
      else
      {
        currentActualAccessElements[0].remove();
      }
    }
  }

  function imageBuildRestoreAccessOptions()
  {
    if (savedBuildAccessActualElement.children.length > 0)
    {
      document.getElementById("image_build_access_0").appendChild(savedBuildAccessActualElement.firstChild);

      if (savedBuildAccessElements.children.length > 0)
      {
        var parent = document.getElementById("imageBuildModal_body");
        // remember - we stored the access elements in reverse order
        var currentAccessElements = savedBuildAccessElements.children;
        for (var i = currentAccessElements.length - 1; i >=0; i--)
        {
          parent.appendChild(currentAccessElements[i]);
        }
      }
    }
  }

  function getContainerImageFromNameId(name, val)
  {
    if ('vocareum' in vocBuildImages) {
      ib = vocBuildImages['vocareum'];
      for (var key in ib) {
        if (ib.hasOwnProperty(key)) {
          img = ib[key];
          if ((img.name == name) && (img.id == val))
          {
            return img;
          }
        }
      }
    }

    return false;
  }

  function imageBaseOptionSelected(target)
  {
    var name = target.options[target.selectedIndex].text;
    var value = target.options[target.selectedIndex].value;

    lastBaseImage = value;
    imageBuildClearAccessOptions(false);

    img = getContainerImageFromNameId(name, value);
    if (img.access)
    {
      try
      {
        var access = JSON.parse(img.access);
        for (var i = 0; i < access.length; i++)
        {
          var acc = access[i];
          var newIndx = addContainerImageAccess();
          document.getElementById("image_build_access_name_" + newIndx).value = acc.name;
          document.getElementById("image_build_access_port_" + newIndx).value = acc.port;
          document.getElementById("image_build_access_type_select_" + newIndx).value = acc.type;
        }
      }
      catch (err)
      {
        alert("Failed to parse access data: " + img.access)
      }
    }
  }

  function imageBuildOptionSelected(target)
  {
    console.log(target.value);

    var image_name = target.options[target.selectedIndex].text;

    if (image_name in vocBuildImages['course'])
    {
      // first remove all the existing "access" stuff
      // if (prevSelectionWasNew - vocImageBuildNew?) -> save it

      if (vocImageBuildNew)
      {
        // previous value was "new"
        imageBuildClearAccessOptions(true);
        lastImageName = document.getElementById('image_build_name').value; // id
        lastBaseImage = document.getElementById("imageBuildModal_select_baseimage").value; // id
        lastDockerFile = document.getElementById('image_build_dockerfile').value;
        vocImageBuildNew = false;
        
      }
      else
      {
        imageBuildClearAccessOptions(false);
      }  

      img = vocBuildImages['course'][image_name];
      
      $('#image_build_name').val(img.id);
      $('#image_build_name_div').hide();

      $('#image_build_dockerfile').val(img.dockerfile);
      document.getElementById("imageBuildModal_select_baseimage").value = img.baseimage_id;

      if (img.access)
      {
        try
        {
          var access = JSON.parse(img.access);
          for (var i = 0; i < access.length; i++)
          {
            var acc = access[i];
            var newIndx = addContainerImageAccess();
            document.getElementById("image_build_access_name_" + newIndx).value = acc.name;
            document.getElementById("image_build_access_port_" + newIndx).value = acc.port;
            document.getElementById("image_build_access_type_select_" + newIndx).value = acc.type;
          }
        }
        catch (err)
        {
          alert("Failed to parse access data: " + img.access)
        }
      }

      $('#imageBuildModal_ta').text("retrieving last build log...");
      $('#imageBuildModal_ta').show();
      getImageBuildLog(img.dockerfile, false);
    }
    else
    {
      vocImageBuildNew = true;
      $('#image_build_name_div').show();
      $('#image_build_name').val(lastImageName);
      $('#image_build_dockerfile').val(lastDockerFile);
      $("#imageBuildModal_select_baseimage").val(lastBaseImage);
      $('#imageBuildModal_ta').text("");
      $('#imageBuildModal_ta').hide();
      // for the access elements, first clear everthing and then add back if we've saved anything
      imageBuildClearAccessOptions(false);
      imageBuildRestoreAccessOptions();
    }
  }

  function isEmpty(obj) {
    for (var key in obj) {
      if (obj.hasOwnProperty(key)) {
        return false;
      }
      return true;
    }
  }
  function getImageBuildLog(dockerFile, scrollIt)
  {
    // can now build again
    $('#imageBuildModal_build').show();
    // also re-retrieve image list coz we probably added a new one - in that case scrollIt will be true
    if (scrollIt)
    {
      prepareBuildImageModal(true);
    }
    
    var target = document.getElementById('imageBuildModal_ta');
    var jqxhr = $.ajax('../util/vcput.php?a=checklab_nocfgchk'
                     + '&stepid=' + 201917                     + '&mode=' + 's'
                     + '&ownerid=' + 1165740                     + '&init=' + dockerFile)
                 .done(function(data, textStatus, jqXHR) {
                   // console.log(data);
                   try {
                     var result = JSON.parse(data);
                     if (result['status'] == 'not built') {
                       msg = 'Status: not built<br>Init file:' + dockerFile + '<br>' + result['message'];
                     } else if (result.status =='error'){
                       msg = 'Status: failed<br>' + 'Init file:' + dockerFile + '<br>' + 'Built at ' + result['time'] + '<br>' + result['message'];
                     } else if (result['status'] == 'building') {
                       msg = 'Status: in progress<br>' + 'Init file:' + dockerFile + '<br>' + 'Started at ' + result['time'] + '<br>' + result['message'];
                     } else if (result['status'] == 'success') {
                       msg = 'Status: completed<br>' + 'Init file:' + dockerFile + '<br>' + 'Built at ' + result['time'] + '<br>' + result['message']
                           + '<br>' + 'Status: completed<br>';
                     } else {
                       msg = 'Internal error, report this to support.vocareum.com<br>' + 'Init file: ' + dockerFile;
                     }
                     target.innerHTML = msg;
                     if (scrollIt) {
                       $("#imageBuildModal_ta").animate({
                         scrollTop:$("#imageBuildModal_ta")[0].scrollHeight - $("#imageBuildModal_ta").height()
                       },1000);
                     }
                   }
                   catch (err) {
                     var htm = target.innerHTML;
                     target.innerHTML = htm + '<br>' + 'Error: Exception retrieving image build log: ' + err;
                   }
                 })
                 .fail(function(data, textStatus, jqXHR) {
                   var htm = target.innerHTML;
                   target.innerHTML = htm + '<br>' + 'Error retrieving image build log';
                 });
  }

  function checkImageBuild(dockerFile)
  {
    var blds = [];
    blds.push(dockerFile);
    var jqxhr = $.ajax('../util/vcput.php?a=chkbld'
                     + '&stepid=' + 201917                     + '&mode=' + 's'
                     + '&ownerid=' + 1165740                     + '&files=' + JSON.stringify(blds))
                 .done(function(data, textStatus, jqXHR) {
                   console.log("CHK DONE");
                   try {
                     console.log(data);
                     var resultAll = JSON.parse(data);
                     var result = resultAll[0];
                     if (result['status'] == 'error') {
                       clearTimeout(imageBuildModalDotTimer);
                       $('#imageBuildModal_ta').text("Build Error");
                       getImageBuildLog(dockerFile, true);
                     }
                     else if (result['status'] == 'success') {
                       clearTimeout(imageBuildModalDotTimer);
                       $('#imageBuildModal_ta').text(result['status']);
                       getImageBuildLog(dockerFile, true);
                     }
                     else if (result['status'] != 'building') {
                       $('#imageBuildModal_ta').text(data); // should never really happen
                     }
                     else {
                       // building
                       checkImageBuildTimer = setTimeout(checkImageBuild, 3000, dockerFile);
                     }
                   }
                   catch (err) {
                     clearTimeout(imageBuildModalDotTimer);
                     $('#imageBuildModal_ta').text('Error: Exception retrieving image build status: ' + err);
                   }
                 })
                 .fail(function(data, textStatus, jqXHR) {
                   clearTimeout(imageBuildModalDotTimer);
                   $('#imageBuildModal_ta').text('Failure retrieving image build status');
                   console.log("CHK FAILED");
                 });
  }

  function imageBuildModalModalDots()
  {
    text = $('#imageBuildModal_ta').text();
    $('#imageBuildModal_ta').text(text + '.');
    imageBuildModalDotTimer = setTimeout(imageBuildModalModalDots, 1000);
  }

  var firsTimeShowingImageModal = true;

  function showBuildImageModal()
  {
    console.log(vocBuildImages);

    // setup the select
    // if image_name is set, we'll try to find it in this select - if found, set selected
    // otherwise select "create new image"
    var imageBuildName = $('#image_build_name').val();
    console.log("image build name: " + imageBuildName);
    var foundSelected = false;

    var data = '';
    data += '<select id="imageBuildModal_select" name="imageBuildModal_select" style="width:100%; margin-bottom:0px" onchange="imageBuildOptionSelected(this)" >';

    data += '<option value="0">Create new image</option>';

    // data += '<option selected disabled hidden>Select image</option>';

    // images built in this course
    if ('course' in vocBuildImages) {
      ic = vocBuildImages['course'];
      if (Object.keys(ic).length > 0) {
        data += '<optgroup label="Use existing image">';
        for (var key in ic) {
          if (ic.hasOwnProperty(key)) {
            img = ic[key];
            // console.log(img);
            if (imageBuildName == img.id) {
              data += '<option selected value=' + img.id + '>' + img.name + '</option>';
              foundSelected = img;
            } else {
              data += '<option value=' + img.id + '>' + img.name + '</option>';
            }
          }
        }
        data += '</optgroup>';
      }
    }

    $('#imageBuildModal_select_div').html(data);

    if (foundSelected)
    {
      // no need to show the name div
      $('#image_build_name_div').hide();
    }

    // select-base
    data = '';
    data += '<select id="imageBuildModal_select_baseimage" name="imageBuildModal_select_baseimage" style="width:100%; margin-bottom:0px"  onchange="imageBaseOptionSelected(this)">';
    var foundSelectedBaseImage = false;
    if ('vocareum' in vocBuildImages) {
      ib = vocBuildImages['vocareum'];
      for (var key in ib) {
        if (ib.hasOwnProperty(key)) {
          var dumpedIt = false;
          img = ib[key];
          if (foundSelected) { 
            if (foundSelected.baseimage_id == img.id) { 
              data += '<option selected value=' + img.id + '>' + img.name + '</option>';
              foundSelectedBaseImage = img;
              dumpedIt = true;
            }
          }
          else {
            if (lastBaseImage == img.id) { 
              data += '<option selected value=' + img.id + '>' + img.name + '</option>';
              foundSelectedBaseImage = img;
              dumpedIt = true;
            }
          }
          if (dumpedIt == false) {
            data += '<option value=' + img.id + '>' + img.name + '</option>';
          }
        }
      }
    }

    data += '</select>';

    $('#imageBuildModal_select_baseimage_div').html(data);

    if (foundSelectedBaseImage == false)
    {
      $("#imageBuildModal_select_baseimage").prop("selectedIndex", -1);
    }

    if (firsTimeShowingImageModal)
    {
      $('#imageBuildModal_ok').hide();
      $('#imageBuildModal_cancel').show();
    }
    else
    {
      // whatever is set is fine
    }
    $('#imageBuildModal_build').show();

    // $('#imageBuildModal_ta').hide();
    $("#imageBuildModal").css('height', 'auto');
    $('#imageBuildModal').modal();

    firsTimeShowingImageModal = false;
  }

  function prepareBuildImageModal(showModal)
  {
    var jqxhr = $.ajax('../util/vcput.php?a=getImages'
                     + '&stepid=' + 201917                     + '&mode=' + 's'
                     + '&ownerid=' + 1165740)
                 .done(function(data, textStatus, jqXHR) {
                   try {
                     console.log(data);
                     var result = JSON.parse(data);
                     if (result['status'] == 'error') {
                       alert('Error getting image list: ' + result['message']);
                     }
                     else {
                       if (typeof result['images'] === 'undefined') {
                         alert('Error: no image list found');
                       }
                       else {
                         vocBuildImages = result['images'];
                         if (showModal) {
                           showBuildImageModal();
                         }
                       }
                     }
                   }
                   catch (err) {
                     alert('Error: Exception getting image list: ' + err);
                   }
                 })
                 .fail(function(data, textStatus, jqXHR) {
                   alert('Error: Failure getting image list');
                 });
  }

  function buildContainerImage()
  {
    var imageName = document.getElementById('image_build_name').value.trim();
    var dockerFile = document.getElementById('image_build_dockerfile').value.trim();

    if (imageName === "")
    {
      alert("The image name needs to be set");
      return;
    }
    if (dockerFile === "")
    {
      alert("The docker file name needs to be set");
      return;
    }

    var currentAccessActualElements = document.getElementsByClassName("image-build-access-actual");
    var accessArray = [];
    for (var i = 0; i < currentAccessActualElements.length; i++)
    {
      var id = currentAccessActualElements[i].dataset.id;
      var name = document.getElementById("image_build_access_name_" + id).value.trim();
      var port = document.getElementById("image_build_access_port_" + id).value.trim();
      var e = document.getElementById("image_build_access_type_select_" + id);
      var type = e.options[e.selectedIndex].text;
      console.log("ACCESS " + id + " : " + name + " / " + type + " / " + port);
      if ((name === "") || (port === "") || (type == 0))
      {
        alert("At least one access type definition is incomplete; please set all the fields or delete the row");
        return;
      }
      if (! (/^\d+$/.test(port)))
      {
        alert("Port numbers need to be positive integers; please fix the incorrect port value: " + port);
        return;
      }
      // accessArray.push({ "name" : name, "type" : type, "port" : port });
      var arr = {};
      arr["name"] = name;
      arr["type"] = type;
      arr["port"] = port;
      accessArray.push(arr);
    }
    
    // right now we don't give users a choice - since we always start from our base
    var userArray = {};
    userArray["user"] = "labsuser";
    userArray["suser"] = "labsadmin";
    userArray["sysuser"] = "";

    var mountsArray = {};

    // if this is a supposed to be a new image, make sure that it does not already exist
    if (vocImageBuildNew)
    {
      if (vocBuildImages) {
        if ('course' in vocBuildImages) {
          if (imageName in vocBuildImages['course']) {
            alert("An image with this name '" + imageName + "' already exists; please select a new unique name");
            return;
          }
        }
      }
    }
    var select_baseimage = document.getElementById('imageBuildModal_select_baseimage');
    
    var imageSelVal = select_baseimage.value;
    var imageSelTxt = select_baseimage.options[select_baseimage.selectedIndex].text.trim();

    $('#imageBuildModal_ok').show();
    $('#imageBuildModal_cancel').hide();
    $('#imageBuildModal_build').hide();
    $('#imageBuildModal_ta').text("building..."); // "Building image.");
    $('#imageBuildModal_ta').show();
    $("#imageBuildModal").animate({ scrollTop: $('#imageBuildModal').prop("scrollHeight")}, 1000);
    // imageBuildModalDotTimer = setTimeout(imageBuildModalModalDots, 1000);

    var jqxhr = $.ajax({
      type: 'POST',
      url: '../util/vcput.php?a=buildImage&stepid=201917&version=0&mode=s',
      data: {
        baseimage: imageSelTxt,
        baseimage_id: imageSelVal,
        imagename: imageName,
        dockerfile: dockerFile,
        access: JSON.stringify(accessArray),
        users: JSON.stringify(userArray),
        mounts: JSON.stringify(mountsArray)
      }
    })
    .done(function(data, textStatus, jqXHR) {
      try {
        console.log(data);
        var result = JSON.parse(data);
        if (result['status'] == 'error') {
          $('#imageBuildModal_ta').text('Error: ' + result['message']);
          // put Cancel/Build back
          $('#imageBuildModal_ok').hide();
          $('#imageBuildModal_cancel').show();
          $('#imageBuildModal_build').show();
        }
        else {
          if (result['status'] == 'building') {
            $('#imageBuildModal_ta').text("building...");
            imageBuildModalDotTimer = setTimeout(imageBuildModalModalDots, 1000);
            // need to periodically check the build status
            checkImageBuildTimer = setTimeout(checkImageBuild, 3000, dockerFile);
          }
          else {
            $('#imageBuildModal_ta').text(result['status']);
          }
          vocImageBuildNew = false;
        }
      }
      catch (err) {
        $('#imageBuildModal_ta').text('Error: Exception building image: ' + err);
        // put Cancel/Build back
        $('#imageBuildModal_ok').hide();
        $('#imageBuildModal_cancel').show();
        $('#imageBuildModal_build').show();
      }
    })
    .fail(function(data, textStatus, jqXHR) {
      console.log("BuldImage: Fail");
      $('#imageBuildModal_ta').text('Error: Build Image failed');
      // put Cancel/Build back
      $('#imageBuildModal_ok').hide();
      $('#imageBuildModal_cancel').show();
      $('#imageBuildModal_build').show();
    });
  }

  function deleteAccessContainerImage(e)
  {
    var target = e.target;
    var id = target.dataset.id;

    var firstBuildAccess = document.getElementById("image_build_access_0");

    var targetAncestor = target.closest('.image-build-access');

    var currentAccessElements = document.getElementsByClassName("image-build-access");

    if (targetAncestor != firstBuildAccess)
    {
      for (var i = 0; i < currentAccessElements.length; i++)
      {
        var el = currentAccessElements[i];
        if (el.dataset.id == id)
        {
          el.remove();
          break;
        }
      }
    }
    else
    {
      // remove the first one (image-build-access-actual) - but we need to then move the next ones (if any) up
      
      var actualAccessElement = targetAncestor.querySelector(".image-build-access-actual");
      actualAccessElement.remove();

      if (currentAccessElements.length > 1)
      {
        // get the first image-build-access-actual and append it to firstBuildAccess

        var imageModalBody = document.getElementById("imageBuildModal_body");
        var firstImageBuildAccessActual = imageModalBody.querySelector(".image-build-access-actual");
        var firstImageBuildAccessActualParent = firstImageBuildAccessActual.closest('.image-build-access');
        
        firstImageBuildAccessActual.classList.remove("offset3");
        firstBuildAccess.appendChild(firstImageBuildAccessActual);
        firstImageBuildAccessActualParent.remove();
      }
    }
  }

  function addContainerImageAccess()
  {
    var currentAccessElements = document.getElementsByClassName("image-build-access-actual");
    var myId = currentAccessElements.length;
    console.log("MY ID: " + myId);

    // myId == 0 => this is the first access type (inline with the "Access:" label)

    if (myId > 0)
    {
      var topDiv = document.createElement("div"); 
      topDiv.classList.add("control-group");
      topDiv.classList.add("row-fluid");
      topDiv.classList.add("image-build-access");
      // topDiv.setAttribute("name", "image_build_access");
      topDiv.setAttribute("id", "image_build_access_" + myId);
      topDiv.setAttribute('data-id', myId);
    }
    else
    {
      topDiv = document.getElementById("image_build_access_0");
    }

    middleDiv = document.createElement("div"); 
    middleDiv.classList.add("span4");
    middleDiv.classList.add("row-fluid");
    middleDiv.classList.add("image-build-access-actual");
    middleDiv.setAttribute('data-id', myId);
    // middleDiv.setAttribute("name", "image_build_access_actual");
    middleDiv.setAttribute("id", "image_build_access_actual_" + myId);
    if (myId > 0)
    {
      middleDiv.classList.add("offset3");
    }
    topDiv.appendChild(middleDiv);
    
    // name
    nameOuterDiv = document.createElement("div"); 
    nameOuterDiv.classList.add("span4");
    middleDiv.appendChild(nameOuterDiv);

    nameInnerDiv = document.createElement("div"); 
    nameInnerDiv.classList.add("span12");
    nameOuterDiv.appendChild(nameInnerDiv);

    input = document.createElement("input");
    input.className = "span12";
    input.setAttribute("id", "image_build_access_name_" + myId);
    input.setAttribute("placeholder", "name");
    input.setAttribute("type", "text");
    input.setAttribute("maxlength", "80");
    input.setAttribute('data-id', myId);
    input.style.marginBottom = "0px";
    nameInnerDiv.appendChild(input);

    // type
    typeOuterDiv = document.createElement("div"); 
    typeOuterDiv.classList.add("span4");
    middleDiv.appendChild(typeOuterDiv);

    typeInnerDiv = document.createElement("div"); 
    typeInnerDiv.classList.add("span12");
    typeOuterDiv.appendChild(typeInnerDiv);

    var select = document.createElement("select");
    select.style.width = "100%";
    select.style.marginBottom = "0px";
    select.setAttribute('data-id', myId);
    select.setAttribute("id", "image_build_access_type_select_" + myId);

    var op = new Option("Type", 0, true, true);
    op.disabled = true;
    op.hidden = true;
    select.appendChild(op);
          op = new Option("http", "http");
      select.appendChild(op);
    
    typeInnerDiv.appendChild(select);

    // port
    portOuterDiv = document.createElement("div"); 
    portOuterDiv.classList.add("span3");
    middleDiv.appendChild(portOuterDiv);

    portInnerDiv = document.createElement("div"); 
    portInnerDiv.classList.add("span12");
    portOuterDiv.appendChild(portInnerDiv);

    input = document.createElement("input");
    input.className = "span12";
    input.setAttribute("id", "image_build_access_port_" + myId);
    input.setAttribute("placeholder", "port");
    input.setAttribute("type", "text");
    input.setAttribute("maxlength", "80");
    input.setAttribute('data-id', myId);
    input.style.marginBottom = "0px";
    input.style.textAlign = "right";
    portInnerDiv.appendChild(input);

    // trash
    trashOuterDiv = document.createElement("div"); 
    trashOuterDiv.classList.add("span1");
    trashOuterDiv.classList.add("row-fluid");
    middleDiv.appendChild(trashOuterDiv);

    button = document.createElement("button");
    button.classList.add("icon-button");
    // button.setAttribute("id", myId);
    button.style.paddingTop = "8px";
    trashOuterDiv.appendChild(button);

    icon = document.createElement("i");
    icon.classList.add("icon-trash");
    // icon.classList.add("icon-large");
    icon.setAttribute('data-id', myId);
    icon.addEventListener('click', deleteAccessContainerImage);
    button.appendChild(icon);

    if (myId > 0)
    {
      parent = document.getElementById("imageBuildModal_body");
      parent.appendChild(topDiv);
    }

    // scroll up in case we added more access elements that can be displayed together
    $("#imageBuildModal_body").animate({
      scrollTop:$("#imageBuildModal_body")[0].scrollHeight - $("#imageBuildModal_body").height()
    },100);

    return myId;
  }

  // from:https://github.com/jserz/js_piece/blob/master/DOM/ChildNode/remove()/remove().md
  // node.remove polyfill for IE
  (function (arr) {
    arr.forEach(function (item) {
      if (item.hasOwnProperty('remove')) {
        return;
      }
      Object.defineProperty(item, 'remove', {
        configurable: true,
        enumerable: true,
        writable: true,
        value: function remove() {
          if (this.parentNode === null) {
            return;
          }
          this.parentNode.removeChild(this);
        }
      });
    });
  })([Element.prototype, CharacterData.prototype, DocumentType.prototype]);

</script>
  



	<script type="text/javascript">	
	//var projtypespan_elem = document.getElementById("breadcrumb-type-link");
	var projlinkspan_elem = document.getElementById("breadcrumb-proj-link");
	var projuserspan_elem = document.getElementById("breadcrumb-user-link");


         //projtypespan_elem.innerHTML = '<span class=\"use-pointer\" style=\"color: rgb(32, 57, 157);\" onclick=\"location.href=\'main.php?m=course&code=vc_2_0_052920205ed11f801e4b8&step=201916\'\" tabindex=\"0\" role=\"button\">pa3.2 evaluation of predictive..</span>';
      projlinkspan_elem.innerHTML = 
      '<span class=\"use-pointer\" style=\"color: rgb(32, 57, 157);\" onclick=\"location.href=\'main.php?m=course&code=vc_2_0_052920205ed11f801e4b8&step=201916\'\" tabindex=\"0\" role=\"button\">Assessment: Putting the model ..</span>';
     

  $("#breadcrumb-step-block").detach();

	
  $("#breadcrumb-vers-block").detach();
    
	
	</script>	
	
	



 <script type="text/javascript">
    var vocdomain = document.domain.split('.').slice(-2).join('.');
    document.domain = vocdomain;
    
    var iframeWindow = null; 
    
function vocareum_be_loadContext() {
    iframeWindow.vocext_comments.context = {};
    iframeWindow.vocext_comments.context['myname'] = "81a7856fdc7afeed9d8c5ed0703eb67b";
    iframeWindow.vocext_comments.context['myid'] = "1165740";
    iframeWindow.vocext_comments.context['codecomment_edit'] = "false";
}

function vocareum_be_canEdit() {
    return false;
}

function vocareum_be_canEditRubrics() {
    return false;
}

function vocareum_be_getCellColor(cellType) 
{
    // cellType is of type: VCJupyterCellType
    switch (cellType)
    {
      case 4:
        return "#e2e2e2";
      default:
        return null;
    }
}

function vocareum_be_loadComments(filepath, cell, cellindex) {
    console.log("vocareum_be_loadComments " + filepath);
    filepath = "./" + filepath;
    for (var cid in allCodeComments) {
        var obj = allCodeComments[cid];
        if (obj.selectedFilePath == filepath) {
            if (obj.cell == cellindex) {
                if (iframeWindow) {
                    iframeWindow.vocext_addComment(cell, obj.selectedLine, JSON.parse(obj.selectedComment), (obj.selectedPeer == 1 ? 'Peer reviewer' : obj.name), obj.time, cid, obj.selectedAuthor);
                }
            }
        }
    }
}


</script>
	
	

	

<link rel="stylesheet" href="../shared/codemirror-5.25.2/lib/codemirror.css">
<script src="../shared/codemirror-5.25.2/lib/codemirror.js?v=1615932784"></script>

<script src="../shared/codemirror-5.25.2/mode/clike/clike.js"></script>
<script src="../shared/codemirror-5.25.2/mode/xml/xml.js"></script>
<script src="../shared/codemirror-5.25.2/mode/python/python.js"></script>
<script src="../shared/codemirror-5.25.2/mode/php/php.js"></script>

<script src="../shared/codemirror-5.25.2/mode/markdown/markdown.js"></script>
<script src="../shared/codemirror-5.25.2/mode/gfm/gfm.js"></script>
<script src="../shared/codemirror-5.25.2/addon/mode/overlay.js"></script>

<link rel="stylesheet" href="../shared/codemirror-5.25.2/theme/neat.css">

<script src="../shared/codemirror-5.25.2/mode/javascript/javascript.js"></script>
<!-- removed from later versions
<script src="../shared/codemirror-5.25.2/keymap/extra.js"></script> 
-->
<script src="../shared/codemirror-5.25.2/addon/selection/active-line.js"></script>
<script src="../shared/codemirror-5.25.2/addon/edit/matchbrackets.js"></script>
<script src="../shared/codemirror-5.25.2/addon/search/search.js"></script>
<script src="../shared/codemirror-5.25.2/addon/search/searchcursor.js"></script>
<script src="../shared/codemirror-5.25.2/addon/dialog/dialog.js"></script>
<link rel="stylesheet" href="../shared/codemirror-5.25.2/addon/dialog/dialog.css">

<script src="../shared/codemirror-5.25.2/addon/edit/closebrackets.js"></script>
<script src="../shared/codemirror-5.25.2/addon/edit/closetag.js"></script>


<script src="../shared/diff_match_patch/diff_match_patch.js"></script>
<script src="../shared/codemirror-5.25.2/addon/merge/merge.js"></script>
<link rel=stylesheet href="../shared/codemirror-5.25.2/addon/merge/merge.css">




<script src="../shared/codemirror-5.25.2/mode/css/css.js"></script>
<script src="../shared/codemirror-5.25.2/mode/sql/sql.js"></script>

<link rel=stylesheet href="../shared/codemirror-5.25.2/addon/hint/show-hint.css">
<script src="../shared/codemirror-5.25.2/addon/hint/show-hint.js"></script>
<script src="../shared/codemirror-5.25.2/addon/hint/javascript-hint.js"></script>
<script src="../shared/codemirror-5.25.2/addon/hint/html-hint.js"></script>
<script src="../shared/codemirror-5.25.2/addon/hint/xml-hint.js"></script>
<script src="../shared/codemirror-5.25.2/addon/hint/sql-hint.js"></script>
<script src="../shared/codemirror-5.25.2/addon/hint/css-hint.js"></script>

<style type="text/css">

.breadcrumbs {
    z-index: 999 !important;
}

.content pre {
    padding: 5px 0px !important;
    margin: 0px 0px 4px !important;
    line-height: 15px !important;
    border: none !important;
    font-size: 12px !important;
    background: transparent !important;    
}

div:-webkit-full-screen {
  width: 100% !important;
  background-color: white;
}
div:-moz-full-screen {
  width: 100% !important;
  background-color: white;
}
div:-ms-fullscreen {
  width: 100% !important;
  background-color: white;
}
div:fullscreen {
  width: 100% !important;
  background-color: white;
}

/* While in fullscreen, hide any children with class 'tohide' */
:-webkit-full-screen .tohide {
  display: none;
}
:-moz-full-screen .tohide {
  display: none;
}
:-ms-fullscreen .tohide {
  display: none;
}
:fullscreen .tohide {
  display: none;
}

         


#page-content {
    position: absolute;
    left: 0;
    right: 0;
    top: 0px;
    bottom: 10px;
    background-color: white;
}

body > div > #page-content {
    top: 0px;
}
#page-content > div,
#page-content #editorbox,
#page-content #editordiv,
#page-content #editordiv > div,
#page-content #editordiv .tab-content #filelisting .widget-box,
#page-content #editordiv .tab-content #filelisting .widget-box .widget-body,

#page-content #editordiv #editorTabs,

#page-content #editordiv .tab-content,

#page-content #editordiv .tab-content #filelisting {
    height: 100%;
    overflow: auto;
    -moz-box-sizing: border-box;
    -webkit-box-sizing: border-box;
    box-sizing: border-box; 
}

#page-content #editordiv .tab-content #filelisting .widget-box {
    margin: 0;
    -moz-box-sizing: border-box;
    -webkit-box-sizing: border-box;
    box-sizing: border-box;
}

#page-content #editordiv .tab-content #codeframe,
#page-content #editordiv .tab-content #buildframe,
#page-content #editordiv .tab-content #htmlframe,
#page-content #editordiv .tab-content #terminalframe
#page-content #editordiv .tab-content #gradeframe
{
    height: 100%;
    position: relative;
    overflow: hidden;
}

#page-content #editordiv .tab-content #htmlframe
{
    background-color: white;
}


#page-content #editordiv .tab-content #codeframe #codeform0,
#page-content #editordiv .tab-content #htmlframe #div_htmlframe,
#page-content #editordiv .tab-content #buildframe #buildtextarea {
    position: absolute;
    top: 1px;
    bottom: 0;
    left: 4px;
    right: 4px;
}



.CodeMirror {
    font-size: 13px;
    border: 1px solid #eee;
    width: auto;
    height: 100%;
    -moz-box-sizing: border-box;
    -webkit-box-sizing: border-box;
    box-sizing: border-box;
}

.CodeMirror-scroll {
  overflow-y: auto;
  overflow-x: auto;
  margin-bottom: -10px !important;
  padding-bottom: 10px !important;
}


.CodeMirror-linenumber {
  color: #000 !important;
}

.CodeMirror-hints, .CodeMirror-hint, .CodeMirror-hint-active { 
    z-index:2147483647 !important;
}

#buildtextarea {
	background-color: white;
    overflow: auto;
    border: 1px solid light-gray;
    padding: 5px;
    margin-bottom: 0;
}

.tree {
  font-size: 12px;
}

.tree .tree-selected > [class*="icon-"]:first-child {
  color: 0 !important;
}

#video-viewer-modal {
    height: 80% !important;
}

#image-viewer-modal {
    height: 80% !important;
}

#gallery-viewer-modal {
    height: 80% !important;
}

#image-viewer-modal .modal-body {
    max-height: none;
    position: absolute;
    left: 0;
    right: 0;
    top: 40px;
    bottom: 0;
}

#image-viewer-modal .modal-body table,
#image-viewer-modal .modal-body table tbody,
#image-viewer-modal .modal-body table tbody td {
    height: 100%;
    width: 100%;
}

#image-viewer-modal .modal-body table tbody td {
    text-align: center;
}

#image-viewer-modal .modal-body img {
    max-height: 100%;
    max-width: 100%;
}

.modal-80percent {
    height: 80% !important;
}

#other-viewer-modal {
    height: 80%;
}

#other-viewer-modal .modal-body {
    max-height: none;
    position: absolute;
    left: 0;
    right: 0;
    top: 40px;
    bottom: 0;
}

#other-viewer-modal .modal-body table,
#other-viewer-modal .modal-body table tbody,
#other-viewer-modal .modal-body table tbody td {
    height: 100%;
    width: 100%;
}

#other-viewer-modal .modal-body table tbody td {
    text-align: center;
}

#other-viewer-modal .modal-body img {
    max-height: 100%;
    max-width: 100%;
}


#modal-table-widgetoutput {
    height: 80%;
}

#modal-table-widgetoutput .modal-body {
    max-height: none;
    position: absolute;
    left: 0;
    right: 0;
    top: 40px;
    bottom: 0;
}

#modal-table-widgetoutput .modal-body table,
#modal-table-widgetoutput .modal-body table tbody,
#modal-table-widgetoutput .modal-body table tbody td {
    height: 100%;
    width: 100%;
}

#modal-table-widgetoutput .modal-body table tbody td {
    text-align: center;
}

#modal-table-widgetoutput .modal-body img {
    max-height: 100%;
    max-width: 100%;
}

.widgetoutput pre {
    padding: 5px 0px !important;
    margin: 0px 0px 4px !important;
    line-height: 15px !important;
    border: none !important;
    font-size: 12px !important;
    background: transparent !important;    
}




#browser-viewer-modal {
    height: 80% !important;
}

#modal-upload-wait {
    height: 80% !important;
}

#modal-git-wait {
    height: 60% !important;
    width : 60% !important;
}

#browser-viewer-modal .modal-body {
    max-height: none;
    position: absolute;
    padding: 0px;
    left: 0;
    right: 0;
    top: 38px;
    bottom: 0;
}

#modal-table-report-all-html {
    height: 80% !important;
}

#modal-table-report-all-html .modal-body {
    max-height: none;
    position: absolute;
    padding: 0px;
    left: 0;
    right: 0;
    top: 38px;
    bottom: 0;
}

#report_aws_div .modal-body0 {
    position: relative;
    max-height: 100%;
    overflow-y: auto;
}

.vocidetoolbarbtn {
    background-color: transparent;
    border: 1px solid lightgray; 
    margin-right: 4px; 
    margin-left: 0px;
    color: rgb(0, 0, 0);}

.vmtoolbarbtn {
    border-radius: 3px!important;
    background-color: transparent;
    border: 1px solid lightgray; 
    margin-right: 4px; 
    margin-left: 0px;
    color: rgb(0, 0, 0);}

#waitClusterButton:disabled,
#waitClusterButton[disabled] {
  border: 0px;
}

#waitClusterButton:disabled:hover { 
  background-color: #abbac3 !important;
}

.jupyter-modal-td-file {
  text-align:left !important;
  border:0px !important; 
  padding-bottom:0px !important;
}
.jupyter-modal-td-checkbox {
  margin-bottom:6px !important;
  width:20px !important;
}


    .merge-modal-td-asn {
      text-align:left !important;
      border:0px !important; 
      padding-bottom:0px !important;
      padding-left:0px !important;
      padding-top:4px !important;
    }
    .merge-modal-td-checkbox {
      margin-bottom:6px !important;
      margin-right:6px !important;
      width:20px !important;
    }
  
.clabs-state-modal-tr-vm {
    border-bottom:1px solid lightgray;
}
.clabs-state-modal-td-vm {
  text-align:left !important;
  border:0px !important; 
  padding-bottom:0px !important;
}
.clabs-state-modal-td-state {
  text-align:right !important;
  border:0px !important; 
  padding-bottom:4px !important;
}

.icon-button {
    appearance: none;
    -webkit-appearance: none;
    -moz-appearance: none;
    outline: none;
    border: 0;
    background: transparent;
}
</style>

      

	
    <div class="span12" id="editordiv" style="margin-left:0px;margin-right:0px;" ><!-- editor and logs -->	

			    <div class="tabbable" id="editorTabs" style="overflow:hidden"> <!-- start tabbable -->
					    <ul class="nav nav-tabs" id="idenav" style=" margin-top:6px; 
                                                        
                                                        
                                                        "> <!-- ul tabs -->
									<!-- dropdown actions -->
                                   <div class="pull-right">

                    
                	

                
                                      
                  
                                              <div class="btn-group hide" style="margin-left:0px;">                            
                                <a id="ligrade" class="btn vocbtn2 vocbtn-status commandbutton"
                                    data-toggle="tab" href="#buildframe" data-command="Grading">
                                      Grade
                                  </a>
                            </div>
                                        
                                                                                                      <div id="reports" class="btn-group" style="margin-left:0px;">
                          <div id="reportsdropdown" data-toggle="dropdown" class="dropdown-toggle btn vocbtn2 vocbtn-status" href="#" tabindex="0" role="button">
                             <i id="detailspinbox" class="icon-spin icon-spinner"></i>
                             Details <i class="icon-caret-down"></i>
                          </div>
                          <ul class="dropdown-menu dropdown-info dropdown-yellow pull-right dropdown-caret dropdown-close" 
                              style="padding-top: 0px; border: 1px solid darkgray;">

                            <li>
                            <table class="table" style="margin-bottom:0px !important; border: 1px solid lightgray">
                                      <thead>
                                  <tr>
                                    <th style="width:140px">Details</th>
                                    <th></th>
                                  </tr>
      
                                      </thead>
                                      <tbody id="subdetails">
          
                                    <tr><td>Last submitted: </td><td>Jan-12-2021 9:26:45 pm EST</td><tr><tr><td>Submission count: </td><td>4</td><tr><tr><td>Total allowed: </td><td>4</td><tr><tr><td>Due date: </td><td>None</td><tr>		      
                                                                                                                                                                                                                          </tbody>

                                </table>
                                                                            
                                      
                            </li>  		      

                            
                                                                                                                                                                          <li>
                                <div style="border-top: 1px solid;"></div>
                                <a href='#' id="gradingreportbutton" data-toggle="modal" style="font-size:95%; padding-top: 10px;">
                                  <i class="icon-caret-right"></i>View Grading Report
                                </a>                         
                                <div id="GradingReportStatus" style="display:none;padding: 3px; margin: 3px 5px;"></div>
                                  <div id="GradingReportProgress" style="padding: 3px; margin: 3px 5px;"></div>
                              </li>
                                                      </ul>
                        </div>				
                                         

                	

                    
                
                	

                                                  
                                                                                                
                <!-- cluster start -->
                                <!-- cluster end -->
                
                <!-- new ide -->
                                
                                                                                  
                                                      <div class="btn-group" id="grade-window" style="margin-left:0px;">                            
                      <div  class="btn vocbtn2 vocbtn-status" tabindex="0" role="button"
                          data-toggle="modal" id="gradesIdeBtn">
                          Grades                      </div>
                    </div>
                                                                    
                
                  <!-- commands end -->  
                  <!-- commands start -->
                                          <!-- commands end -->

                  	
                        <!-- Git actions -->
                        
                        <div id="liactions2" class="btn-group" style="margin-left:0px;">
                          <div id="actionsdropdown_liactions2" class="dropdown-toggle btn vocbtn2 vocbtn-status" href="#" tabindex="0" role="button">
                            <span id="editor-label-actions">Actions</span>
                            <i class="icon-caret-down"></i>
                          </div>

                          <ul  class="dropdown-menu dropdown-info dropdown-yellow pull-right dropdown-caret dropdown-close" >
                          
                                                   
                          
                                                    
                                                            <iframe id="dl_startercode" style="display:none;"></iframe>
                                   <script type="text/javascript">
                                      function downloadStartcode()
                                      {
                                        $.ajax({
                                                url: '../util/vcput.php?a=dlstartercode&stepid=201917&version=0',
                                                type: 'get',
                                                success: function(data) { 
                                                        var ampos = data.search('msg::');
                                                        var bmpos = data.search('::msg');
                                                        var apos = data.search('voc::');
                                                        var bpos = data.search('::voc');
                                                        if(ampos>=0 && bmpos>=0 && bmpos>ampos ){
                                                          consolePrint(data.substring(ampos+5,bmpos));
                                                        }
                                                        if(apos>=0 && bpos>=0){
                                                          document.getElementById('dl_startercode').src = data.substring(apos+5,bpos);
                                                        }
                                                      }
                                             });
                                      }
                                      function downloadReports()
                                      {
                                        $.ajax({
                                                url: '../util/vcput.php?a=dlreports&stepid=201917&version=0',
                                                type: 'get',
                                                success: function(data) {
                                                        var ampos = data.search('msg::');
                                                        var bmpos = data.search('::msg');
                                                        var apos = data.search('voc::');
                                                        var bpos = data.search('::voc');
                                                        if(ampos>=0 && bmpos>=0 && bmpos>ampos ){
                                                          consolePrint(data.substring(ampos+5,bmpos));
                                                        }
                                                        if(apos>=0 && bpos>=0){
                                                          document.getElementById('dl_startercode').src = data.substring(apos+5,bpos);
                                                        }
                                                      }
                                             });
                                      }
                                      function downloadSolution()
                                      {
                                        $.ajax({
                                                url: '../util/vcput.php?a=dlsolution&stepid=201917&version=0',
                                                type: 'get',
                                                success: function(data) { 
                                                        var ampos = data.search('msg::');
                                                        var bmpos = data.search('::msg');
                                                        var apos = data.search('voc::');
                                                        var bpos = data.search('::voc');
                                                        if(ampos>=0 && bmpos>=0 && bmpos>ampos ){
                                                          consolePrint(data.substring(ampos+5,bmpos));
                                                        }
                                                        if(apos>=0 && bpos>=0){
                                                          document.getElementById('dl_startercode').src = data.substring(apos+5,bpos);
                                                        }
                                                      }
                                             });
                                      }
                                   </script>

                                <li class="divider"></li>
                                                              <li>
                                    <a href="#" onclick="downloadStartcode()" tabindex="0" role="button">
                                        <i class="icon-arrow-down"></i>
                                          Download startercode
                                      </a>
                                </li>
                                <li id="download_solution" class="hidden-1">
                                    <a href="#" onclick="downloadSolution()" tabindex="0" role="button">
                                        <i class="icon-arrow-down"></i>
                                          Download solution
                                      </a>
                                </li>
                                                                                                             
                         
                         
                                                         <li class="divider"></li>
                                                                <li>
                                  <a data-toggle="tab" data-command="0" class="togglebutton" href='#' tabindex="0" role="button">
                                    Standard
                                  </a>
                                </li>
                                                                                                                         
                         
                                                    <li class="divider"></li>
                           <li id="apps_dd_submenu" class="dropdown-submenu pull-left dropdown-caret dropdown-close">
                             <a tabindex="0" href="#">Applications</a>
                             <ul id="apps_dd_menu" class="dropdown-menu" style="padding-right:4px">
                                                                                                                                <li class="linux_app disabled">
                                 <a data-toggle="tab" data-command="1" class="appbutton" href='#' tabindex="0" role="button">
                                   Eclipse                                   <i id="app_spinbox_1" style="display: none;" class="icon-spin icon-spinner"></i>
                                 </a>
                               </li>
                                                                                               <li class="linux_app disabled">
                                 <a data-toggle="tab" data-command="2" class="appbutton" href='#' tabindex="0" role="button">
                                   MySQL WB                                   <i id="app_spinbox_2" style="display: none;" class="icon-spin icon-spinner"></i>
                                 </a>
                               </li>
                                                                                               <li class="linux_app disabled">
                                 <a data-toggle="tab" data-command="5" class="appbutton" href='#' tabindex="0" role="button">
                                   pgAdmin                                   <i id="app_spinbox_5" style="display: none;" class="icon-spin icon-spinner"></i>
                                 </a>
                               </li>
                                                                                               <li class="linux_app disabled">
                                 <a data-toggle="tab" data-command="3" class="appbutton" href='#' tabindex="0" role="button">
                                   Spyder                                   <i id="app_spinbox_3" style="display: none;" class="icon-spin icon-spinner"></i>
                                 </a>
                               </li>
                                                                                               <li class="linux_app disabled">
                                 <a data-toggle="tab" data-command="4" class="appbutton" href='#' tabindex="0" role="button">
                                   Desktop                                   <i id="app_spinbox_4" style="display: none;" class="icon-spin icon-spinner"></i>
                                 </a>
                               </li>
                                                                                               <li class="linux_app disabled">
                                 <a data-toggle="tab" data-command="6" class="appbutton" href='#' tabindex="0" role="button">
                                   Android Studio (beta)                                   <i id="app_spinbox_6" style="display: none;" class="icon-spin icon-spinner"></i>
                                 </a>
                               </li>
                                                                                               <li class="linux_app disabled">
                                 <a data-toggle="tab" data-command="11" class="appbutton" href='#' tabindex="0" role="button">
                                   Thonny                                   <i id="app_spinbox_11" style="display: none;" class="icon-spin icon-spinner"></i>
                                 </a>
                               </li>
                                                              <li class="divider"></li>
                               <li class="linux_app disabled">
                                 <a data-toggle="tab" data-command="11" class="appstopbutton" href='#' tabindex="0" role="button">
                                   Stop App
                                   <i id="app_spinbox_stop" style="display: none;" class="icon-spin icon-spinner"></i>
                                 </a>
                               </li>
                             </ul>
                           </li>
                         
                                                   
                          
                                                    <li class="divider"></li>
                           <li>
                             <a href="#" id="clear_notebook_output" tabindex="0" role="button">
                               Clear Notebook Output
                             </a>
                           </li>
                                                  
                         
                                                          <li class="divider"></li>
                                <li>
                                    <a href="#" onclick="copyworkarea()" tabindex="0" role="button">
                                          Copy workarea
                                      </a>
                                </li>
                                <li class="divider"></li>
                                <li>
                                    <a href="#" onclick="pasteworkarea()" tabindex="0" role="button">
                                          Paste workarea
                                      </a>
                                </li>
                                                          <li class="divider"></li>
                                <li>
                                    <a href="#" onclick="confirmResetAsnBtn('../util/vcreset.php?vockey=JPu2MF7MPbsPpHMAZIPBAg%3D%3D&asnid=201916&stepid=201917&mode=s&vmd=100')" tabindex="0" role="button">
                                        <i class="icon-undo"></i>
                                          Reset assignment
                                      </a>
                                </li>	
                                                                                   

                                                    </ul>
                        </div>		
                  	
                
                
                                

                    
                    
		   		  
		        		  
                      </div>
							</ul> <!-- ul tabs end -->


<!--   mhui -->
<div id="jidebox" class="box" style="border: 0px solid blue; width: 100%; margin: 0px;">
<!-- gradepanel -->

<div id="gradeframe" class="span1"  style="float: right; width:250px; height: 100%; border: 1px solid lightgray; margin-bottom: 0px; margin-right: 0px; margin-left: 0px; display: none;">
  <div id="grades-panel" style="border: 0px solid red; width: 100%; height: 100%;">
    <div id="gradeframehide" tabindex="0" role="button" aria-label="Close grade panel" class="" style="float: right; cursor: pointer; padding: 5px 8px 8px 8px; line-height: 20%; margin-right: 8px; font-size: 200%; border: 0px solid red;">-</div>
      <div class="btn-group span2" id="gradedetails" style="float: right; padding-top: 5px; display: none;">
        <a href="/main/main.php?m=editor&asnid=201916&stepid=201917&hideNavBar=1" target="_blank"
          class="btn vocbtn2 vocbtn-status" tabindex="0" role="button">Details
        </a>
      </div>
    <div style="clear: right;"></div>
    <div id="gradespinner" class="center hidden-1" style="border: 0px solid red; width: 100%; height: 100%; margin-top: 20px; background-color: #fff;">
      <i class="icon-spinner icon-spin light-grey bigger-275" style="width: 42px; height: 42px; margin: auto;"></i>
    </div>
    <iframe style="overflow: auto; border: 0px solid blue; width: 100%; height: 100%;" src="about: blank"></iframe>
  </div>
</div>

<div class="span1" id="gradeframedivider" style="float: right; border: 0px solid red; display: none;  width:8px; height:90%; margin:0px; background:url('../shared/img/vocdivider-v.png') no-repeat scroll 3px 50% transparent;padding: 5px 0px;cursor: col-resize;"></div>



<script type="text/javascript">

var addEvent = function(object, type, callback) {
    if (object == null || typeof(object) == 'undefined') return;
    if (object.addEventListener) {
        object.addEventListener(type, callback, false);
    } else if (object.attachEvent) {
        object.attachEvent("on" + type, callback);
    } else {
        object["on"+type] = callback;
    }
};

addEvent(window, "resize", function(event) {
        var jde = true;
        var rde = false;
        
        if (document.getElementById('gradeframe').style.display === 'none') {
          if (jde || rde) {
               $('#jupyterIframeParent').width($('#jidebox').width());
          }
        } else {
          if (jde || rde) {
             $('#jupyterIframeParent').width(document.getElementById('gradeframedivider').offsetLeft-5);
          }
       }
});

$('#gradeframehide').on('click', function() {
    var jde = true;
    var rde = false;
    
      document.getElementById('gradeframe').style.display = "none";
      document.getElementById('gradeframedivider').style.display = "none";
      if (jde || rde) {
           $('#jupyterIframeParent').width($('#jidebox').width());
      }

});

var input = document.getElementById("gradeframehide");

//Execute a function when the user releases a key on the keyboard
input.addEventListener("keyup", function(event) {
// Number 13 is the "Enter" key on the keyboard
if (event.keyCode === 13) {
 // Cancel the default action, if needed
 event.preventDefault();
 // Trigger the button element with a click
 document.getElementById("gradeframehide").click();
}
});

$('#gradeframedivider').draggable({
axis: 'x',
containment: 'parent',
helper: 'clone',
iframeFix: true,
drag: function (event, ui) {
    var jde = true;
    var rde = false;
    var filetree = true;
    
    if (jde || rde)
    {
      var jidebox_width = $('#jidebox').width();
      var width = jidebox_width - ui.offset.left;
      //if (width < 100) return;

      $('#gradeframe').width(width);
      $('#jupyterIframeParent').width(ui.offset.left-10);
      $('#jupyterIframeParent').css('pointer-events', 'none');
    }
    else
    {
      var width = $("#idebox").width() - ui.offset.left;
      var width_of_right_panel = $("#idebox").width() - width - $('#filelisting').width();
      if (width_of_right_panel < 200) {
        return;
      }
      if (width < 100) {
        return;
      }
      $('#gradeframe').width(width);
    }
},

start: function() {
    var jde = true;
    var rde = false;
    
    if (jde || rde)
    {
    	$('#jupyterIframe').css('pointer-events', 'none');
    }
        },

stop: function() {
    var jde = true;
    var rde = false;
    
    if (jde || rde)
    {
    	$('#jupyterIframe').css('pointer-events', 'auto');
    }
        }

});

</script>
<div class="box" id="jupyterIframeParent" style="border: 0px solid red; height:<php? if($rstudioIde) echo 1500; else echo 500;?>px; margin-right: 0px; width: 100%;">
</div>
</div>


				  </div><!-- end tabbable -->

	  </div> <!-- editor and logs -->	


                     
	</div> <!-- end dirs and editor -->

<!-- start of modals -->


<!-- view output start -->
							<div id="modal-table-output" class="modal hide fade" tabindex="-1">
								<div class="modal-header no-padding">
									<div class="table-header">
										<button type="button" class="close" data-dismiss="modal">
											<h3>Close</h3>
										</button>
											<span style="font-size:20px">Output</span>
									</div>
								</div>

								<div class="modal-body no-padding" id="div-output" style="height:600px;">

								</div>
							</div>
<!-- end view output -->

<!-- diff window -->
							<div id="modal-table-diff" class="modal hide fade" tabindex="-1">
								<div class="modal-header no-padding">
									<div class="table-header">
										<button type="button" class="close" data-dismiss="modal">
																						<h3>Close</h3>
										</button>
											<span style="font-size:20px">View Changes</span>
									</div>
								</div>

								<div class="modal-body no-padding" id="div-diff">

								</div>
							</div>
<!-- end diff window -->

<!-- video viewer -->
    <div id="video-viewer-modal" class="modal hide fade" tabindex="-1">
		    <div class="modal-header no-padding">
            <div class="table-header">
              <button type="button" class="close" data-dismiss="modal">&times;</button>
                Video viewer
            </div>
				</div>

        <div class="modal-body">
            <table><tbody><tr><td>
               <div id="video-viewer-modal-div">
              </div>           
            </td></tr></tbody></table>
        </div>
   </div>
<!-- end video viewer -->                           
<!-- image viewer -->
    <div id="image-viewer-modal" class="modal hide fade" tabindex="-1">
		    <div class="modal-header no-padding">
            <div class="table-header">
              <button type="button" class="close" data-dismiss="modal">&times;</button>
                Image viewer
            </div>
				</div>

        <div class="modal-body">
            <table><tbody><tr><td>
                            <img id="image-viewer-modal-image">
            </td></tr></tbody></table>
        </div>
   </div>
<!-- end image viewer -->

<!-- largefile viewer --> 
    <div id="largefile-viewer-modal" class="modal hide fade" tabindex="-1" style="height:200px">
		    <div class="modal-header no-padding">
            <div class="table-header">
              <button type="button" class="close" data-dismiss="modal">&times;</button>
                File too big for viewer
            </div>
				</div>

        <div class="modal-body">
                <h4>The file is too big for the viewer. Please download the file instead.</h4>
                <br><mute>Only files smaller than 1 MB are shown in the viewer.</mute>
        </div>
   </div>
<!-- end largefile viewer -->
                            

<!-- Uploader -->
 <div id="modal-upload-wait" class="modal hide fade" tabindex="-1">
   <div class="modal-header no-padding">
     <div class="table-header">
       <button type="button" class="close" onclick="afterUpload();" data-dismiss="modal"></button>
       <span style="font-size:20px">Status</span>
     </div>
   </div>

   <div id="uploadWaitMsgDiv" class="modal-body no-padding">
     <p id="uploadWaitMsgBox" style="margin-left: 20px !important;"></p>
   </div>
 </div>

<!-- other viewer -->
    <div id="other-viewer-modal" class="modal hide fade" tabindex="-1">
      <div class="modal-header no-padding">
        <div class="table-header">
          <button type="button" class="close" data-dismiss="modal">&times;</button>
            File viewer
        </div>
      </div>

      <div class="modal-body">
          <table><tbody><tr><td>
               <object type="application/pdf" id="other-viewer-modal-area" width="100%" height="100%">No default viewer found</object>
          </td></tr></tbody></table>
      </div>
    </div>
<!-- end other viewer -->
<!-- browser viewer -->
    <div id="browser-viewer-modal" class="modal hide fade" tabindex="-1">
      <div class="modal-header no-padding">
        <div class="table-header">

          <button type="button" class="close" data-dismiss="modal">&times;</button>
          <span id="browser-viewer-title">Viewer</span>
          <a class="" target="_blank" href="" id="browser-viewer-link">
							<i style="margin-left:10px" class="icon-external-link icon-only white"></i>
					</a>
        </div>
      </div>

      <div class="modal-body" id="browser-viewer-body">
          <iframe id="browser-viewer-iframe" src='' width='100%' height='100%' frameborder='0'></iframe>
      </div>
    </div>
<!-- browser viewer -->


<div id="Scripts-help-modal" class="modal hide fade modal-80percent" tabindex="-1"> <div class="modal-header no-padding"> <div class="table-header"> <button type="button" class="close" data-dismiss="modal">&times;</button> &nbsp;
            <span class="modal-title">&nbsp;
                Scripts            </span>
        </div>
    </div>
    <div class="modal-body">
        Specify the shell scripts that will be run during various phases. These scripts are always run in a directory which has a copy of student submission.
    </div>
</div>
<div id="Grading-help-modal" class="modal hide fade modal-80percent" tabindex="-1"> <div class="modal-header no-padding"> <div class="table-header"> <button type="button" class="close" data-dismiss="modal">&times;</button> &nbsp;
            <span class="modal-title">&nbsp;
                Grading
            </span>
        </div>
    </div>
    <div class="modal-body">
Grading script - this script can be run for grading student submission. It can either be run in batch on all student submissions from the control panel or can be run on an individual student submission by selecting the grading button from the grading panel. You can test this script by selecting Run Scripts => Grading. The script will be run in the work directory in this IDE.
    </div>
</div>   

<div id="RUN-help-modal" class="modal hide fade modal-80percent" tabindex="-1"> 
    <div class="modal-header no-padding"> 
        <div class="table-header"> <button type="button" class="close" data-dismiss="modal">&times;</button> &nbsp;
            <span class="modal-title">&nbsp;
                RUN
            </span>
        </div>
    </div>
    <div class="modal-body">
If this script is specified then a Run button shows up on student IDE which the user can execute. This script runs on the student work directory unlike Submission script which runs on submitted assignment.
    </div>
</div>    
<div id="BUILD-help-modal" class="modal hide fade modal-80percent" tabindex="-1"> 
    <div class="modal-header no-padding">     
        <div class="table-header"> <button type="button" class="close" data-dismiss="modal">&times;</button> &nbsp;
            <span class="modal-title">&nbsp;
                BUILD
            </span>
        </div>
    </div>
    <div class="modal-body">
If this script is specified then a Build button shows up on student IDE which the user can execute. This script runs on the student work directory unlike Submission script which runs on submitted assignment.
    </div>
</div>
<div id="Submission-help-modal" class="modal hide fade modal-80percent" tabindex="-1"> <div class="modal-header no-padding"> <div class="table-header"> <button type="button" class="close" data-dismiss="modal">&times;</button> &nbsp;
            <span class="modal-title">&nbsp;
                Submission
            </span>
        </div>
    </div>
    <div class="modal-body">
Submission script - this script is run when the student submits his/her assignment. You can use this script to either perform sanity checks like whether the submission compiles or can run either some or all of tests that will be used to grade the submission. Note: this script runs on last submitted assignment for the user. You can test this script by selecting Run Scripts => Submission. It will be executed in the work directory of this IDE.
    </div>
</div>   
<div id="LIB-help-modal" class="modal hide fade modal-80percent" tabindex="-1"> <div class="modal-header no-padding"> <div class="table-header"> <button type="button" class="close" data-dismiss="modal">&times;</button> &nbsp;
            <span class="modal-title">&nbsp;
                LIB            </span>
        </div>
    </div>
    <div class="modal-body">
$LIB - Use this directory to store resource files common to more than one assignment for this course. Assignment specific resources should be stored in $ASNLIB.
    </div>
</div>     
<div id="ASNLIB-help-modal" class="modal hide fade modal-80percent" tabindex="-1"> <div class="modal-header no-padding"> <div class="table-header"> <button type="button" class="close" data-dismiss="modal">&times;</button> &nbsp;
            <span class="modal-title">&nbsp;
                ASNLIB            </span>
        </div>
    </div>
    <div class="modal-body">
$ASNLIB - This is a directory where the teacher can store all the files that are needed to run scripts. This directory is not visible to or accessible by the students.
    </div>
</div>  
<div id="StarterCode-help-modal" class="modal hide fade modal-80percent" tabindex="-1"> <div class="modal-header no-padding"> <div class="table-header"> <button type="button" class="close" data-dismiss="modal">&times;</button> &nbsp;
            <span class="modal-title">&nbsp;
                StarterCode            </span>
        </div>
    </div>
    <div class="modal-body">
All the files in this directory are copied to the student work area when s/he starts working on the assignment. Once the student has started working on the assignment, any changes made to the starter code are not reflected in the student work area.
    </div>
</div>  

<div id="modal-table-download_from_ide" class="modal hide fade" tabindex="-1" style="height:200px">
  <div class="modal-header no-padding">
    <div class="table-header">
      <button type="button" class="close" data-dismiss="modal">
	<h3>Close</h3>
      </button>
      <span style="font-size:15px">Preparing ZIP File</span>
    </div>
  </div>
  
  <div class="modal-body no-padding" id="div-output-download_from_ide" style="height:200px;">
    
  </div>
</div>	

<div id="modal-table-od_terminal" class="modal hide fade" tabindex="-1" style="height:400px">
  <div class="modal-header no-padding">
    <div class="table-header">
      <button type="button" class="close" data-dismiss="modal">
	<h3>Close</h3>
      </button>
      <span style="font-size:15px">Terminal</span>
    </div>
  </div>
  
  <div class="modal-body no-padding" id="div-output-od_terminal" style="height:360px">
    
  </div>
</div>	
<div id="modal-table-report-db" class="modal hide fade" tabindex="-1" style="height:50% !important;" >
  <div class="modal-header no-padding">
    <div class="table-header">
      <button type="button" class="close" data-dismiss="modal">&times;</button>
      <span style="font-size: 15px">Database Credentials</span>
    </div>
  </div>

   <div id="report_db_div" class="modal-body no-padding">
     <p id="report_db_msg_box" style="margin-left: 10px !important; font-family: Courier;"></p>
   </div>
</div>
<div id="modal-table-report-aws" class="modal hide fade" tabindex="-1" style="height:80% !important;overflow: auto;" >
  <div class="modal-header no-padding">
    <div class="table-header">
      <button type="button" class="close" data-dismiss="modal">&times;</button>
      <span style="font-size: 15px" id="aws-modal-label">AWS Credentials</span>
    </div>
  </div>

   <div id="report_aws_div" class="modal-body0 no-padding">
     <p id="report_aws_msg_box" style="margin-left: 10px;height:60%; !important; font-family: Courier;overflow: auto;"></p>
   </div>
   <div class="modal-body0 no-padding">
     <p id="report_aws_progress_box" style="margin-left: 10px;height:60%; !important; font-family: Courier;overflow: auto;"></p>
   </div>

</div>
<script type="text/javascript">



function sshkeyboxdownload(s, f)
{
  var t = document.createElement('a');
  t.setAttribute('href', 'data:application/octet-stream;charset=utf-16le;base64,' + s);
  t.setAttribute('download', f);
  t.style.display = 'none';
  document.body.appendChild(t);
  t.click();
  document.body.removeChild(t);
}
function ssodownload(id)
{
  $.ajax({
    url: '../util/vcput.php',
    type: 'post',
    data: {
      a: 'ssodownload',
      data:id,
      step:201917    },
    success: function(data) {
      if( data.search(/^Error/) >=0 ){
        alert(data);
      } else {
        sshkeyboxdownload(data, 'ssourl.txt');
      }
    },
    fail: function(data) {
      alert('Failed to retrieve SSO URL');
    }
  });
}
  function sshkeyboxshow(){
     $("#sshkeybox").show();
     $("#sshkeyboxbtn").hide();
  }
  function clikeyboxshow(){
     $("#clikeybox").show();
     $("#clikeyboxbtn").hide();
  }
</script>
<div id="modal-table-report-buildclabs" class="modal hide fade" tabindex="-1" style="height:65% !important;" >
  <div class="modal-header no-padding">
    <div class="table-header">
      <button type="button" id="clabscls" class="close" data-dismiss="modal" onclick="endvm()" >&times;</button>
      <span style="font-size: 15px">Build Labs</span>
    </div>
    <br>
    <div class="control-group">
        <div class="controls">
          <div class="row-fluid">
            <div class="span3" style="margin-left: 20px;">
              <select id="clabstype" name="clabstype" class="span6" onchange="chgvmtype();" >
                  <option value="ct" selected>Container</option>
                              </select>
            </div>
                        
            <div class="span3" style="margin-left: 20px; display: none;">
              <select id="clabsamis" name="clabsamis" class="span6" >
              </select>
            </div>

            <div class="span6" style="float: left;width: 700px; border: 0px solid red; font-size: 13px; display:block">
                Systemuser <input id="systemuser" name="systemuser" class="span1" style="margin: 0px 20px 0px 3px; width:100px;" placeholder="" value="" type="text">
                Scriptuser <input id="scriptuser" name="scriptuser" class="span1" style="margin: 0px 20px 0px 3px; width:100px;" placeholder="" value="" type="text">
                Labuser <input id="labsuser" name="labsuser" class="span1" style="margin: 0px 20px 0px 3px; width:100px;" placeholder="" value="" type="text">
                Sudo <input class="span1" style="margin-right: 20px;" id="labssudo" name="labssudo"  type="checkbox">
            </div>
            
          </div>
        </div>
    </div>
  </div>
  <div id="report_buildclabs_div" class="modal-body no-padding" style="height:100%; !important;">
     <table class="table table-first-column-check table-hover" id="clabstbl" style="border-top: 0 !important;">
       <tr><th style="text-align:center;"><input class="span1" style="margin-right: 20px; width:40%" id="clabschk" onclick="chkvm();" type="checkbox"></th>
                    <th>Dockerfile </th>
           <th>Init File</th>
           <th>Hostname</th>
           <th>Port</th>
           <th>Script</th>
           <th>Persistent Workarea</th>
           <th>Status</th>
           <th></th>
               </tr>
            
     </table>
     <div style="margin-left:10px;" >
       <div id="clabsstatus" class="hidden-1">
         <p id="clabselapsed"><p><i class="icon-spin icon-spinner"></i>
         Build is in progress, it can take a few minutes to complete. 
       </div>
       <a class="btn btn-info btn-small" style="margin: 10px 10px 0px 10px !important;" id="clabsbtnadd" onclick="addvm()">Add</a>
       <a class="btn btn-info btn-small" style="margin: 10px 10px 0px 0px !important;" id="clabsbtndel" onclick="delvm()">Delete</a>
       <a class="btn btn-info btn-small" style="margin: 10px 10px 0px 0px !important;" id="clabsbtnbld"  onclick="bldvm()">Build</a>
       <a id ="saveVmBtn" class="btn btn-info btn-small" style="margin: 10px 10px 0px 0px !important;" onclick="savevm(false)">Save</a>
       <a class="btn btn-info btn-small" style="margin: 10px 10px 0px 0px !important;" onclick="clsvm()">Close</a>
     </div>
     <hr>
     <p id="report_buildclabs_msg_box" style="margin-left: 10px;height:100%; !important; font-family: Courier;"></p>
   </div>
</div>

<div id="modal-table-report-cdb" class="modal hide fade" tabindex="-1" style="height:40% !important;" >
  <div class="modal-header no-padding">
    <div class="table-header">
      <button type="button" class="close" data-dismiss="modal">&times;</button>
      <span style="font-size: 15px">Database Credentials</span>
    </div>
  </div>

   <div id="report_cdb_div" class="modal-body no-padding">
     <p id="report_cdb_msg_box" style="margin-left: 10px;height:30%; !important; font-family: Courier;"></p>
   </div>
</div>
<div id="modal-table-report-clabs" class="modal hide fade" tabindex="-1" style="height:70% !important;" >
  <div class="modal-header no-padding">
    <div class="table-header">
      <button type="button" class="close" data-dismiss="modal">&times;</button>
      <span style="font-size: 15px">Container Lab</span>
    </div>
  </div>

   <div id="report_clabs_div" class="modal-body no-padding">
     <p id="report_clabs_msg_box" style="margin-left: 10px;height:60%; !important; font-family: Courier;"></p>
   </div>
</div>
<div id="modal-table-report-web" class="modal hide fade" tabindex="-1" style="left:5%; width:90% !important; height:15% !important;" >
  <div class="modal-header no-padding">
    <div class="table-header">
      <button type="button" class="close" data-dismiss="modal">&times;</button>
      <span style="font-size: 15px">Web/WebSocket Details</span>
    </div>
  </div>

   <div id="report_web_div" class="modal-body no-padding">
     <p id="report_web_msg_box" style="margin-left: 10px !important; font-family: Courier; margin-top: 5px;"></p>
   </div>
</div>





<div class="modal hide fade" id="imageBuildModal" role="dialog" style="width:80%; min-width:400px; max-height:90%; height:auto;">
  <div id="imageBuildModal_dialog" class="modal-dialog "> <!-- jupyter-modal-dialog -->
    <div id="imageBuildModal_content" class="modal-content">

      <div id="imageBuildModal_header" class="modal-header">
        <h3>Build Container Image</h3>
        <h6>
          The build context will be the resource/lib directory; the Dockerfile also needs to be placed there.
        </h6>
        <h6>
          If you're building a new image, please select the base Vocareum docker image. Also, please make sure you do not have any "FROM" directive in your dockerfile.
        </h6>
      </div>

      <div id="imageBuildModal_body" class="modal-body" style="padding-bottom: 0px; max-height:250px">

        <div class="control-group row-fluid">
          <div class="span2" style="padding-top:3px">
            <label class="control-label"></label>
          </div>
          <div class="span5" id="imageBuildModal_select_div">
            <select id="imageBuildModal_select" name="imageBuildModal_select" style="width:100%">
              <option selected disabled hidden>Select image</option>
              <optgroup label="Create new image (select base)">
                <option value="img1" >Img1</option>
                <option value="img2" >Img2</option>
              </optgroup>
              <optgroup label="Use existing image">
                <option value="img3" >Img3</option>
                <option value="img4" >Img4</option>
              </optgroup>
            </select>
          </div>
          <div class="span4" id="image_build_name_div">
            <input id="image_build_name" name="image_build_name" class="span12" placeholder="Image name" type="text" maxlength="80" style="margin-bottom:0px">
          </div>
        </div>
<!--
        <div class="control-group row-fluid" id="image_build_name_div">
          <div class="span3" style="padding-top:3px">
            <label class="control-label">Image Name :</label>
          </div>
          <div class="span6">
            <input id="image_build_name" name="image_build_name" class="span12" placeholder="Course-unique name" type="text" maxlength="80" style="margin-bottom:0px">
          </div>
        </div>
-->        
        <div class="control-group row-fluid" style="display:block">
          <div class="span2" style="padding-top:3px">
            <label class="control-label">Base Image :</label>
          </div>
          <div class="span5" id="imageBuildModal_select_baseimage_div">
            <select id="imageBuildModal_select_baseimage" name="imageBuildModal_select_baseimage" style="width:100%" >
              <option value="img1" >Img1</option>
              <option value="img2" >Img2</option>
            </select>
          </div>
        </div>
        
        <div class="control-group row-fluid">
          <div class="span2" style="padding-top:3px">
            <label class="control-label">Dockerfile :</label>
          </div>
          <div class="span5">
            <input id="image_build_dockerfile" name="image_build_dockerfile" class="span12" placeholder="Dockerfile" type="text" maxlength="80" style="margin-bottom:0px">
          </div>
        </div>
        
        <div class="control-group row-fluid image-build-access" id="image_build_access_0" data-id="0">
          <div class="span2" style="padding-top:3px">
            <label class="control-label">Access :</label>
          </div>
          
          <div class="span1 row-fluid">
            <button class="icon-button" id="image_build_access_plus" style="padding-top:6px">
              <i class="icon-plus-sign icon-large"></i>
            </button>
          </div>
<!-- 
          <div class="span5 row-fluid">
            <div class="span5">
              <div class="span12">
                <input id="image_build_access_name_0" class="span12" data-id="0" placeholder="name" type="text" maxlength="80" style="margin-bottom:0px">
              </div>
            </div>
            <div class="span4">
              <div class="span12">
                <select id="image_build_access_type_select_0" style="width:100%; margin-bottom:0px" data-id="0">
                  <option selected disabled hidden value="0">Type</option>
                                      <option value="http">http</option>
                                  </select>
              </div>
            </div>
            <div class="span3">
              <div class="span12">
                <input id="image_build_access_port_0" class="span12" placeholder="port" type="text" maxlength="80" data-id="0" style="margin-bottom:0px">
              </div>
            </div>
          </div>
          
          <div class="span1 row-fluid">
            <button class="icon-button" data-id="0" style="padding-top:6px">
              <i class="icon-trash icon-large"></i>
            </button>
          </div>
 -->        

        </div>
       
        <!-- 
        <div class="control-group row-fluid">
          <div class="span3" style="padding-top:3px">
            <label class="control-label">Init File :</label>
          </div>
          <div class="span5">
            <input id="image_build_initfile" name="image_build_initfile" class="span12" placeholder="Script run after container start" type="text" maxlength="80" style="margin-bottom:0px">
          </div>
        </div>
        -->
        <!-- 
        <div class="control-group row-fluid">
          <div class="span3" style="padding-top:3px">
            <label class="control-label">User Name :</label>
          </div>
          <div class="span5">
            <input disabled id="image_build_user" name="image_build_user" class="span12" value="labsuser" type="text" maxlength="80" style="margin-bottom:0px">
          </div>
        </div>
        -->
        
      </div>

      <div class="modal-footer" id="imageBuildModal_footer" style="margin-top: 15px;padding: 15px 0 15px 0 !important; background-color:white">
        <div id="imageBuildModal_output">
          <div contenteditable="true" id="imageBuildModal_ta" style="overflow:scroll; height:150px; display:none; text-align:left !important; width:98%; border:0px; margin-bottom: 10px;padding-bottom: 10px;padding-top: 0px; padding-left: 6px; resize:none; border-bottom:1px solid lightgray;">
          </div>
        </div>

        <button id="imageBuildModal_ok" type="button" class="btn vocbtn2 vocbtn-status" style="min-width: 80px !important; display:none; margin-right:10px !important" data-dismiss="modal">Ok</button>
        <button id="imageBuildModal_cancel" type="button" class="btn vocbtn2 vocbtn-status" style="min-width: 80px !important; margin-right:10px !important" data-dismiss="modal">Cancel</button>
        <button id="imageBuildModal_build" type="button" class="btn vocbtn2 vocbtn-action" style="min-width: 80px !important; margin-right:10px !important" >Build</button>
        
      </div>

    </div>
  </div>
</div>

<div class="modal hide fade" id="quizModal" role="dialog" style="width:80%; min-width:400px; max-height:90%; height:auto;">
	<div id="quizModal_dialog" class="modal-dialog ">
		<div id="quizModal_content" class="modal-content">
			<div id="quizModal_header" class="modal-header">
				<h3>Generate Quiz (BETA)</h3>
			</div>
			<div id="quizModal_body" class="modal-body" style="padding-bottom: 0px; max-height:500px">
				<h6>
					Generating a quiz for this assignment will do the following:
				</h6>
				<ul>
					<li>
						<h6>
							Convert any markdown files in the work area into html and place them under asnlib/public/docs
						</h6>
					</li>
					<li>
						<h6>
							Copy over all non-markdown contents of work/docs to asnlib/public/docs
						</h6>
					</li>
					<li>
						<h6>
							Automatically generate rubrics for each question
						</h6>
					</li>
					<li>
						<h6>
							Flag this assignment for quiz grading. To remove this flag, generate quiz again with no markdown files in the work area.
						</h6>
					</li>
				</ul>
				<h6>
					There can be only one markdown file viewable per part. If multiple markdown files in different languages exist please ensure that they have the same scores and answers for grading consistency.
				</h6>
				<br>
				<div class="controls">
					<div class="row-fluid">
						<div class="span2">
							<label class="control-label">Show hints:</label>
						</div>
						<input name="show_hints" id="show_hints" class="ace ace-switch ace-switch-6" type="checkbox">
						<span class="lbl"></span>
					</div>
				</div>
				<div class="controls">
					<div class="row-fluid">
						<div class="span2">
							<label class="control-label">Multi-Tab/Exam Format:</label>
						</div>
						<input name="multi_tab" id="multi_tab" class="ace ace-switch ace-switch-6" type="checkbox">
						<span class="lbl"></span>
					</div>
				</div>
			</div>
			<div id="quizModal_footer" class="modal-footer" style="padding: 15px 0 15px 0 !important; background-color:white">
				<button id="quizModal_ok" type="button" class="btn vocbtn2 vocbtn-action" style="min-width: 80px !important; margin-right:10px !important">Generate</button>
				<button id="quizModal_cancel" type="button" class="btn vocbtn2 vocbtn-status" style="min-width: 80px !important; margin-right:10px !important" data-dismiss="modal">Cancel</button>
			</div>
		</div>
	</div>
</div>

<div id="modal-table-report-cluster" class="modal hide fade" tabindex="-1" style="left:10%; width:70% !important; height:15% !important;" >
  <div class="modal-header no-padding">
    <div class="table-header">
      <button type="button" class="close" data-dismiss="modal">&times;</button>
      <span style="font-size: 15px">Cluster Details</span>
    </div>
  </div>

   <div id="report_cluster_div" class="modal-body no-padding">
     <p id="report_cluster_msg_box" style="margin-left: 10px !important; font-family: Courier; margin-top: 5px;"></p>
   </div>
</div>

<div id="modal-table-report-submission" class="modal hide fade" tabindex="-1" style="height:50% !important;" >
  <div class="modal-header no-padding">
    <div class="table-header">
      <button type="button" class="close" data-dismiss="modal">&times;</button>
      <span style="font-size: 15px">Submission Report</span>
    </div>
  </div>

   <div id="report_submission_div" class="modal-body no-padding">
     <p id="report_submission_msg_box" style="margin-left: 10px !important; font-family: Courier;"></p>
   </div>
   
</div>

<div id="modal-table-report-grading" class="modal hide fade" tabindex="-1" style="height:50% !important;" >
  <div class="modal-header no-padding">
    <div class="table-header">
      <button type="button" class="close" data-dismiss="modal">&times;</button>
      <span style="font-size: 15px">Grading Report</span>
    </div>
  </div>
                        
   <div id="report_grading_div" class="modal-body no-padding">
     <p id="report_grading_msg_box" style="margin-left: 10px !important; font-family: Courier;"></p>
   </div>

</div>


<div id="modal-table-report-all-html" class="modal hide fade" tabindex="-1" >
  <div class="modal-header no-padding">
    <div class="table-header">

      <button type="button" class="close" data-dismiss="modal">&times;</button>
      <span id="modal-table-report-all-html-title">Grading Report</span>
      <a class="" target="_blank" href="" id="modal-table-report-all-html-link">
					<i style="margin-left:10px" class="icon-external-link icon-only white"></i>
			</a>
    </div>
  </div>

  <div class="modal-body" id="modal-table-report-all-html-body">
      <iframe id="modal-table-report-all-html-iframe" src='' width='100%' height='100%' frameborder='0'></iframe>
  </div>
</div>

                                          
<div id="modal-table-report-run" class="modal hide fade" tabindex="-1" style="height:50% !important;" >
  <div class="modal-header no-padding">
    <div class="table-header">
      <button type="button" class="close" data-dismiss="modal">&times;</button>
      <span style="font-size: 15px">RUN Report</span>
    </div>
  </div>
                        
   <div id="report_run_div" class="modal-body no-padding">
     <p id="report_run_msg_box" style="margin-left: 10px !important; font-family: Courier;"></p>
   </div>
</div>
<div id="modal-table-report-build" class="modal hide fade" tabindex="-1" style="height:50% !important;" >
  <div class="modal-header no-padding">
    <div class="table-header">
      <button type="button" class="close" data-dismiss="modal">&times;</button>
      <span style="font-size: 15px">BUILD Report</span>
    </div>
  </div>

   <div id="report_build_div" class="modal-body no-padding">
     <p id="report_build_msg_box" style="margin-left: 10px !important; font-family: Courier;"></p>
   </div>
</div>

<div id="modal-edit-vers" class="modal hide fade" tabindex="-1" style="height:70% !important;" >
  <div class="modal-header no-padding">
    <div class="table-header">
      <button type="button" class="close" data-dismiss="modal" onclick="location.href='main.php?m=editor&mode=s&asnid=201916&stepid=201917&version=0'">
        <h3>Close</h3>
      </button>
      <span style="font-size: 15px">Edit Versions <i id="versspinbox" class="icon-spin icon-spinner"></i></span>
    </div>
  </div>

   <div id="edit_vers_div" class="modal-body no-padding" style="margin-left: 10px !important; font-family: Courier;">
      <table id="verstable" class="table table-hover table-bordered" style="border-top: 0 !important;">
        <tr>
          <th>Version</th>
          <th>Name</th> 
          <th>Deleted</th>
          <th>Action</th>
        </tr>
         
     </table>
     <button type="button" class="btn btn-small btn-info vocbtn vocbtn-info" onclick="newvers();">Add a version</button>
   </div>
</div>

<div id="modal-git-actions" class="modal hide fade" tabindex="-1" style="height:50% !important;" >
  <div class="modal-header no-padding">
    <div class="table-header">
      <button type="button" class="close" data-dismiss="modal">
        <h3>Close</h3>

      </button>
      <span id="git_actions_lable" style="font-size: 15px">Git action status</span>
    </div>
  </div>

   <div id="git_actions_div" class="modal-body no-padding">
     <p id="git_action_msg_box" style="margin-left: 10px !important;"></p>
   </div>
</div>

<div id="grades-modal" class="modal hide fade" tabindex="-1" style="height:75% !important; overflow: hidden !important;" >
    <div class="modal-header no-padding">
        <div class="table-header">
            <button type="button" class="close" data-dismiss="modal">&times;</button>
            &nbsp;
            <span class="modal-title"></span>
        </div>
    </div>

    <div class="modal-body" style="max-height: none; height: 85%;">
        <iframe style="width: 100%; height: 100%; border: none;" src="about: blank"></iframe>
        <div id="spinner" class="center" style="width: 100%; height: 100%; position: absolute; top: 0; left: 0; background-color: #fff;">
            <div  style="width: 100%; height: 100%; position: relative;">
                <i class="icon-spinner icon-spin light-grey bigger-275" style="position: absolute; width: 42px; height: 42px; left: 0; right: 0; top: 0; bottom: 0; margin: auto;"></i>
            </div>
        </div>
    </div>
</div>

<div class="modal hide fade" id="jupyterModal" role="dialog" style="width:80%; min-width:400px; max-height:90%; height:auto;">
  <div id="jupyterModal_dialog" class="modal-dialog jupyter-modal-dialog">
    <div id="jupyterModal_content" class="modal-content">

      <div id="jupyterModal_header" class="modal-header">
        <h3>Jupyter</h3>
        <h6>
          This process will strip out the code marked with BEGIN_SOLUTION and BEGIN_HIDDEN_TESTS pragmas and copy the resulting notebook to the Starter Code.
        </h6>
        <h6>
          This will, optionally, extract nbgrader-style grading items and sync them with the Vocareum environment. New grading items will be added and existing ones with new scores will be updated. If no submissions have been made, an option to delete unused grading items will be available.
        </h6>
        <h6>
          A grading script will also be generated (with any existing grading script being overwritten) unless that option is de-selected. Additionally, there is an option to create a link to the resource directory in the Starter Code so that notebooks can access that area via './resource'.
        </h6>
      </div>

      <div id="jupyterModal_body" class="modal-body" style="padding-bottom: 0px;">
        <span id="jupyterModal_files" >
          Notebook(s) to be released:

          <table class="table table-first-column-check table-hover" style="border-top: 0 !important;margin-bottom:5px">
            <tr id="jupyter_file_1">
              <td class="jupyter-modal-td-file"><input class="span1 jupyter-modal-td-checkbox" type="checkbox" checked>
                File1.ipynb
              </td>
            </tr>
          </table>

          <br>
          This process will also generate the grading script
          <table class="table table-first-column-check table-hover" style="border-top: 0 !important;margin-bottom:5px">
            <tr id="jupyter_file_ow">
              <td style="text-align:left; border:0px; padding-bottom:0px"><input class="span1" style="margin-bottom:6px; width:20px" type="checkbox" checked>
                Overwrite grading script if it exists
              </td>
            </tr>
          </table>

        </span>
      </div>

      <div class="modal-footer" id="jupyterModal_footer" style="margin-top: 15px;padding: 15px 0 15px 0 !important; background-color:white">
        <div id="jupyterModal_output">
          <textarea id="jupyterModal_ta" style="height:100px; display:none; text-align:left !important; width:98%; border:0px; margin-bottom: 10px;padding-bottom: 10px;padding-top: 0px; resize:none; border-bottom:1px solid lightgray;">
          </textarea>
        </div>

        <button id="jupyterModal_ok" type="button" class="btn vocbtn2 vocbtn-action" style="min-width: 80px !important; display:none; margin-right:10px !important" data-dismiss="modal">Ok</button>
        <button id="jupyterModal_cancel" type="button" class="btn vocbtn2 vocbtn-status" style="min-width: 80px !important" data-dismiss="modal">Cancel</button>
        <button id="jupyterModal_release" type="button" class="btn vocbtn2 vocbtn-action" style="min-width: 80px !important; margin-right:10px !important" >Release</button>
        
      </div>

    </div>
  </div>
</div>

<div class="modal hide fade" id="jupyterClearOutputModal" role="dialog" style="width:65%; min-width:400px; max-height:90%; height:auto;">
  <div id="jupyterClearOutputModal_dialog" class="modal-dialog jupyter-modal-dialog">
    <div id="jupyterClearOutputModal_content" class="modal-content">

      <div id="jupyterClearOutputModal_header" class="modal-header">
        <h3>Jupyter</h3>
        <h6>
          This will clear out all the output arrays in the selected notebook(s) and save it in a copy; the original notebook will not be modified.
        </h6>
        <h6>
          This is useful when notebook sizes get very large due to debug print statements and they take a long time to load.
        </h6>
      </div>

      <div id="jupyterClearOutputModal_body" class="modal-body" style="padding-bottom: 0px;">
        <span id="jupyterClearOutputModal_files" >
          Notebook(s) to be released:

          <table class="table table-first-column-check table-hover" style="border-top: 0 !important;margin-bottom:5px">
            <tr id="jupyter_file_1">
              <td class="jupyter-modal-td-file"><input class="span1 jupyter-modal-td-checkbox" type="checkbox" checked>
                File1.ipynb
              </td>
            </tr>
          </table>

          <br>
          This process will also generate the grading script
          <table class="table table-first-column-check table-hover" style="border-top: 0 !important;margin-bottom:5px">
            <tr id="jupyter_file_ow">
              <td style="text-align:left; border:0px; padding-bottom:0px"><input class="span1" style="margin-bottom:6px; width:20px" type="checkbox" checked>
                Overwrite grading script if it exists
              </td>
            </tr>
          </table>

        </span>
      </div>

      <div class="modal-footer" id="jupyterClearOutputModal_footer" style="margin-top: 15px;padding: 15px 0 15px 0 !important; background-color:white">
        <div id="jupyterClearOutputModal_output">
          <textarea id="jupyterClearOutputModal_ta" style="height:80px; display:none; text-align:left !important; width:98%; border:0px; margin-bottom: 10px;padding-bottom: 10px;padding-top: 0px; resize:none; border-bottom:1px solid lightgray;">
          </textarea>
        </div>

        <button id="jupyterClearOutputModal_cancel" type="button" class="btn vocbtn2 vocbtn-status" style="min-width: 80px !important" data-dismiss="modal">Cancel</button>
        <button id="jupyterClearOutputModal_co" type="button" class="btn vocbtn2 vocbtn-action" style="min-width: 80px !important; margin-right:10px !important">Clear Output</button>
        <button id="jupyterClearOutputModal_ok" type="button" class="btn vocbtn2 vocbtn-action" style="min-width: 80px !important; display:none; margin-right:10px !important" data-dismiss="modal">Ok</button>        
      </div>

    </div>
  </div>
</div>


<div class="modal hide fade" id="clabsStateModal" role="dialog" style="max-height:50%; height:auto; width:50%; min-width:300px">
  <div id="clabsStateModal_dialog" class="modal-dialog jupyter-modal-dialog">
    <div id="clabsStateModal_content" class="modal-content">

      <div id="clabsStateModal_header" class="modal-header" style="padding-bottom:10px; border-bottom-color:#3e3e3e">
        <h3>Lab status</h3>
      </div>

      <div id="clabsStateModal_body" class="modal-body" style="padding-bottom: 15px; border-bottom:1px solid; border-bottom-color:#3e3e3e">
        <span id="clabsStateModal_vms" >
          <table class="table table-first-column-check table-hover" style="margin-bottom:0px" border=1 frame=void rules=rows>
            <tr id="vm_1" class="clabs-state-modal-tr-vm">
              <td class="clabs-state-modal-td-vm span6">
                Linux-1
              </td>
              <td class="clabs-state-modal-td-state span6">
                shutting down <i id="vm_1_spinbox" class="icon-spin icon-spinner"></i>
              </td>
            </tr>
            <tr id="vm_2" class="clabs-state-modal-tr-vm" >
              <td class="clabs-state-modal-td-vm span6">
                Linux-2
              </td>
              <td class="clabs-state-modal-td-state span6">
                shutting down <i id="vm_2_spinbox" class="icon-spin icon-spinner"></i>
              </td>
            </tr>
          </table>
          <br>

        </span>
      </div>

      <div class="modal-footer" id="clabsStateModal_footer" style="padding: 15px 0 15px 0 !important; background-color:white;"> <!--  border-top-color:#3e3e3e"> -->

        <div id="clabsStateModal_msg">
          <textarea id="clabsStateModal_ta" style="height:50px; display:none; text-align:left !important; width:98%; border:0px; margin-bottom: 10px;padding-bottom: 10px;padding-top: 0px; resize:none; border-bottom:1px solid; border-bottom-color:#3e3e3e;">
          </textarea>
        </div>

        <button id="clabsStateModal_ok" type="button" class="btn vocbtn2 vocbtn-action" style="min-width: 80px !important; margin-right:10px !important" data-dismiss="modal">Ok</button>
      </div>

    </div>
  </div>
</div>

<!-- end of modals -->

                            

<script>

var left_panel_instructions = 0;
$('#detailspinbox').hide();
$('#versspinbox').hide();

$('#showfullscreen').on('click', function()
	    {
	              var fullbox = document.getElementById("editordiv");

	              if (!document.mozFullScreen && !document.webkitFullScreen) {
	              if (fullbox.mozRequestFullScreen) {
	                  fullbox.mozRequestFullScreen();
	              } else {
	                  fullbox.webkitRequestFullScreen(Element.ALLOW_KEYBOARD_INPUT);
	              }
	            } else {
	              if (document.mozCancelFullScreen) {
	                document.mozCancelFullScreen();
	              } else {
	                document.webkitCancelFullScreen();
	              }
	            }
	    });



	var gloss_theme = 0;
	var editor_content_change = 0;
	var viewer_last_fname = null;
	var viewer_last_fpath = null;
	var viewer_first_fpath = "/";

 

// var for copypaste feature
var copyPasteClipboard = false;
function saveCBClipboard(path, paths=[])
{
    $.ajax({
      url: "../util/vcput.php",
      type: "post",
      data: {
        a: "saveClipboard",
        userid:1165740,
        asnid:201917,
        mode:'s',
        version:'0',
        path:path,
        paths: JSON.stringify(paths)
      },
      success: function(data) {
        var ap = data.search(/voc::/);
        var bp = data.search(/::voc/);
        if(ap>=0 && bp>=0 && bp>ap){
          show_voc_gritter(false, data.substring(ap+5, bp-ap-5), false);
        } else {
          show_voc_gritter(false, "Copied", false);
          copyPasteClipboard = true;
        }
        return false;
      }
    });
}
var pasteprogress=0;
function pasteCB(type, path, source, msg, confirm) {
      /* default value to be used for confirm - better to do it this way
       * than doing it in the funtion signature otherwise some browser
       * versions e.g. IE, Edge has problem showing IDE page
       */
      if(confirm === undefined) {
        confirm = false;
      }
      if( pasteprogress>0 ){
        alert('Paste-workarea is in progress, please wait until the prior operation finishes.');
        return false;
      }
      pasteprogress++;
      var stepstr = "&stepid=201917";
      var url = "../util/vcsave.php?asnid=201916"+stepstr+"&mode=s&version=0&type="+type+(confirm? '&confirm=1' : '') + "&vm=34.209.4.84&labtype=0";
      $.ajax({
        type: 'POST',
        url: url,
        async: false,
        data: {filepath: "./"+path , sourcepath: "./"+source}
        })
          .done(function(ret_val) {
                  if(pasteprogress) --pasteprogress;
                  if (ret_val.indexOf('<ERROR:INVALID_SESSION>') !== -1) { // invalid session
                      refreshNewSessionPage();
                  }
                  if (ret_val.indexOf('<ERROR:') !== -1) { // error
                    show_voc_gritter(false, ret_val.substring(7), true);
                  } else {
                    show_voc_gritter(false, msg, false);
                    refreshFileTree(true, true);
                  }

          })
             .fail(function(ret_val) {
                  if(pasteprogress) --pasteprogress;
                  show_voc_gritter(false, "Paste-workarea failed. Please check your internet connection", true);
          });
          return true;
}

</script>

<script type="text/javascript">	
    function isSaveNeeded() { return false; }
    function indicate_build_done() {}
    function refreshSubTree() {}
    function refreshFileTree(a, b) {
    };
    function fillLastSubmissionFiles(filelist) {
            var latestTag = "LatestSubmission";
            var tmpList = filelist.split(/\.\//);
            var str = "";
            tmpList.forEach(function (item) {
                if (item.startsWith(latestTag + "/")) {
                    var fname = item.substring(latestTag.length + 1);
                    if (fname.charAt(0) != ".") {
                      str = str + '<i class="icon icon-angle-right" style="margin-right:2px"> </i>'+ fname +'<br>';
                    }
                }
            })
            if (str == "") str = "Not found";
            $('#lastSubmissionFiles').html(str);    
    }
    function getLatestSubmissionList() {
      return;
              var stepstr = "&stepid=201917";

        $.ajax({
            url: "../util/vcprojapi.php?t=getFileTree&asnid=201916"+stepstr+"&mode=s&name=tree1&version=0",
            context: document.body
        }).done(function(ret_val) {
            if (ret_val.indexOf('<ERROR:INVALID_SESSION>') !== -1) { // invalid session
                refreshNewSessionPage();
            }
            eval(ret_val);
            fillLastSubmissionFiles(tree1_files);
        }).fail(function(e) {
            $('#lastSubmissionFiles').html('<i class="icon icon-angle-right" style="margin-right:2px;color:red;" > The list is temporarily unavailable</i>');
        });
          };

$( document ).ready(function() {

          var jp_ht = $('#editordiv').height() - $('#idenav').height() - 7;
          $("#jupyterIframeParent").height(jp_ht); 
          
                        getLatestSubmissionList();
                  
});

</script>
 


  <script src="../shared/platform/platform.js"></script>

		<script type="text/javascript">	

			var save_in_progress = false;
                        var fileUploadListener = null;
 

					
			jQuery(function($){

          $(function() {

          });

          

	function getFilePathStr(unencoded_filepath, encodeIt)
        {
          if (unencoded_filepath.length <= 1)
          {
            return ""; 
          } 
          // if starting with "./work", remove it
          // not sure what to do about asnlib, etc. right now
          fp = unencoded_filepath.replace(/^\.\/work\//, "");
          return "&selectedfile=" + ((encodeIt == true) ? encodeURIComponent(fp) : fp);
        }
 

$('#video-viewer-modal').on('hidden.bs.modal', function (e) {
    $('#video-viewer-modal-div').html("");  
})

			$( document ).ready(function() {

		$.extend($.gritter.options, {
			position: 'top-left'
		});
		
			
	                        $('.navbar').hide();
                   
                    			
			});
	
			
  
  
  
  
                     
                          //
                          // If we have an embedded terminal, we want to execute the BUILD and RUN
                          // commands om the terminal (not batch) - among other things, it allows
                          // the run to be interactive
                          // Of course, BUILD does not need to be handled this way, but it's better
                          // to be consistent
                          //
                          function vcGetCmdStr(data)
                          {
                            var st = data.search(/@vocbegin@/);
                            var ed = data.search(/@vocend@/);
                            if(st>=0 && ed>=0 ) return data.substring(st+10, ed);
                            else                return '';
                          }
                          function doTerminalBuildRun($type)
                          {
                                                        return false;
                          }


    $('#shellinput').keyup(function(e) {
        if(e.keyCode == 13) {
            $('#shellbutton').trigger("click");
        }
    });


    $(".editbutton").click(function() {
      editVers();
    });
    $(".viewbutton").click(function() {
      var type = $(this).data("command");
      setView(type);
    });
    $(".togglebutton").click(function() {
      var type = $(this).data("command");
      setView(type);
    });
    $(".appbutton").click(function() {
      var type = $(this).data("command");
      launchApp(type);
    });
    $(".appstopbutton").click(function() {
      stopApp();
    });
    $(".newtabviewbutton").click(function() {
      var type = $(this).data("command");
      setNewTabView(type);
    });
 
    $(".jupyterbutton").click(function() {
      var type = $(this).data("command");
      if (type == "launch")
      {
        setView(2);
      }
      else if (type == "release")
      {
        processNotebooks(type);
      }
      else if (type == "clear_output")
      {
        processNotebooks(type);
      }
    });

    $( ".commandbutton" ).click(function() {		
	var $type = $(this).data("command");	
        processThisCommand($type);
    });
    function processThisCommand($type){
	var filepath = viewer_last_fpath;				
	if (!viewer_last_fpath) filepath = viewer_first_fpath;
						    
				

        if (doTerminalBuildRun($type))
        {
                return;
        }
        
	if (isSaveNeeded()) {					
		voc_save(true, "Saving");
	}
	executeThisCommand($type, filepath, true);
    }
    function executeThisCommand($type, filepath, isfirst)
    {
        if ( ($type=='RUN' || $type=='BUILD') && isfirst) { // activity icon only for RUN as of now
        	updateRunIcon($type, true);
        }

        if( save_in_progress ) {
          // delay execution
          window.setTimeout(function(){ executeThisCommand($type, filepath, false); } , 300);
          return;
        }
	var asyncCommand = false;
	var asyncPollUrl = null;
        var scheduleMode = false;
	if ($type=="Submission" || $type=="Grading" || $type=="RUN" || $type=='BUILD') {
		asyncCommand = true;
	}
        if ($type == "Grading") {
          scheduleMode = true;
        }
				
        var unencoded_filepath = filepath;
	filepath = encodeURIComponent(filepath);
				
        if (!asyncCommand) {
		$('#buildtextarea').html("<i class=\"icon-spin icon-spinner\"></i>&nbsp; Waiting for output ..");
	}
        // if the Asn Grading Rule is MAX, then we need to make sure we pass the correct rule (ontime/late) here
        // otherwise setting-grades-via-submission will not work
        
        var stepstr = "&stepid=201917" + "&auto_calc_grading=1";

        var filepathstr = "";
        if (($type == 'BUILD') || ($type == 'RUN')) {
          filepathstr = getFilePathStr(unencoded_filepath, true);
        }

        
        if ($type == 'SHELL') {
            var input = encodeURIComponent($('#shellinput').val());
            var url =  "../domains/common_submit.php?loc=3&id=201916&version=0&type="+$type+stepstr+"&input="+input+"&dryrun=1&useworkarea=1"+filepathstr;
        } else {
        
	      if ($type == "Grading") {
                var url = "../domains/common_submit.php?loc=6&id=6816586&version=0"+stepstr+"&type="+$type+filepathstr;
              } else {
                              var url = "../?&file0="+filepath+"&asnid=201916";
                            }
			
	      if (asyncCommand) {
	        asyncPollUrl = url + "&getstatus=1";
        	url = url + "&async=1";
              }
	      if (scheduleMode) {
        	url = url + "&scheduleMode=1";
              }
        } // else SHELL
                var msg = "Executing '" + $type + "' script...";
                if (!asyncCommand) { 
                                    var htmlMsg = "<pre>" + msg + "</pre>";
                    $('#buildtextarea').html(htmlMsg);
                                }
                $.post(url,{code0: ""},function(ret_val)
                {
                  if (ret_val.indexOf('<ERROR:INVALID_SESSION>') !== -1) { // invalid session
                    refreshNewSessionPage();
                  }

                                      if ($type == 'Grading') {
                                            if (asyncCommand) {
                        reportsToOpen = true;
                        asyncCheckReportPeriodic($type, asyncPollUrl, false, false, maxPollTv, Math.floor(Date.now() / 1000));
                      }
                                            return;
                    }
                                    // show_voc_gritter(false, $type+" done", false);

                  data = ret_val;
                  if (!asyncCommand) {
                    if ($type=='RUN' || $type=='BUILD' ) { // activity icon only for RUN as of now
                      updateRunIcon($type, false);
                    }
                                      consolePrint(htmlMsg + "\n" + data);
                                    }

                  indicate_build_done();
                  build_in_progress = false;
                  
                  
                                        wasUnsubmitted = false;
                      if ($('#workunsubmitted').is(":visible")) {
                          wasUnsubmitted = true;
                      } 
                                                          refreshFileTree(false, ($type != "Submission"));
                                             	  refreshSubTree();
                  	                        if (false && wasUnsubmitted) {
                          window.setTimeout(function(){ $('#workunsubmitted').show(); } , 500);
                      }
                                    
                  if (asyncCommand) {
                       
                      
                                                                                          consolePrint('Waiting for '+$type+' report');
                                                    
                                                  
                                            reportsToOpen = true;
                      var token = false;
                      var chksubmit = false;
                      var chkgrade = false;
                                            asyncCheckReportPeriodic($type, asyncPollUrl, chksubmit, chkgrade, maxPollTv, Math.floor(Date.now() / 1000));
                  }                 
                  
                });
						
		}

        var $gradesModal = $('#grades-modal'),
            $gradesIframe = $gradesModal.find('iframe'),
            $gradesSpinner = $gradesModal.find('#spinner');
				
        $gradesModal
            .on('show', function() {
                $gradesSpinner.removeClass('hidden-1');
                var url = 'main.php?m=grades_review&modalMode=1&asnId=201916&stepid=201917&userid=1165740';
                                $gradesIframe.prop('src', url);
            });

        $gradesIframe.on('load', function() {
            $gradesSpinner.addClass('hidden-1');
        });

        function autoPeerReviewStart() {
          var data = "";
	  var urlval = '../util/vcprojapi.php?t=auto_peer_review_end_exam&type=peer_review&asnid=' + 201916 + '&userid=' + 1165740;
          $.ajax({
                 type: "POST",
                 url: urlval,
                 data: data
          })
          .done(function(ret_val) {
                if (ret_val.indexOf('<ERROR:INVALID_SESSION>') !== -1) { // invalid session
                  console.log(ret_val + " Invalid session ");
                  // refreshNewSessionPage();					
                }
                resp = jQuery.parseJSON(ret_val);
                if (resp.status !== 'success') {
                  show_voc_gritter(true, 'Peer review participation failed. <br>' + resp.message, true);
                } else {
                  $("#lisubmit").addClass('hidden');
                  show_peer_review_confirm_dialog = false;
                  $gradesModal.modal('show');
                }
            });
        }

        $('#gradesIdeBtn')
            .on('click', function() {
          var qstr = "Please make sure that you have submitted your work. You will not be allowed to make any more submissions once you start your participation in the peer review process. Are you sure you want to continue?";
          if (auto_peer_review_mode && show_peer_review_confirm_dialog)
          {
           bootbox.dialog(qstr,
                         [{
                           "label" : "Yes",
                           "class" : "btn vocbtn-ac vocbtn-action",
                           "callback": function() {
                              autoPeerReviewStart();
                           }
                         },
                          {
                            "label" : "Cancel",
                            "class" : "btn vocbtn-ac vocbtn-status"
                          }]
                   );
          } 
          else
          {
            show_grades(advance_features, 0);
          }
        });

        function endExam() {
          var data = "";
	  var urlval = '../util/vcprojapi.php?t=auto_peer_review_end_exam&type=end_exam&asnid=' + 201916 + '&userid=' + 1165740;
          $.ajax({
                 type: "POST",
                 url: urlval,
                 data: data
          })
          .done(function(ret_val) {
                if (ret_val.indexOf('<ERROR:INVALID_SESSION>') !== -1) { // invalid session
                  console.log(ret_val + " Invalid session ");
                  // refreshNewSessionPage();					
                }
                resp = jQuery.parseJSON(ret_val);
                if (resp.status !== 'success') {
                  show_voc_gritter(true, 'End exam failed. <br>' + resp.message, true);
                } else {
                  $("#lisubmit").addClass('hidden');
                  $("#end-exam-group").addClass('hidden');
                  $("#examTimer").addClass('hidden');
                  show_voc_gritter(true, resp.message, true);
                }
            });
        }

        $('#endExamIdeBtn')
            .on('click', function() {
          var qstr = "Please make sure that you have submitted your work. You will not be allowed to make any more submissions once you end the exam. Are you sure you want to continue?";
          bootbox.dialog(qstr,
                         [{
                           "label" : "Yes",
                           "class" : "btn vocbtn-ac vocbtn-action",
                           "callback": function() {
                              endExam();
                           }
                         },
                          {
                            "label" : "Cancel",
                            "class" : "btn vocbtn-ac vocbtn-status"
                          }]
          );
        });
       var lastUpdateTime = 'Monday Oct 05 2020 00:46:34 GMT-0700 (PDT)';
       function syncAsnNow(tonew)
       {
           var d = new Date();
           lastUpdateTime = d.toString();
           $('#updatebtntext').html('<i class="icon-spin icon-spinner"></i>Update');
           var jqxhr = $.ajax('../util/vcput.php?a=syncAsn&stepid=201917'+(tonew? '&isnew=1' : ''))
                 .done(function(data, textStatus, jqXHR) {
                   var ap = data.indexOf('VOCERR::');
                   var bp = data.indexOf('::VOCERR');
                   if(ap>=0 && bp>=0 && bp>ap ){
                     show_voc_gritter(true, 'Update failed:' + data.substring(ap+8, bp), true);
                     $('#updatebtntext').html('Update*');
                   } else {
                     $('#updatebtntext').html('Update');
                   }
                 })
                 .fail(function(data, textStatus, jqXHR) {
                   $('#updatebtntext').html('Update');
                 });
       }
       $('#awsbtn').click(function(){
         launchAws(-1);
       });
       $('#c9btn').click(function(){
         launchC9();
       });
       $('#appsbtn').click(function(){
    	   launchAppStream();
         });
       function launchStudentView()
       {
    	   var newide = false;
    	   var appside = false;
    	   var awside = false;
    	   var stulabs = false;
    	   var appsallowed = false;
    	   
         $.ajax({
           url: '../util/vcput.php?a=resetStudentView&stepid=201917&version=0',
           type: 'get',
           success: function(data) {
               if (appside || awside) {
            	   window.open( "main.php?m=clabide&mode=s&asnid=201916&stepid=201917&ownerid=1165740&permit=7&tide=1&version=0&hideNavBar=1");
               }
               else if (stulabs || appsallowed) {
            	   window.open( "main.php?m=clabide&mode=s&asnid=201916&stepid=201917&ownerid=1165740&permit=7&tide=1&version=0&hideNavBar=1");
               }
               else if (newide) {
            	   window.open( "main.php?m=clabide&mode=s&asnid=201916&stepid=201917&ownerid=1165740&permit=7&tide=1&version=0&hideNavBar=1");
               }
               else {
                 window.location = "main.php?m=editor&mode=s&asnid=201916&stepid=201917&ownerid=1165740&permit=7&tide=1&version=0&hideNavBar=1";
               }
             //window.location = "main.php?m=editor&mode=s&asnid=201916&stepid=201917&ownerid=1165740&permit=7&tide=1&version=0&hideNavBar=1";
           }
         });
       }
       function launchClabide()
       {
         $.ajax({
           url: '../util/vcput.php?a=resetStudentView&stepid=201917&version=0',
           type: 'get',
           success: function(data) {
        	   window.open( "main.php?m=clabide&mode=s&asnid=201916&stepid=201917&ownerid=1165740&permit=7&tide=1&version=0");
             //window.location = "main.php?m=clabide&mode=s&asnid=201916&stepid=201917&ownerid=1165740&permit=7&tide=1&version=0";
           }
         });
       }
       var vcPartUpdated = 1;
       $('#studentviewbtn').click(function(){
         if (isSaveNeeded()) { voc_save(true, "Saving");}
           if (vcPartUpdated != 0) {
             launchStudentViewUpdateWarning();
             return;
           }
           // maybe some other action udated it - like publich in a different window
           var jqxhr = $.ajax({
             type: "POST",
             url: '../util/vcput.php?a=checkForAsnUpdate',
             data: { partid: 201917 }
           })
           .done(function(data, textStatus, jqXHR) {
             try {
               var result = JSON.parse(data);
               if (result['status'] == 'Error') {
                 console.log("Error getting update check results: " + result['message']);
                 launchStudentViewUpdateWarning();
               }
               else {
                 if (result['updated'] == 0) {
                   bootbox.dialog('You must click the Update button at least once for the Student View to be available<br><br>',
                                  [{
                                    "label" : "Ok",
                                    "class" : "btn vocbtn-ac vocbtn-action"
                                  }]
                   );
                 }
                 else {
                   vcPartUpdated = 1;
                   launchStudentViewUpdateWarning();
                 }
               }
             }
             catch(err) {
               console.log("Exception getting update check results: " + err);
               launchStudentViewUpdateWarning();
             }
           })
           .fail(function(data, textStatus, jqXHR) {
             console.log("Failed getting update check results: " + err);
             launchStudentViewUpdateWarning();
           });
       });
            
       function launchStudentViewUpdateWarning() {
                  bootbox.dialog('If you made any changes in the Teacher View, they need to be committed with the Update button before they can be available to the Student View<br><br>',
                 [{
                   "label" : "Continue",
                   "class" : "btn vocbtn-ac vocbtn-action",
                   "callback": function() {
                      launchStudentView();
                   }
                 },
                 {
                   "label" : "Cancel",
                   "class" : "btn vocbtn-ac vocbtn-status"
                 }]
           );
                }

       $('#clabidebtn').click(function(){
           if (isSaveNeeded()) { voc_save(true, "Saving");}
                      bootbox.dialog('If you made any changes in the Teacher View, they need to be committed with the Update button before they can be available to the Student View<br><br>',
                   [{
                     "label" : "Continue",
                     "class" : "btn vocbtn-ac vocbtn-action",
                     "callback": function() {
                    	 launchClabide();
                     }
                   },
                   {
                     "label" : "Cancel",
                     "class" : "btn vocbtn-ac vocbtn-status"
                   }]
             );
                  });
       $('#teammemberbtn').click(function(){
         if (isSaveNeeded()) { voc_save(true, "Saving");}
         window.location = "main.php?m=editor&asnid=201916&stepid=201917";
       });
       $('#teacherviewbtn').click(function(){
         if (isSaveNeeded()) { voc_save(true, "Saving");}
         window.location = "main.php?m=editor&mode=t&asnid=201916&stepid=201917";
       });

       $('#merge_asn_btn').click(function() {
         var type = "merge";
         $('#' + type + '-output').hide();
         $('#' + type + '-ok').hide();
         $('#' + type + '-cancel').show();
         $('#' + type + '-action').show();
         $('#' + type + '-sel-course').trigger('change');
         $('#' + type + 'Assignment').css('height', 'auto');
         $('#' + type + 'Assignment').modal();
       });
       $("#merge-sel-course").change(function() {
         var type = "merge";
         $.post("../util/import_assignment.php",{courseid: $(this).val(), tgtbasnid: 201916, type: type, functionName: 'get_assignment_table'}, function(output) {
           output = JSON.parse(output);
           $('#' + type + '-table').html(output.tbldata);
         })
       });

       $('#merge-table').on('click', '.merge-modal-td-checkbox-all', function() {
         if (this.checked) {
           // check all checkboxes
           $(".merge-modal-td-checkbox-one").prop("checked", true);
           // $('#merge-table .merge-modal-td-checkbox-one').prop("checked", true);
         } else {
           // uncheck all
           $(".merge-modal-td-checkbox-one").prop("checked", false);
           // $('#merge-table .merge-modal-td-checkbox-one').prop("checked", false);
         }
       });

       var mergeAsnTimer;
       function showMergeAnsDots()
       {
         text = $('#merge-output').text();
         $('#merge-output').text(text + '.');
         mergeAsnTimer = setTimeout(showMergeAnsDots, 1000);
       }

       $('#merge-action').click(function() {
         // get the id's of all the selected assignments
         var basnids = [];
         $(".merge-modal-td-checkbox-one").each(function() {
           if (this.checked) {
             basnids.push(this.dataset.asnid);
           }
         });
         console.log(basnids);

         // if nothing selected, give an error and stay open
         if (basnids.length == 0) {
           bootbox.dialog("<br>No assignment selected. Please select at least one assignment to merge.",
                          [{
                            "label" : "Ok",
                            "class" : "btn vocbtn-ac vocbtn-action"
                          }]
           );
         } else {
           $('#merge-ok').show();
           $('#merge-cancel').hide();
           $('#merge-action').hide();
           $('#merge-output').show();
           $('#merge-output').text("Merging assignment(s)...");
           mergeAsnTimer = setTimeout(showMergeAnsDots, 1000);

           var src_course = $("#merge-sel-course").val();
           // do the actual merge
           var jqxhr = $.ajax({
             type: "POST",
             url: '../util/vcput.php?a=mergeAssignments',
             data: { tgt_part: 201917, tgt_base: 201916, tgt_version: 0, src_course: src_course, asnuserid: 1165740, workarea: "/mnt/data2/students/ccc_v1_w_NmY0_110384/asn201916_23/asn201917_1/work",basnids: basnids }
           })
           .done(function(data, textStatus, jqXHR) {
             console.log(data);
             clearTimeout(mergeAsnTimer);
             try {
               var result = JSON.parse(data);
               if (result['status'] == 'Error') {
                 $('#merge-output').text("Error merging assignments: " + result['output']);
               }
               else {
                    $('#merge-output').text(result['output']);
                    $('#merge-output').animate({
                      scrollTop:$('#merge-output')[0].scrollHeight - $("#merge-output").height()
                    }, 1000);
               }
             }
             catch (err) {
               $('#merge-output').text("Exception merging assignments: " + err);
             }
           })
           .fail(function(data, textStatus, jqXHR) {
             clearTimeout(mergeAsnTimer);
             $('#merge-output').text("Error merging assignments");
           });
                      
           //$('#mergeAssignment').modal("hide");
         } 
       });
                          
       $('#mergeAssignment').on('shown.bs.modal', function() {
         $('#merge-sel-course').chosen();
         $("#merge-sel-course").change();
       });

       function confirmCseVersion(started,verstr)
       {
         var actstr = '';
         var utime = lastUpdateTime;
         var qstr = 'Are you sure you want to update?<br>' + (utime==''? '' : 'Last updated: ' + utime + '<br>') + verstr;
         if(started){
           qstr += '<br><strong>NOTE:</strong> Some students have started the assignment. <br>';
         }
         bootbox.dialog(qstr,
                         [{
                           "label" : "Yes",
                           "class" : "btn vocbtn-ac vocbtn-action",
                           "callback": function() {
                              syncAsnNow(false);
                           }
                         },
                         {
                           "label" : "Cancel",
                           "class" : "btn vocbtn-ac vocbtn-status"
                         }]
                   );
       }
       function cseVersDesc(ver)
       {
          //'{.vocconfig' + ver.versiondata.vocconfig +
          //', lib' + ver.versiondata.lib +
          //', asnlib' + ver.versiondata.asnlib +
          //', scripts' + ver.versiondata.scripts +
          //', startercode' + ver.versiondata.startercode + '}';
         if(ver.versiondata.asnlib.length==0) return ' initial';
         else                                 return ver.versiondata.asnlib.replace('.', ' ');
       }
       function updateCseVersion(data, v)
       {
         var ver = false;
         var verstr = '';
         if( v ){
           try {
             ver = JSON.parse(v);
             if( !ver ||  !ver.hasOwnProperty('versiondata') ){
               ver = false;
             }
           } catch(e){
             ver = false;
             alert('error:' + v);
           }
         }
         if( ver ){ // there is a prior version
           verstr = '';//'Current version:' + cseVersDesc(ver) + '<br>';
         }
         //check if there is student who started the assignment
                var apos = data.search('started::');
         var bpos = data.search('::started');
         if(apos>=0 && bpos>=0 && bpos>apos && data.substring(apos+9, bpos)=='yes'){
           confirmCseVersion(true,verstr);
         } else 
                {
           confirmCseVersion(false,verstr);
         }
         return false;
       }
       
       
       $('#quizModal_ok').click(function() {
           var multi_tab;
           var show_hints;
    	   $('#multi_tab').prop('checked') ? multi_tab = 1 : multi_tab = 0;
    	   $('#show_hints').prop('checked') ? show_hints = 1 : show_hints = 0;
    	   $('#quizModal').modal('hide');
    	   $('#quiztext').html('<i class="icon-spin icon-spinner"></i>Generate Quiz');
    	   $.when(generateQuiz(multi_tab, show_hints)).done(function(a1) {
    		   refreshFileTree(false, true);
    		   $('#quiztext').html('Generate Quiz');
    	   });
       });

       function generateQuiz(multi_tab, show_hints) {
		  return $.ajax('../util/vcput.php?a=generateQuizAjax'
	              + '&courseid='  + 16642	              + '&stepid='    + 201917	              + '&asnuserid=' + 1165740	              + '&multi_tab=' + multi_tab
	              + '&show_hints=' + show_hints)
	          .done(function(data, textStatus, jqXHR) {
	          	  console.log(data);
	              try {
		              // alert(data);
	            	  var result = JSON.parse(data);
                      if (result['status'] == 'Error') {
                    	  show_voc_gritter(false, "Error generating quiz: " + result['msg'], true);
                      } else {
                    	  show_voc_gritter(false, "Quiz successfully generated", false);
                      }
	              } catch(err) {
	                alert("Exception generating quiz: " + err);
	              }
	          })
	          .fail(function(data, textStatus, jqXHR) {
	          		alert("Error generating quiz");
	          });
		}
       
       var jupyterOnDemandClearOutputStr = "\
           <h3>Jupyter</h3>\
           <h6>\
             This will clear out all the output arrays in the selected notebook(s) and save the modified notebook(s) under new name(s); the original(s) will not be modified.\
           </h6>\
           <h6>\
             This is useful when notebook sizes get very large due to debug print statements and they take a long time to load.\
           </h6>\
       ";
       var jupyterAutoClearOutputStr = "\
           <h3>Jupyter</h3>\
           <h6>\
             At least one of your notebooks is very large; perhaps due to debug print statements in the outputs. If you are experiencing long load times, you can use choose to clear the output arrays from you notebooks(s).\
           </h6>\
           <h6>\
             The modified notebook(s) will be saved with new name(s); the original notebook(s) will not be modified.\
           </h6>\
       ";                         

       function showJupyterClearOutputModal(nbsWsz, type)
       {
         if (nbsWsz.length == 0)
         {
           alert("Jupyter: No notebooks found in the workarea");
           return;
         }

         var max_size_in_kb = 10 * 1000;
         var data = ''
                  + '<table class="table table-first-column-check table-hover" style="border-top: 0 !important;margin-bottom:5px">'
         ;
         for (var i = 0; i < nbsWsz.length; i++)
         {
           nba = nbsWsz[i];
           data += '<tr id="jupyter_file_' + i + '">';

           sz = nba[1];
           if (sz > 1000)
           {
             sz = Math.round(sz / 1000);
             sz = sz + ' MB';
           }
           else
           {
             sz = sz + ' KB';
           }

           data += '<td class="jupyter-modal-td-file"><input id="jupyter_co_file_cb_' + i + '" class="span1 jupyter-modal-td-checkbox" type="checkbox" ';
           if (nba[1] >= max_size_in_kb)
           {
             data += 'checked>';
           }
           else
           {
             data += '>';
           }
           data += nba[0] + ' [' + sz + ']';
           data += '</td></tr>';
         }

         var str = "";
         if (type == 'auto')
         {
           str = jupyterAutoClearOutputStr;
         }
         else if (type == 'on_demand')
         {
           str = jupyterOnDemandClearOutputStr;
         }
         $('#jupyterClearOutputModal_header').html(str);
         $('#jupyterClearOutputModal_files').html(data);
         $('#jupyterClearOutputModal_ta').hide();
         $('#jupyterClearOutputModal_cancel').show();
         $('#jupyterClearOutputModal_co').show();
         $('#jupyterClearOutputModal_ok').hide();
         $("#jupyterClearOutputModal").css('height', 'auto');
         $('#jupyterClearOutputModal').modal();
       }

       function showJupyterReleaseModal(nbs, opts)
       {
         if (nbs.length == 0)
         {
           alert("Jupyter: No notebooks found in the workarea");
           return;
         }

         var data = ''
                  + 'Notebook(s) to be released:'
                  + '<table class="table table-first-column-check table-hover" style="border-top: 0 !important;margin-bottom:5px">'
         ;
         for (var i = 0; i < nbs.length; i++)
         {
           data += '<tr id="jupyter_file_' + i + '">';
           data += '<td class="jupyter-modal-td-file"><input id="jupyter_file_cb_' + i + '" class="span1 jupyter-modal-td-checkbox" type="checkbox" checked>';
           data += nbs[i];
           data += '</td></tr>';
         }
         data += '</table>';
         data += '<br>';
         data += 'Options:';
         data += '<table class="table table-first-column-check table-hover" style="border-top: 0 !important;margin-bottom:5px">';
         data += '<tr><td style="text-align:left; border:0px; padding-bottom:0px"><input id="jupyter_extract_rubric" class="span1" style="margin-bottom:6px; width:20px" type="checkbox"'; // + 'checked>';
         if (!opts || (typeof opts['extractrubric'] === 'undefined') || (opts['extractrubric'] == "1")) {
           data += ' checked ';
         }
         data += '>';
         data += 'Extract rubric items from notebook(s)';
         data += '</td></tr>';

         
         data += '<tr><td style="text-align:left; border:0px; padding-bottom:0px"><input id="jupyter_script_resource_link" class="span1" style="margin-bottom:6px; width:20px" type="checkbox"'; // + 'checked>';
         if (!opts || (typeof opts['createresourceLink'] === 'undefined') || (opts['createresourceLink'] == "1")) {
           data += ' checked ';
         }
         data += '>';
         data += 'Create resource link in Starter Code';
         data += '</td></tr>';
         data += '</table>';

         // Script Options:
         data += '</table>';
         data += '<br>';
         data += 'Script Options:';
         data += '<table class="table table-first-column-check table-hover" style="border-top: 0 !important;margin-bottom:5px">';

         // Generate grading script
         data += '<tr><td style="text-align:left; border:0px; padding-bottom:0px"><input id="jupyter_script_ow" class="span1" style="margin-bottom:6px; width:20px" type="checkbox"'; // + 'checked>';
         if (!opts || (typeof opts['owgrdscript'] === 'undefined') || (opts['owgrdscript'] == "1")) {
           data += ' checked ';
         }
         data += '>';
         data += 'Generate grading script';
         data += '</td></tr>';

         // Show traceback
         data += '<tr><td style="text-align:left; border:0px; padding-bottom:0px"><input id="jupyter_script_traceback" class="span1" style="margin-bottom:6px; width:20px" type="checkbox"';
         if (!opts || (typeof opts['tbgrdscript'] === 'undefined') || (opts['tbgrdscript'] == "1")) {
           data += ' checked ';
         }
         if (opts && (typeof opts['owgrdscript'] !== 'undefined') && (opts['owgrdscript'] == "0")) {
           data += ' disabled ';
         }
         data += '>';
         data += 'Show traceback for errors';
         data += '</td></tr>';

         // Show feedback (via html report)
         data += '<tr><td style="text-align:left; border:0px; padding-bottom:0px"><input id="jupyter_script_feedback" class="span1" style="margin-bottom:6px; width:20px" type="checkbox"';
         // default is unchecked
         if (opts && (typeof opts['fbgrdscript'] !== 'undefined') && (opts['fbgrdscript'] == "1")) {
           data += ' checked ';
         }
         if (opts && (typeof opts['owgrdscript'] !== 'undefined') && (opts['owgrdscript'] == "0")) {
           data += ' disabled ';
         }
         data += '>';
         data += 'Show html feedback report';
         data += '</td></tr>';

         data += '<tr><td style="text-align:left; border:0px; padding-bottom:0px"><input id="jupyter_embed_output" class="span1" style="margin-bottom:6px; width:20px" type="checkbox"'; // + 'checked>';
                    if (!opts || (typeof opts['embedoutput'] === 'undefined') || (opts['embedoutput'] == "1")) {
             data += ' checked ';
           }
                  if (opts && (typeof opts['owgrdscript'] !== 'undefined') && (opts['owgrdscript'] == "0")) {
           data += ' disabled ';
         }
         data += '>';
         data += 'Display autograde test output in open notebook';
         data += '</td></tr>';

         data += '</table>';

         $('#jupyterModal_files').html(data);

         $('#jupyterModal_ta').hide();
         $('#jupyterModal_ok').hide();
         $('#jupyterModal_cancel').show();
         $('#jupyterModal_release').show();

         $("#jupyterModal").css('height', 'auto');
         $('#jupyterModal').modal();
       }

       var releaseNotebooks = [];
       var notebooksWithSizes = [];
       function processNotebooks(type)
       {
         // get a list of notebooks
         releaseNotebooks = [];
         var jqxhr = $.ajax('../util/vcput.php?a=getNotebooksViaWebServer'
                          + '&courseid='  + 16642                          + '&basnid='    + 201916                      
                          + '&stepid='    + 201917                          + '&asnuserid=' + 1165740                          + '&workarea='  + "/mnt/data2/students/ccc_v1_w_NmY0_110384/asn201916_23/asn201917_1/work")
                      .done(function(data, textStatus, jqXHR) {
                        // console.log(data);
                        try {
             	          var result = JSON.parse(data);
                          if (result['status'] == 'Error') {
                            alert("Error retrieving notebook list: " + result['msg'])
                          }
                          else {
                            var prev_options = null;
                            if (typeof result['options'] === 'undefined') {
                              console.log("Options not found");
                            } else {
                              console.log("Options: ");
                              console.log(result['options']);
                              prev_options = result['options'];
                            }
                            notebooksWithSizes = result['notebooks'];
                            for (i = 0; i < notebooksWithSizes.length; i++) {
                              nba = notebooksWithSizes[i];
                              releaseNotebooks.push(nba[0]);
                            } 
                            if (type == "release")
                            {
                              showJupyterReleaseModal(releaseNotebooks, prev_options);
                            }
                            else if (type == "clear_output")
                            {
                              showJupyterClearOutputModal(notebooksWithSizes, 'on_demand');
                            }
                            else if (type == "notebook_size_check")
                            {
                              checkNotebookSize(notebooksWithSizes);
                            }
                          }
                        }
                        catch(err) {
                          alert("Exception retrieving notebook list: " + err)
                        }
                      })
                      .fail(function(data, textStatus, jqXHR) {
                        alert("Error retrieving notebook list");
                      });
       }

       var jupyterModalDotTimer;

       function showJupyterModalDots()
       {
         text = $('#jupyterModal_ta').text();
         $('#jupyterModal_ta').text(text + '.');
         jupyterModalDotTimer = setTimeout(showJupyterModalDots, 1000);
       }

       $(document).on('change', '#jupyter_script_ow', function() {
         var val = this.checked ? false : true;
         $('#jupyter_script_traceback').prop("disabled", val);
         $('#jupyter_script_feedback').prop("disabled", val);
         $('#jupyter_embed_output').prop("disabled", val);;
       }); 

       function jupyterReleaseNotebooks()
       {
         if (releaseNotebooks.length == 0)
         {
           alert("No notebooks found");
           return;
         }
         nbsToRelease = [];
         for (var i = 0; i < releaseNotebooks.length; i++)
         {
           if ($('#jupyter_file_cb_' + i).prop('checked'))
           {
             nbsToRelease.push(releaseNotebooks[i]);
           }
         }
         if (nbsToRelease.length == 0)
         {
           alert("No notebook(s) selected for release");
           return;
         }

         var generateGradingScript = 0;
         if ($('#jupyter_script_ow').prop('checked'))
         {
           generateGradingScript = 1;
         }
         var extractRubric = 0;
         if ($('#jupyter_extract_rubric').prop('checked'))
         {
           extractRubric = 1;
         }
         var deleteRubric = 0;
         if ($('#jupyter_delete_rubric').prop('checked'))
         {
           deleteRubric = 1;
         }
         var createResourceLink = 0;
         if ($('#jupyter_script_resource_link').prop('checked'))
         {
           createResourceLink = 1;
         }
         var tracebackGradingScript = 0;
         if ($('#jupyter_script_traceback').prop('checked'))
         {
           tracebackGradingScript = 1;
         }
         var feedbackGradingScript = 0;
         if ($('#jupyter_script_feedback').prop('checked'))
         {
           feedbackGradingScript = 1;
         }
         var embedOutput = 0;
         if ($('#jupyter_embed_output').prop('checked'))
         {
           embedOutput = 1;
         }

         ht = $('#jupyterModal').height();
         $('#jupyterModal_ok').show();
         $('#jupyterModal_cancel').hide();
         $('#jupyterModal_release').hide();
         $('#jupyterModal_ta').text("Releasing notebook(s).");
         $('#jupyterModal_ta').show();
         $("#jupyterModal").animate({ scrollTop: $('#jupyterModal').prop("scrollHeight")}, 1000);
         jupyterModalDotTimer = setTimeout(showJupyterModalDots, 500);

         var jqxhr = $.ajax('../util/vcput.php?a=releaseNotebooks'
                          + '&courseid='  + 16642                          + '&basnid='    + 201916                      
                          + '&stepid='    + 201917                          + '&asnuserid=' + 1165740                          + '&workarea='  + "/mnt/data2/students/ccc_v1_w_NmY0_110384/asn201916_23/asn201917_1/work"
                          + '&notebooks='  + encodeURIComponent(nbsToRelease.join('_____'))
                          + '&owgrdscript=' + generateGradingScript
                          + '&extractrubric=' + extractRubric
                          + '&createresourceLink=' + createResourceLink
                          + '&deleterubric=' + deleteRubric
                          + '&tbgrdscript=' + tracebackGradingScript
                          + '&fbgrdscript=' + feedbackGradingScript
                          + '&embedoutput=' + embedOutput)
                      .done(function(data, textStatus, jqXHR) {
                        clearTimeout(jupyterModalDotTimer);
                        console.log(data);
                        try {
                          var result = JSON.parse(data);
                          if (result['status'] == 'Error') {
                            alert("Error releasing notebook(s): " + result['msg'])
                          }
                          else {
                            $('#jupyterModal_ta').text(result['stdout']);
                            $("#jupyterModal_ta").animate({
                              scrollTop:$("#jupyterModal_ta")[0].scrollHeight - $("#jupyterModal_ta").height()
                            },1000);
                            $('#updatebtntext').html('Update*');
                          }
                        }
                        catch(err) {
                          alert("Exception releasing notebook(s): " + err)
                        }
                      })
                      .fail(function(data, textStatus, jqXHR) {
                        clearTimeout(jupyterModalDotTimer);
                        alert("Error releasing notebook(s)");
                      });
       }

       $('#jupyterModal_release').click(function() {
         //$('#jupyterModal').modal('hide');
         setTimeout(jupyterReleaseNotebooks, 500);
       });

       var jupyterClearOutputModalDotTimer;

       function showJupyterClearOutputModalDots()
       {
         text = $('#jupyterClearOutputModal_ta').text();
         $('#jupyterClearOutputModal_ta').text(text + '.');
         jupyterClearOutputModalDotTimer = setTimeout(showJupyterClearOutputModalDots, 1000);
       }


       function jupyterNotebookClearOutput()
       {
         if (releaseNotebooks.length == 0)
         {
           alert("No notebooks found");
           return;
         }
         nbsToClear = [];
         for (var i = 0; i < releaseNotebooks.length; i++)
         {
           if ($('#jupyter_co_file_cb_' + i).prop('checked'))
           {
             nbsToClear.push(releaseNotebooks[i]);
           }
         }
         if (nbsToClear.length == 0)
         {
           alert("No notebook(s) selected for clearing output");
           return;
         }

         $('#jupyterClearOutputModal_ta').text("Clearing output for notebook(s).");
         $('#jupyterClearOutputModal_ta').show();
         $('#jupyterClearOutputModal_ok').show();
         $('#jupyterClearOutputModal_co').hide();
         $('#jupyterClearOutputModal_cancel').hide();
         $("#jupyterClearOutputModal").animate({ scrollTop: $('#jupyterClearOutputModal').prop("scrollHeight")}, 1000);
         jupyterClearOutputModalDotTimer = setTimeout(showJupyterClearOutputModalDots, 500);

         var jqxhr = $.ajax('../util/vcput.php?a=notebookClearOutput'
                          + '&courseid='  + 16642                          + '&basnid='    + 201916                      
                          + '&stepid='    + 201917                          + '&asnuserid=' + 1165740                          + '&workarea='  + "/mnt/data2/students/ccc_v1_w_NmY0_110384/asn201916_23/asn201917_1/work"
                          + '&notebooks='  + nbsToClear.join('_____'))
                      .done(function(data, textStatus, jqXHR) {
                        clearTimeout(jupyterClearOutputModalDotTimer);
                        console.log(data);
                        try {
                          var result = JSON.parse(data);
                          if (result['status'] == 'Error') {
                            alert("Error clearing output: " + result['msg'])
                          }
                          else {
                            $('#jupyterClearOutputModal_ta').text(result['stdout']);
                            $("#jupyterClearOutputModal_ta").animate({
                              scrollTop:$("#jupyterClearOutputModal_ta")[0].scrollHeight - $("#jupyterClearOutputModal_ta").height()
                            },1000);
                          }
                        }
                        catch(err) {
                          alert("Exception clearing output: " + err)
                        }
                      })
                      .fail(function(data, textStatus, jqXHR) {
                        clearTimeout(jupyterClearOutputModalDotTimer);
                        alert("Error clearing output");
                      });

       }

       $('#jupyterClearOutputModal_co').click(function() {
         //$('#jupyterModal').modal('hide');
         setTimeout(jupyterNotebookClearOutput, 500);
       });

       $('#clear_notebook_output').click(function() {
         //$('#jupyterModal').modal('hide');
         setTimeout(processNotebooks, 500, 'clear_output');
       });

                          function checkNotebookSize(nbsWsz)
                          {
                            var max_size_in_kb = 10 * 1000;
                            for (i = 0; i < nbsWsz.length; i++) {
                              nba = nbsWsz[i];
                              if (nba[1] >= max_size_in_kb)
                              {
                                showJupyterClearOutputModal(nbsWsz, 'auto');
                                return;
                              }
                            }
                          }
                          
	          $(document).ready(function() {   
                                          processNotebooks("notebook_size_check");
                                      });

       $('#updatebtn').click(function(){
         $.ajax({
           url: '../util/vcput.php?a=courseversion&stepid=201917',
           type: 'get',
           success: function(data) {
              var apos = data.search('voc::');
              var bpos = data.search('::voc');
              if(apos>=0 && bpos>=0 && bpos>apos){
                updateCseVersion(data, data.substring(apos+5, bpos));
              } else {
                updateCseVersion(data, data.substring(apos+5, bpos));
              }
            }
         });
       });
       $('#help-window' ).click(function(){
            if (!$('#jspanelWindow').length) {
		$.jsPanel({
			id: "jspanelWindow",
    			theme:    "light",
    			title:    "Instructions",
			addClass: {
				header: "voc-jpanel-header",
				content: "voc-jpanel-content",
			},
			position: { top: 130, right: "auto" },
			size: { width: 400, height: 500 },
			resizable: "disabled",
			content:  "<iframe src='' width='100%' height='100%' style='' title='Help'></iframe>",
 			controls: { buttons: 'closeonly', iconfont: 'font-awesome' },
		});
	    }
        });
				
		});

/* turtle start */
/* turtle end */		

function unescapeHtml(safe) {
    return safe.replace(/&amp;/g, '&')
        .replace(/&lt;/g, '<')
        .replace(/&gt;/g, '>')
        .replace(/&quot;/g, '"')
        .replace(/&#039;/g, "'")
        .replace(/<br>/g, "");
}


/* we always get the str as htmlspecialchars from php - now print depends whether on terminal or console 
 * to unescape html */
function consolePrint(str) {
    if ((typeof(str) === 'undefined') || (str == null)) {
      return;
    }
            str = str.replace(/VOC_NL/gm, "");
        str = str.replace(/(?:\r\n|\r|\n)/g, '<br />');
                
        str = '<pre>' + str + '</pre>';
                    $('#buildtextarea').html(str);
                

    }		

function widgetModalOutput(str) {
    $('#div-widgetoutput').html("<i class=\"icon-spin icon-spinner\"></i>&nbsp; Waiting for output ..");        
    $('#modal-table-widgetoutput').modal('show');
    $('#div-widgetoutput').html(str);
}

var reportsToOpen = true;
function updateReportStatus(type, str) {
    var statusElem = '#'+type+'ReportStatus';
    $(statusElem).html(str);
    $(statusElem).show();

    if (!($('#reports').hasClass('open')) && reportsToOpen) {
        $('#reportsdropdown').trigger('click');
        reportsToOpen = false;
    } 
}
function updateReportProgress(type, str) {
    var statusElem = '#'+type+'ReportProgress';
    if( str!='' ){
      $(statusElem).html(str);
      $(statusElem).show();
    } else {
      $(statusElem).hide();
    }
}
function updateReportReady(type, show) {
    var statusElem = '#'+type+'reportbutton';
    if( show ) $(statusElem).show();
    else       $(statusElem).hide();
}

function stopCheckReportTimeout(type) {
  if ($("body").data("timeout"+type) != null) {
    clearTimeout($("body").data("timeout"+type));
  }
}

function startCheckReportTimeout(type, url, chksubmit, chkgrade, tv, st) {
  stopCheckReportTimeout(type);
  timeoutVar = setTimeout(function() {
                 asyncCheckReportPeriodic(type, url, chksubmit, chkgrade, tv, st);
               }, 2000);
  $("body").data("timeout"+type, timeoutVar);
}

var waitingForReport = false;
var maxPollTv = 120; //3m
function asyncCheckReportPeriodic(type, url, chksubmit, chkgrade, tv, st) {  
    var statusElem = '#'+type+'ReportStatus';
            if( tv>0 ){
          var elapsed = (Math.floor(Date.now() / 1000) - st);
                    if( true || type!='Submission' || chksubmit===0 ){
            updateReportStatus(type, '<i class="icon-spin icon-spinner"></i>waiting for report ' + elapsed + 's');
          }
        } else {
          waitingForReport = true;
          $("body").data("timeout"+type, null);
          updateReportStatus(type, 'Please come back and click here for the report ...');
          if (type=='RUN' || type=='BUILD') { // activity icon only for RUN as of now
            updateRunIcon(type, false);
          }
          return false;
        }
        if( tv <= (maxPollTv-10) ) { // after 10s
          if( tv>(maxPollTv-60) )  { // before 1m
            if( (tv % 10) != 0 ){
              startCheckReportTimeout(type, url, chksubmit, chkgrade, tv-2, st);
              return false;
            }
          } else if (tv>0){
            if( (tv % 30) != 0 ){
              startCheckReportTimeout(type, url, chksubmit, chkgrade, tv-2, st);
              return false;
            }
          }
        }
        tv -= 2;
        $.ajax({
            url: url,
            data: {},
            success: function(ret_val) {  

                if (ret_val.indexOf('ERROR:INVALID_SESSION>') == 1) { // invalid session
                  refreshNewSessionPage();
                }

                try {
                  resp = jQuery.parseJSON(ret_val);
                } catch(err) {
                    show_voc_gritter(false, "Internal error: invalid json", true);
                    consolePrint('Internal error: invalid json');
                    if (type=='RUN' || type=='BUILD') { // activity icon only for RUN as of now
                      updateRunIcon(type, false);
                    }
                    return;
                }     
                                if (resp.state != 2) {
                    startCheckReportTimeout(type, url, chksubmit, chkgrade, tv, st);
                } else {  // done
                    $("body").data("timeout"+type, null);
                    if ( (resp.status == 1) ||
                                (resp.status == 2) ) {
                        
                        if (type=='RUN' || type=='BUILD') { // activity icon only for RUN as of now
                                                    if(resp.status == 1){
                            show_voc_gritter(false, type + ' completed successfully', false);
                          } else {
                            show_voc_gritter(false, type + ' completed with errors', true);
                          }
                          updateRunIcon(type, false);
                                                  }
                                                                                                           reportsToOpen = true;
                               if( true ) {
                                 updateReportStatus(type, '<i class="icon-ok"></i>New report ready');
                               }
                               consolePrint(type + " Report:");
                               consolePrint(resp.output);
                                                        refreshFileTree(false, true);                                                
                                                
                                                       reportsToOpen = true;
                               if( true ) {
                                 updateReportStatus(type, '<i class="icon-ok"></i>New report ready');
                                 if (type == 'Grading') {
                                   vcJupyterExtraGradingComplete();
                                 }
                                 //mhui
                                 var element =  document.getElementById('gradeframe');
                                 if (typeof(element) != 'undefined' && element != null && advance_features == 1)
                                 {
                                 	 $('#gradesIdeBtn').click();
                                 }
                               }
                                                
                        
                    } else {
                        str = "Unexpected failure. Please contact support";
                                                    reportsToOpen = true;
                            updateReportStatus(type, '<i class="icon-info"></i>Unexpected error');
                                                        
                            
                                                
                    }
                    
                }          
            }
    });  
    
}		
		
		
var submit_maxcount = -1;
var submit_count = 0;		
var submit_in_progress = false;
var submission_open = 0;
var show_peer_review_confirm_dialog = 0;
var auto_peer_review_mode = 0;


function showSolutionAlert() {
          bootbox.dialog("You can now download the solution from the Actions drop-down menu",
                         [{
                           "label" : "Ok",
                            "class" : "btn vocbtn-ac vocbtn-action"
                          }]
          );
}

function updateSubmitDetails(resp) {
    if( (typeof resp.data !== "undefined") && resp.data ) {
        var subData = resp.data;
        var str = "";
              if (subData.hasOwnProperty('last_submitted')) {
            str = str + "<tr><td>Last submitted: </td><td>" + subData['last_submitted'] + "</td><tr>";
            /* submission should make the confirm dialog for auto peer review to come up */
            if (!show_peer_review_confirm_dialog) {
              show_peer_review_confirm_dialog = true;
            }
        }
        if (subData.hasOwnProperty('submission_count')) {
            str = str + "<tr><td>Submission count: </td><td>" + subData['submission_count'] + "</td><tr>";
                    }
        if (subData.hasOwnProperty('submissions_allowed')) {
            str = str + "<tr><td>Total allowed: </td><td>" + subData['submissions_allowed'] + "</td><tr>";
        }        
        
        if (subData.hasOwnProperty('due_date')) {
            str = str + "<tr><td>Due date: </td><td>" + subData['due_date'] + "</td><tr>";
        }    
        if (subData.hasOwnProperty('late_submission_deadline')) {
            str = str + "<tr><td>Late deadline: </td><td>" + subData['late_submission_deadline'] + "</td><tr>";
        }    
        if (subData.hasOwnProperty('early_submission_bonus')) {
            str = str + "<tr><td>Early bonus: </td><td>" + subData['early_submission_bonus'] + "</td><tr>";
        } 
        if (subData.hasOwnProperty('version')) {
            str = str + "<tr><td>Current version: </td><td>" + subData['version'] + "</td><tr>";
        } 
        
        str += '';
        str += '';
        str += '';
        str += '';
        str += '';
        if (str != '') {
            $('#subdetails').html(str);
        }
    }
}

  // if ($canSubmit)

function updateSubmitIcon(inprogress) {
    submit_in_progress = inprogress;
    if (inprogress) {
        $('#btn-submitasn').html('<i class="icon-spin icon-spinner"></i>Submitting</button>');
    } else {
        if ((submit_maxcount < 0) || (submit_count <= submit_maxcount) || (submission_open != 0)) {
            $('#btn-submitasn').html('Submit');  
        } else {
            $('#btn-submitasn').hide();
        }      
    }
}

function updateRunIcon(type, inprogress) {
    var btn = '#' + type + '-btn';
    var name = type=='RUN'? 'Run' : 'Build';
    if (inprogress) {
        $(btn).html('<i class="icon-spin icon-spinner"></i>' + name);
    } else {
        $(btn).html(name);
    }
}

		
		
	            
        function verifyResubmit(url, resubmit)
        {
          var str = "Are you sure you want to submit?";
          if(resubmit){
            str += '<br>Your earlier submission is still being processed. If you submit again, the previous submission may be terminated.';
          }
                      bootbox.dialog(str,
                         [{
                           "label" : "Yes",
                           "class" : "btn vocbtn-ac vocbtn-action",
                           "callback": function() {
                             handleSubmitUpdate(url);
                           }
                         },
                          {
                            "label" : "Cancel",
                            "class" : "btn vocbtn-ac vocbtn-status"
                          }]
          );
          return false;
        }      

                  function checkAndVerifyResubmit(url) {
                                                            $.ajax({
                      url: "../util/vcput.php?a=chkResubmit&tv="+Date.now()+"&stepid=201917&version=0",
                    })
                     .done(function(ret_val) {
                       return verifyResubmit(url, ret_val.indexOf('status::progress')>=0);
                     })
                     .fail(function(ret_val) {
                       // procees to submit anyway
                       return verifyResubmit(url, false);
                     });
                                      }
                  
                    
        function confirmSubmitAsnBtn(url) {

                  

                  saveJupyterNotebookAndCheckVerifySubmit(url);
        };
        function gotoTeam(pid, name)
        {
          bootbox.dialog('Are you sure you want to switch to the workarea owned by [' + name + ']?', 
                         [{
                           "label" : "Yes",
                           "class" : "btn vocbtn-ac vocbtn-action",
                           "callback": function() {
                             window.location = "main.php?m=editor&asnid=201916&stepid=201917&ownerid="+pid+"&permit=7";
                           }
                         },
                          {
                            "label" : "Cancel",
                            "class" : "btn vocbtn-ac vocbtn-status"
                          }]
          );
        }
        function copyworkarea()
        {
          saveCBClipboard('work\/');
          return false;
        }
        function pasteworkarea()
        {   
          pasteCB("Paste", 'work\/', '', "Paste successful", true);
          return false;
        }
        function confirmResetAsnBtn(url) {
          var str = 'Reset will delete all your content in the work area  and replace it with the starter code.<br><br>' +
                    '' +
                    'Are you sure you want to reset your work-area?';
                                    bootbox.dialog(str, 
                         [{
                           "label" : "Yes",
                           "class" : "btn vocbtn-ac vocbtn-action",
                           "callback": function() {
                                                            show_voc_gritter(true, ' Resetting work-area ...', true);
                                                          window.location = url;
                           }
                         }, 
                          {
                            "label" : "Cancel",
                            "class" : "btn vocbtn-ac vocbtn-status"
                          }]
              );
                              };
      


  var vcChkSubmitFP = false;
    function periodicChkSubmitFP()
  {
    if(vcChkSubmitFP) {
      clearTimeout(vcChkSubmitFP);
      vcChkSubmitFP = false;
    }
    if( submit_in_progress || $('#reports').hasClass('open') ){
      vcChkSubmitOneTime();
    }
  }
  function vcScheChkSubmit()
  {
    if( !vcChkSubmitFP ){
      vcChkSubmitFP = setTimeout(periodicChkSubmitFP, 3000);
    }
  }
  function vcStStr(data, type)
  {
    var str = '';
    var st = type + '_st';
    var code = type + '_code';
    if( data.hasOwnProperty(code) && data[code]>0 ){
      if( data[code]==6 || data[code]==134 ){
        return ' (script aborted, exitcode=' + data[code] + ')';
      } else {
        return ' (script exitcode=' + data[code] + ')';
      }
    }
    if( data.hasOwnProperty(st) && data[st]!=1 ){
      return  '(Error)';
    }
    return '';
  }
  function vcChkSubmitOneTime()
  {
    $.ajax({
         type: "POST",
         url:'../util/vcput.php?a=getsubmitdetail&stepid=201917&userid=1165740&version=0'
     })
     .done(function(ret_val) {
         try {
           var resp = jQuery.parseJSON(ret_val);
           updateSubmitDetails(resp);
           var data = resp.hasOwnProperty('data')? resp['data'] : [];
           if(data.hasOwnProperty('record')){
             if(!data['record']){
                                updateReportProgress('Submission', '');
             } else {
               var substr = '';
               var st = '';
               var rep = '';
               if( data.hasOwnProperty('grade') ){
                 if( data['grade'] ){
                                    st = vcStStr(data, 'grade');
                   if( data.hasOwnProperty('grade_out') ){
                     substr = '<tr><td style="width:130px">Grading Report' + st + '</td><td><div class="btn btn-info vocbtn vocbtn-info" data-toggle="tab" href="#" tabindex="0" role="button" style="border:0px; line-height:17px !important" onclick="showrep(1);">Show</div></td></tr>';
                   } else 
                                    {
                     substr = '<tr><td> Grading ' + st + '</td><td></td></tr>';
                   }
                 } else {
                   substr = '<tr><td><i class="icon-spin icon-spinner"></i> Grading processing</td><td></td></tr>';
                   vcScheChkSubmit();
                 }
               }
                            if(data['record_st']!=1) st = 'failed';
               else                                                                st = 'completed';
               updateSubmitIcon(false);
               updateReportProgress('Submission', '<tr><td> Submission ' + st + '</td><td></td></tr>' + substr);
               updateReportReady('submission', true);
                          }
           } else {
             updateReportProgress('Submission', '');
             updateReportReady('submission', true);
           }
         } catch (e) {
           show_voc_gritter(false, "Failed to retrieve submission status", true);
         }
    });
  }

  $( "#reports" ).click(function() {
      if( vcChkSubmitFP ){
      clearTimeout(vcChkSubmitFP);
      vcChkSubmitFP = false;
    }
    if( ! $('#reports').hasClass('open') ){
      updateReportProgress('Submission', ' <i class="icon-spin icon-spinner">');
      vcChkSubmitFP = setTimeout(periodicChkSubmitFP, 1000);
    }
    });

  $( "#odterminalbtn" ).click(function() {
   $('#div-output-od_terminal').html("<iframe src=\"/terminal/?uid=1165740&token=\" width=\"100%\" height=\"100%\" frameBorder=\"0\" scrolling=\"no\" title=\"Terminal\"></iframe>");
  });



  $( "#downloadbtn" ).click(function() {
  	if ($('#input_filename').val().startsWith("Submissions/")) {
  		var url = "../main/submissionurl.php?asnid=201917&mode=s&version=0&courseid=16642&userid=1165740&data=" + $('#input_filename').val();
  	} else {
  	    var paths = $('#tree1').tree('selectedItems').map(function (el) {
  	      var path = el.path.substring(2);
  	      if (el.type == 'folder') {
  	        path += '/';
  	      }
  	      return path;
  	    });
      	var filepath = "./" + $('#input_filename').val();
      	var url = "../domains/ide_src_zip.php?stepid=201917&mode=s&version=0&filepath=" + filepath;
  	}
  	$('#div-output-download_from_ide').html('');
  	$.ajax({
  	  url: url,
  	  type: 'post',
  	  data: {
  	    files: JSON.stringify(paths)
  	  },
  	  success: function(data) {
  	    $('#div-output-download_from_ide').html(data);
  	  }
  	});
    //$('#div-output-download_from_ide').html("<iframe src=\""+url+"\" width=\"100%\" height=\"100%\" title=\"Download\"></iframe>");
  });

  function getStudentReport(target, targetDiv, type, num) {
    var jqxhr = $.ajax('../util/vcput.php?a=getStudentReport'
                     + '&stepid='+ 201917                     + '&userid='+ 1165740                     + '&type=' + type 
                     + '&version=0'
                     + '&num=' + num)
                 .done(function(data, textStatus, jqXHR) {
                   // alert(data);
                   target.innerHTML = data;
                   targetDiv.scrollTop = targetDiv.scrollHeight;
                               if( waitingForReport && data.search(/Executed/)>=0 ){
                     waitingForReport = false;
                     if( true ) {
                       updateReportStatus(type, '<i class="icon-ok"></i>New report ready');
                     }
                     consolePrint(data);
                   }
                             })
                 .fail(function(data, textStatus, jqXHR) {
                   target.innerHTML = "<p>No " + type + " Report has been generated<p>";
                   targetDiv.scrollTop = targetDiv.scrollHeight;
                 });
  }
                  
  function showStudentReportHtml(modalHtml, iframeHtml, iframeTitle, type, fileName)
  {
     var url = "../web/1165740/201917/work/" + fileName;
     iframeTitle.html(type + " Report");
     iframeHtml.attr("src", url);
     modalHtml.modal('show');
  }             
                  
  function showStudentReportText(modalDiv, target, targetDiv, text)
  {
     modalDiv.modal('show');
     str = text.replace(/(?:\r\n|\r|\n)/g, '<br />');
     target.innerHTML = str;
     targetDiv.scrollTop = targetDiv.scrollHeight;
  }             
                  
  function showStudentReport(modalDiv, target, targetDiv, modalHtml, iframeHtml, iframeTitle, type, num) {
    var jqxhr = $.ajax('../util/vcput.php?a=showStudentReport'
                     + '&stepid='+ 201917                     + '&userid='+ 1165740                     + '&type=' + type
                     + '&work=' + "/mnt/data2/students/ccc_v1_w_NmY0_110384/asn201916_23/asn201917_1/work"
                     + '&version=0'
                     + '&num=' + num)
                 .done(function(data, textStatus, jqXHR) {
                   try {
                     var result = JSON.parse(data);
                     if (result['status'] == 'Error') {
                       showStudentReportText(modalDiv, target, targetDiv, result['msg']);
                     } else {
                       if (result['msg']) {
                         showStudentReportText(modalDiv, target, targetDiv, result['msg']);
                       } else if (result['fileType'] == "text") {
                         showStudentReportText(modalDiv, target, targetDiv, result['reportFile']);
                       } else {
                         showStudentReportHtml(modalHtml, iframeHtml, iframeTitle, type, result['reportFileName']);
                       }
                     }
                   }
                   catch (e) {
                     showStudentReportText(modalDiv, target, targetDiv, 'Parse error getting student report: ' + e);
                   }
                               if (waitingForReport) {
                     waitingForReport = false;
                     if( true ) {
                       updateReportStatus(type, '<i class="icon-ok"></i>New report ready');
                     }
                     consolePrint(data);
                   }
                             })
                  .fail(function(data, textStatus, jqXHR) {
                    showStudentReportText(modalDiv, target, targetDiv, "<p>No " + type + " Report has been generated<p>");
                 });
  }

  function showrep(grading)
  {
    var name, type;
    if(grading) {
      name = 'grading';
      type = 'Grading';
    } else {
      name = 'submission';
      type = 'Submission';
    }
    var target = document.getElementById("report_" + name + "_msg_box");
    var targetDiv = document.getElementById("report_" + name + "_div");

    // if course has new flag set
          $('#modal-table-report-all-html-iframe').attr("src", "");
      showStudentReport($('#modal-table-report-' + name), target, targetDiv,
                        $('#modal-table-report-all-html'), $('#modal-table-report-all-html-iframe'),
                        $('#modal-table-report-all-html-title'), type, 0);
      }
  $('#gradingreportbutton').click(function(e) {
    showrep(1);
    e.preventDefault();// prevent the default anchor functionality
  });
  
  $('#submissionreportbutton').click(function(e) {
    showrep(0);
    e.preventDefault();// prevent the default anchor functionality
  });

  $('#runreportbutton').click(function(e) {
    var target = document.getElementById("report_run_msg_box");
    var targetDiv = document.getElementById("report_run_div");

    $('#modal-table-report-run').modal('show');
    getStudentReport(target, targetDiv, 'RUN', 0);

    e.preventDefault();// prevent the default anchor functionality
  });
  $('#buildreportbutton').click(function(e) {
    var target = document.getElementById("report_build_msg_box");
    var targetDiv = document.getElementById("report_build_div");

    $('#modal-table-report-build').modal('show');
    getStudentReport(target, targetDiv, 'BUILD', 0);

    e.preventDefault();// prevent the default anchor functionality
  });
    launchJupyter();

  var dottyTimeout;
  var jupyterHtmlStyle = 'style="text-align:left; margin-left: 10px; padding-top:10px"';

  function vcLogJupyterError(jid, msg, ip, url)
  {
    var jqxhr = $.ajax({
      type: 'POST',
      url: '../util/vcput.php',
      data: { a: 'logJupyterError', msg: msg, jid: jid, ip: ip, url: url }
    })
    .done(function(data, textStatus, jqXHR) {
       // all done
    })
    .fail(function(jqXHR, textStatus, errorThrown) {
      // if the error logging itself failed, don't know what else to do...
    });
  }
                  
  function editVers()
  {
    $('#modal-edit-vers').modal('show');
  }
  function setView(type) {
        name = "vocview_1165740_201917_s";
    str = name + "=" + type + "; path=/";
    // if this cookie is already set with the same value as "type", nothing to do
    var re = new RegExp(name + '=(\\w*)');
    allcookies = document.cookie;
    var matches = allcookies.match(re);
    if (matches && (matches.length > 1) && (matches[1] == type))
    {
      return;
    }
    document.cookie = str;
    location.reload();
  }

  function setNewTabView(type) 
  {
    var loc = "main.php?m=editor&asnid=201916&stepid=201917&hideNavBar=1" + '&force_idetype=' + type + '&force_noreadme=1';
    window.open(loc);
  }

  function openAppWindow(loc)
  {
    window.open(loc);
  }

  function getXstartupFileName(type)
  {
    switch (type) {
              case 0: return "xstartup.test";
              case 1: return "xstartup.eclipse";
              case 2: return "xstartup.mysqlwb";
              case 5: return "xstartup.pgadmin";
              case 3: return "xstartup.spyder3";
              case 4: return "xstartup.desktop";
              case 6: return "xstartup.android-studio";
              case 11: return "xstartup.thonny";
              default: return "xstartup.desktop";
    }
  }

  var vocLaunchingApp = false;
  function vocLaunchTimer()
  {
    vocLaunchingApp = false;
  }
                  
  function launchApp(type)
  {
    $('#app_spinbox_' + type).show();

    if (vocLaunchingApp == true) {
      return;
    }
    vocLaunchingApp = true;
    setTimeout(vocLaunchTimer, 5000);

    xstartup_file = '/home/lib/ubuntu1604/vdi/xstartup_files/' + getXstartupFileName(type);
    data = { 'action': 'Launch', 'token': '2014808784116574011657402019170160512d708b2079.09496776', 'proxy_path': 'proxy.vocareum.com/hostip/172.31.20.230:5000/vocproxy/1321432282116574011657402019170160512d70843755.93220026', 'proxy_scheme': 'https', 'xstartup_file': xstartup_file };

    var jqxhr = $.ajax({
      type: 'POST',
      url: "https://proxy.vocareum.com/hostip/172.31.20.230:9000/",
      data: JSON.stringify(data)
    })
    .done(function(data, textStatus, jqXHR) {
       $('#app_spinbox_' + type).hide();
       console.log(data);
       if (data['status'] == 'Error') {
         alert("VDI: Error: " + data['msg'])
       }
       else {
         // alert("location = " + data['location']);
         window.setTimeout(function() { openAppWindow(data['location']); } , 1000);
       }
       $('#actionsdropdown_liactions2').parent().removeClass('open');
       clearTimeout(vocLaunchTimer);
       vocLaunchingApp = false;
    })
    .fail(function(jqXHR, textStatus, errorThrown) {
      $('#app_spinbox_' + type).hide();
      alert("VDI: Launch Failed");
      $('#actionsdropdown_liactions2').parent().removeClass('open');
      clearTimeout(vocLaunchTimer);
      vocLaunchingApp = false;
    });
  }

  function stopApp()
  {
    $('#app_spinbox_stop').show();

    data = { 'action': 'Stop', 'token': '2014808784116574011657402019170160512d708b2079.09496776' }

    var jqxhr = $.ajax({
      type: 'POST',
      url: "https://proxy.vocareum.com/hostip/172.31.20.230:9000/",
      data: JSON.stringify(data)
    })
    .done(function(data, textStatus, jqXHR) {
       $('#app_spinbox_stop').hide();
       console.log(data);
       if (data['status'] == 'Error') {
         alert("VDI: Error: " + data['msg'])
       }
       $('#actionsdropdown_liactions2').parent().removeClass('open');
    })
    .fail(function(jqXHR, textStatus, errorThrown) {
      $('#app_spinbox_stop').hide();
      $('#actionsdropdown_liactions2').parent().removeClass('open');
    });                  
  }

  function vcJupyterExtraNewSubmission()
  {
    // if this is jupyter and we're embedding output, need to clear it on a new submission
          if (iframeWindow && (typeof(iframeWindow.vocext_newSubmission) !== 'undefined'))
      {
        iframeWindow.vocext_newSubmission();
        // also remove the .voc.ag.*.json files in the work area
        // no need to wait for results or check for errors - the new execution will overwrite these files
        var jqxhr = $.ajax('../util/vcput.php?a=removeAutoGradeCellOutputFiles'
                         + '&courseid='  + 16642                         + '&basnid='    + 201916                      
                         + '&stepid='    + 201917                         + '&asnuserid=' + 1165740                         + '&workarea='  + "/mnt/data2/students/ccc_v1_w_NmY0_110384/asn201916_23/asn201917_1/work");
      }
      }

  function vcJupyterExtraGradingComplete()
  {
    // if this is jupyter and we're embedding output, tell jupyter to do it's thing
          if (iframeWindow && (typeof(iframeWindow.vocext_gradingComplete) !== 'undefined'))
        {
          iframeWindow.vocext_gradingComplete();
        }
      }

  // called by jupyter if it needs to show something in an opened notebook
  function vocareum_be_getOutputData(notebookName)
  {
          if (iframeWindow && (typeof(iframeWindow.vocext_setupResults) !== 'undefined')) {
        var jqxhr = $.ajax('../util/vcput.php?a=getAutoGradeCellOutput'
                         + '&notebook=' + notebookName
                         + '&workarea=' + "/mnt/data2/students/ccc_v1_w_NmY0_110384/asn201916_23/asn201917_1/work")
          .done(function(data, textStatus, jqXHR) {
            console.log(data);
            try {
              var result = JSON.parse(data);
              if (result['status'] == 'Error') {
                alert("Error retrieving notebook auto-grade cell data: " + result['msg'])
              }
              else {
                if (typeof(result["data"] != "undefined")) {
                  iframeWindow.vocext_setupResults(result["data"]);
                }
              }
            }
            catch(err) {
              alert("Exception retrieving notebook auto-grade cell data: " + err)
            }
          })
          .fail(function(data, textStatus, jqXHR) {
            alert("Error retrieving notebook auto-grade cell data");
          });
      }             
      }                  

  $("#justdoit").click(function() {
    vcJupyterExtraGradingComplete();
    return;
  });

  function dotty()
  {
    val = $('#jupyterIframeParent').text();
    $('#jupyterIframeParent').html('<p ' + jupyterHtmlStyle + ' >' + val + '. </p>');
    dottyTimeout = setTimeout(dotty, 1000);
  }
  function startDotty(type)
  {
    $('#jupyterIframeParent').html('<p ' + jupyterHtmlStyle + ' >Loading ' + type +' server' + ' </p>');
    dottyTimeout = setTimeout(dotty, 1000);
  }
  function stopDotty()
  {
    clearTimeout(dottyTimeout);
  }
  function launchRStudio()
  {
     return false;
  }
  function launchAws(v)
  {
    return false;
  }
  function launchC9()
  {
     $.ajax({
        url: "../util/vcput.php?vockey=JPu2MF7MPbsPpHMAZIPBAg%3D%3D&a=getawsc9&asnid=201917&userid=1165740&mode=s&version=0",
        data: {},
        success: function(data) {
           var apos = data.search('voc::');
           var bpos = data.search('::voc');
           if(apos>=0 && bpos>=0 && bpos>apos){
             if( data.search('voc::Error:')>=0 ){
               consolePrint(data.substring(apos+5,bpos) + ' -- failed to launch Cloud9 Console');
             } else {
               window.open(data.substring(apos+5,bpos), "81a7856fdc7afeed9d8c5ed0703eb67b");
             }
           } else {
             consolePrint('Failed to launch Cloud9 Console');
           }
        }
     });
  }
  
  function launchAppStream()
  {
    return false;
  }
  
  function vocSetRunServerFromJupyter(uniqname)
  {
    var jqxhr = $.ajax({
      url: "../util/vcput.php",
      data: {a: "setRunServerFromJupyter", stepid: "201917", courseid: "16642", userid: "1165740", uniqname: uniqname}
    })
    .done(function(data, textStatus, jqXHR) {
      // errors have already been logged
    })
    .fail(function(jqXHR, textStatus, errorThrown) {
      // errors have already been logged
    });                  
  }
                  
  function launchJupyter()
  {

    var site = "https://proxy.vocareum.com";

    
            
    var hostip = '/hostip/172.31.20.230:6000';
    site += hostip;
        
    $('#jupyterIframeParent').html("");
    var browser = "unknown";
    if (platform)
    {
      browser = platform.description;
      if ((platform.name == "IE") || (platform.name == "Microsoft Edge"))
      {
        msg = "Warning: Unsupported browser '" + platform.name + "' detected; if you face any issues, please use Chrome, Firefox or Opera instead";
        // $('#jupyterIframeParent').html('<p ' + jupyterHtmlStyle + ' >' + msg + ' </p>');
        alert(msg);
      }
    }

    startDotty('notebook');
      
    
        
    var username = "ccc_v1_w_NmY0_110384";
    var token = "1852313718116574011657402019170160512d70ad1156.59849237";
    var userid = "1165740";
    var studentid = "1165740";
    var stepid = "201917";
    var subnum = "0";
    var uniqname = "ccc_v1_w_NmY0_110384_1165740_1165740_201917_0";
    
    // var usernameForUrl = username; // userid + "_" + studentid
    // var usernameForUrl = username + "_" + userid + "_" + studentid + "_" + stepid + "_" + subnum;
    var usernameForUrl = "ccc_v1_w_NmY0_110384_1165740_1165740_201917_0";
    
    var url = site + "/hub/login?next=" + hostip + "/user/" + usernameForUrl + "/tree";
    var url2 = site + "/user/" + usernameForUrl;
          url2 += "/tree";
                      
    
    // first send the login request
    var jqxhr = $.ajax({
      type: 'POST',
      url: url,
      xhrFields: {
        withCredentials: true
      },
      data: {username: username, userid: userid, studentid: studentid, token: token, stepid: stepid, subnum: subnum, browser: browser, uniqname: uniqname}
    })
    .done(function(data, textStatus, jqXHR) {
      // careful - even for login failures, the http result is success
      var el = document.createElement( 'html' );
      el.innerHTML = jqXHR.responseText;
      list = el.getElementsByClassName('login_error')[0];
      if (list)
      {
        // ok - so there was a login error
        // errMsg = $.trim(list.innerHTML);
        // $('#jupyterIframeParent').html('<p ' + jupyterHtmlStyle + ' >Login Error: ' + errMsg + ' </p>');
        // $('#jupyterIframeParent').append('<p ' + jupyterHtmlStyle + ' >Please try reloading after a short interval; if this problem persists, please contact Vocareum Technical Support.' + ' </p>');

        // actually, just let jupyter render a nice page for us
        stopDotty();
        $('#jupyterIframeParent').html(data);
        // log the error
        var errMsg = "Unknown";
        if (list.innerHTML)
        {
          errMsg = $.trim(list.innerHTML);
        }
        setTimeout(vcLogJupyterError, 500, usernameForUrl, errMsg, hostip, url);
      }
      else
      {
        stopDotty();
        console.log("Url2: " + url2);
        $('#jupyterIframeParent').html('<iframe id="jupyterIframe" name="jupyterIframe" title="Jupyter" src="' + url2 + '" style="border:0px" height="100%" width="100%" scrolling="yes"></iframe>');
        setTimeout(vocCheckJupyterConsistency, 1000, usernameForUrl);
        // authentication succeeded; get run server from jupyter table
        setTimeout(vocSetRunServerFromJupyter, 1000, uniqname);
      }
    })
    .fail(function(jqXHR, textStatus, errorThrown) {
      stopDotty();
      $('#jupyterIframeParent').html('<p ' + jupyterHtmlStyle + ' >Error: ' + jqXHR.status + ' </p>');
      $('#jupyterIframeParent').append('<p ' + jupyterHtmlStyle + ' >Please try reloading after a short interval; if this problem persists, please contact Vocareum Technical Support.' + ' </p>');
      // log the error
      setTimeout(vcLogJupyterError, 500, usernameForUrl, jqXHR.status, hostip, url);
    });
    
    return false;
  }

  function vocCheckJupyterConsistency(username)
  {
    jif = document.getElementById('jupyterIframe');
    if (jif)
    {
      cw = jif.contentWindow;
      if (cw)
      {
        if (typeof(cw.vocExtGetUniqUserName) === typeof(Function))
        {
          name = cw.vocExtGetUniqUserName();
          if ((name != 'unset') && (name != username))
          {
            console.log("VOC name check: " + name + " :: " + username);
            window.location.replace($('#breadcrumb').find('a').attr("href") + "&w=Jupyter+session+closed");
          }
        }
      }
    }
    setTimeout(vocCheckJupyterConsistency, 1000, username);
  }

var allCodeComments = null;

    
        $(function() {
            var url = "../util/vcprojapi.php?t=handleCodeComment&what=all&asnid=201917&inviterid=1165740&myprojid=6816586&version=0";

            $.ajax({
              url: url,
              data: {},
              success: function(ret_val) {

                if (ret_val.indexOf('ERROR:INVALID_SESSION>') == 1) { // invalid session
                  refreshNewSessionPage();
                }

                if (ret_val.indexOf('<ERROR:') !== -1) { 
                    $.gritter.add({
                      title: ' Could not fetch code comment . ' + ret_val,
                      text: '',
                      class_name: 'gritter-light gritter-warning'
                    });
                    return;  
                }


                var result = JSON.parse(ret_val);
                allCodeComments = result['comments'];
                console.log("comments loaded");
              }
           });

        });

    


                  

  var vocPanelTerminalTryMax = 20; // 10s

  function vocTerminalTabTimeout(el, vm, counter)
  {
    if (el.contentWindow.tabReadyForCmd(vm['name']))
    {
      el.contentWindow.executeCommandOnTab(vm['name'], 'exec ' + vm['ssh_cmd']);
      return;
    }
    counter += 1;
    if (counter <= vocPanelTerminalTryMax)
    {
      setTimeout(vocTerminalTabTimeout, 500, el, vm, counter);
    }
    else
    {
      alert("Could not open new tab in terminal");
    }
  }

  function vocTerminalTimeoutInternal(el, vm, isNewWin)
  {
    if (isNewWin)
    {
      el.contentWindow.setTabTitle(0, vm['name']);
      el.contentWindow.executeCommand('exec ' + vm['ssh_cmd']);
    }
    else
    {
      if (el.contentWindow.createTabIfNoneExists(vm['name']) == true)
      {
        // so a new tab is being created - we need to wait for it
        // no need for else clause - coz the above call will focus on the correct tab
        setTimeout(vocTerminalTabTimeout, 500, el, vm, 0);
      }
    }
  }

  function vocTerminalTimeout(el, vm, isNewWin, counter)
  { 
     try 
     {
       if (el.contentWindow.vocTerminalIsAvailable())
       {
         setTimeout(vocTerminalTimeoutInternal, 500, el, vm, isNewWin);
         return;
       }
     }
     catch(err)
     {
       // nothing to do - we'll just try again
     }

     counter += 1;
     if (counter <= vocPanelTerminalTryMax)
     {
       setTimeout(vocTerminalTimeout, 500, el, vm, isNewWin, counter);
     }
     else
     {
       alert("Could not start terminal");
     }
  }
                  
  $('.vmtoolbarbtn').click(function(e) 
  {
    var vm_indx = e.target.dataset.indx;
    var jqxhr = $.ajax("../util/vcput.php?a=vcGetLabInfo&stepid=201917&version=0&labworkdir=/mnt/data2/students/ccc_v1_w_NmY0_110384/asn201916_23/asn201917_1/work" + '&novnc=1' + '&vm_indx=' + vm_indx)
      .done(function(data, textStatus, jqXHR)
      {
        try 
        {
          var result = JSON.parse(data);
          if (result['status'] == 'Error')
          {
             show_voc_gritter(false, "Could not get lab information: " + result['msg'], true);
          }
          else
          {
            state = result['lab_state'];

            // get the appropriate container/vm
            vm = result['vms'][vm_indx];
            state = vm['state'];
                    
            if (state != "Ready")
            {
              bootbox.dialog("This machine is not in Ready state; please launch it before attempting to access it.", 
                             [{
                               "label" : "Ok",
                               "class" : "btn vocbtn-ac vocbtn-action",
                             }]
              );
            }
            else
            {
              if ((typeof vm['novnc_proxy'] !== "undefined") && vm['novnc_proxy']) 
              {
                $('#panel2Iframe').attr("src", vm['novnc_proxy']);
              }
              else if ((typeof vm['ssh_cmd'] !== "undefined") && vm['ssh_cmd']) 
              {
                console.log(vm);
                console.log(result);

                // Three cases:
                // 
                // 1. no terminal has ever been launched
                //    - start terminal
                //    - ssh cntnr
                // 2. terminal disappeared
                //    - "press" the launch button
                //    - ssh cntnr
                // 3. terminal is present
                //    - check if tab for this vm is already there
                //      - if so, select it
                //      - if not, open a new tab and ssh cntnr

                var isNewWin = true;
                const termExp = /\/terminal\//;
                var telement = document.getElementById('panel2Iframe');
                if ($('#panel2Iframe').attr("src") == "")
                {
                  $('#panel2Iframe').attr("src", "/terminal/?uid=1165740&token=");
                }
                else if (termExp.test($('#panel2Iframe').attr("src")) === false)
                {
                  $('#panel2Iframe').attr("src", "/terminal/?uid=1165740&token=");
                }
                else if (! telement.contentWindow.vocTerminalIsAvailable())
                {
                  console.log("voc-start-term");
                  telement.contentWindow.vocStartTerminal();
                }
                else
                {
                  isNewWin = false;
                }
                setTimeout(vocTerminalTimeout, 500, telement, vm, isNewWin, 0);
              }
              else if ((typeof vm['err'] !== "undefined") && vm['err'])
              {
                bootbox.dialog("Unable to access:  " + vm['err'], 
                               [{
                                 "label" : "Ok",
                                 "class" : "btn vocbtn-ac vocbtn-action",
                               }]
                );                      
              }
            }
          }
        }
        catch(err)
        {
          console.log("Exception: " + err);
          show_voc_gritter(false, "Could not get lab1 information", true);
        }
      })
      .fail(function(data, textStatus, jqXHR)
      {
        show_voc_gritter(false, "Could not get lab2 information", true);
      });
  });

                  function reallyResetClab()
                  {
                    show_voc_gritter_duration(true, "Resetting lab...", true, 15);
                    $.ajax({
                      url: "../util/vcput.php?a=resetclabsblocking&stepid=201917&version=0&labworkdir=/mnt/data2/students/ccc_v1_w_NmY0_110384/asn201916_23/asn201917_1/work",
                    })
                     .done(function(ret_val) {
                       $.gritter.removeAll();
                       // wait for "None" state - when we have the new container-server flow (and don't use blocking above)
                       // setTimeout(waitForNoneState, 5000, "endResetClab");
                       setTimeout(show_voc_gritter, 1000, false, "Lab Reset Done", false);
                     })
                     .fail(function(ret_val) {
                       $.gritter.removeAll();
                       setTimeout(show_voc_gritter, 1000, false, "Reset failed", true);
                     });
                  }

                  function resetclabs()
                  {
                    $.ajax({
                      url: "../util/vcput.php?a=vcGetLabInfo&stepid=201917&version=0&labworkdir=/mnt/data2/students/ccc_v1_w_NmY0_110384/asn201916_23/asn201917_1/work",
                    })
                     .done(function(data) {
                       try {
                         var result = JSON.parse(data);
                         if (result['status'] == 'Error') {
                           show_voc_gritter(false, "Could not get lab information: " + result['msg'], true);
                         }
                         else {
                           state = result['lab_state'];
                           if (state == "Ready") {
                             bootbox.dialog("The lab cannot be reset while it is running; please end the lab before proceeding.", 
                                            [{
                                              "label" : "Ok",
                                              "class" : "btn vocbtn-ac vocbtn-action",
                                            }]
                             );
                           }
                           else {
                             reallyResetClab();
                           }
                         }
                       } catch(err) {
                         show_voc_gritter(false, "Could not get lab1 information", true);
                       }
                     })
                     .fail(function(data, textStatus, jqXHR) {
                       show_voc_gritter(false, "Could not get lab2 information", true);
                     });
                    
                    return;
                  }

                  function confirmLabReset()
                  {
                    bootbox.dialog("The operation will remove all host-mounted writeable data stores (such as databases).<br><br>Press Ok to continue or Cancel to abort.", 
                               [
                                 {
                                   "label" : "Ok",
                                   "class" : "btn vocbtn-ac vocbtn-action",
                                   "callback": function() {
                                     resetclabs();
                                   }
                                 },
                                 {
                                   "label" : "Cancel",
                                   "class" : "btn vocbtn-ac vocbtn-status"
                                 }                                   
                               ]
                    );
                  }

        function useSlipDays() {
          var data = "";
          var urlval = "../util/vcput.php?m=editor&vocajax=1&stepid=" + 201917 + "&a=useMySlipDays&caller=ide&ajaxData=1&q1=asnid=" + 201916;
          $.ajax({
           type: "POST",
           url: urlval,
           data: data
          })
          .done(function(ret_val) {
                if (ret_val.indexOf('<ERROR:INVALID_SESSION>') !== -1) { // invalid session
                  refreshNewSessionPage();                                    
                }
                resp = jQuery.parseJSON(ret_val);
                if (resp.success !== 'true') {
                    show_voc_gritter(true, 'Failed: ' + resp.msg, true);
                } else {
                // success
                    if( (typeof resp.msg !== "undefined") && resp.msg ) {
                      show_voc_gritter(true, 'Failed: ' + resp.msg, true);
                    } else {
                      show_voc_gritter(false, resp.ret_arg1 + ' slip day(s) used', false);
                    }
                }       
                return false;   
            })
            .fail(function(ret_val) {
                    show_voc_gritter(false, ' Operation failed. Please try again', true);
                    return false;
            });
        }

        $('#useSlipDays').click(function() {
          var str = "Are you sure you want to use slip days for your submission?";
          bootbox.dialog(str, 
                         [{
                           "label" : "Yes",
                           "class" : "btn vocbtn-ac vocbtn-action",
                           "callback": function() {
                               useSlipDays();
                           }
                         }, 
                          {
                            "label" : "Cancel",
                            "class" : "btn vocbtn-ac vocbtn-status"
                          }]
          );
        });

        var wcClusterSshCmd = "";

        function showclusteract(display)
        {
                  var jqxhr = $.ajax('../util/vcput.php?a=clusterInfo'
                                   + '&courseid='+ 16642                                   + '&asnid='+ 201916                      
                                   + '&stepid='+ 201917                                   + '&userid='+ 1165740                                   + '&asnuserid='+ 0)
                                   .done(function(data, textStatus, jqXHR)
                                     {
                                       try {
					 var result = JSON.parse(data);
                                         if (result['status'] == 'Error')
                                         {
                                           show_voc_gritter(false, "Could not get cluster information: " + result['msg'], true);
                                         }
                                         else
                                         {
                                           var state_status = result['cluster_state'];
                                           if ((result['cluster_status'] !== undefined) && (result['cluster_status'] != 'Ok'))
                                           {
                                             state_status = state_status + ' (' + result['cluster_status'] + ')';
                                           }
                                           if ((result['cluster_ssh_cmd'] !== undefined) && (result['cluster_ssh_cmd'] != ''))
                                           {
                                             wcClusterSshCmd = result['cluster_ssh_cmd'];
                                           }
                                           if (display == true)
                                           {
                                             var target = document.getElementById("report_cluster_msg_box");
                                             target.innerHTML = "<strong>Status: </strong>" + state_status + "<br>"
                                                              + "<strong>Cluster IP: </strong>" + result['cluster_ip'] + "<br>"
                                                              + "<strong>SSH Cmd: </strong>" + wcClusterSshCmd;
                                             $('#modal-table-report-cluster').modal('show');
                                           }
				         }
                                       }
                                       catch(err)
                                       {
                                         show_voc_gritter(false, "Could not get cluster1 information", true);
                                       }
                                     })
                                   .fail(function(data, textStatus, jqXHR)
                                     {
                                       show_voc_gritter(false, "Could not get cluster2 information", true);
                                     });
                      
        }
                  
        $('#clusterStartOld').click(function()
        {
                    var jqxhr = $.ajax('../util/vcput.php?a=clusterStartOld'
                                       + '&courseid='+ 16642                                       + '&asnid='+ 201916                      
                                       + '&stepid='+ 201917                                       + '&userid='+ 1165740                                       + '&asnuserid='+ 1165740)
                                   .done(function(data, textStatus, jqXHR)
                                     {
                                       try {
					 var result = JSON.parse(data);
                                         if (result['status'] == 'Error')
                                         {
                                           show_voc_gritter(false, "Could not start cluster: " + result['msg'], true);
                                         }
                                         else
                                         {
                                           // ok - got some information back...
                                           msg = "Unknown";
                                           switch (result['state'])
                                           {
                                             case null:
                                             case "Unknown":
                                               msg = "Launching a new cluster; this operation will take a few minutes.";
                                               break;
                                             case "Launching":
                                               msg = "A new cluster is currently being launched.";
                                               break;
                                             case "Starting":
                                               msg = "A new cluster is currently being started.";
                                               break;
                                             case "Stopped":
                                             case "Stopping":
                                               msg = "The cluster is being restarted.";
                                               break;
                                             case "Running":
                                               msg = "The cluster is already running.";
                                               break;
                                             case "Failed":
                                               msg = "The cluster is in failed state; please contact Vocareum Technical Support to resolve this.";
                                               break;
                                           }
                                           bootbox.dialog(msg, 
                                                          [{
                                                            "label" : "Ok",
                                                            "class" : "btn vocbtn-ac vocbtn-action",
                                                          }]);
                                         }
				       }
                                       catch(err)
                                       {
                                         show_voc_gritter(false, "Starting of cluster1 failed", true);
                                       }
                                     })
                                   .fail(function(data, textStatus, jqXHR)
                                     {
                                       show_voc_gritter(false, "Starting of cluster2 failed", true);
                                     });
                      
                  }
                  );

                  var clusterState = "Unknown";
                  var clusterStatus = "Unknown";
                  var clusterExtIp = "Unknown";
                  var clusterLaunchTimeAvg = 0;
                  var clusterRestartTimeAvg = 0;
                  var clusterActionTimeElapsed = 0;

                  $('#clusterdropdown').on('click', function (event) {
                    $('#clusterState').html("<i class='icon-info-sign' style='margin-right:5px'></i>" + "State: Retrieving...");
                    getClusterState();
                  });
                  function getClusterState()
                  {
                    var jqxhr = $.ajax('../util/vcput.php?a=getClusterState'
                                       + '&courseid='+ 16642                                       + '&stepid='+ 201917                                       + '&userid='+ 1165740)
                                 .done(function(data, textStatus, jqXHR)
                                   {
                                     try 
                                     {
				       var result = JSON.parse(data);
                                       if (result['status'] == 'Error') 
                                       {
                                         show_voc_gritter(false, "Could not get cluster state: " + result['msg'], true);
                                       }
                                       else 
                                       {
                                         clusterState = result['cluster_state'];
                                         clusterStatus = result['cluster_status'];
                                         clusterExtIp = result['cluster_ext_ip'];

                                         clusterLaunchTimeAvg = result['cluster_launch_avg'];
                                         clusterRestartTimeAvg = result['cluster_restart_avg'];
                                         clusterActionTimeElapsed = result['cluster_action_time_elapsed'];

                                         showClusterState = clusterState;
                                         if (result['cluster_status'] == "Error") {
                                           showClusterState += " (Error)";
                                         }
                                         if (clusterState == "None") {
                                           showClusterState = 'Not launched';
                                         }
                                         else if (clusterState == "Ready") {
                                           wcClusterSshCmd = '';
                                           showclusteract(false);
                                         }
                                         $('#clusterState').html("<i class='icon-info-sign' style='margin-right:5px'></i>" + "State: " + showClusterState);
				       }
                                     }
                                     catch(err) 
                                     {
                                       show_voc_gritter(false, "Could not get cluster state1", true);
                                     }
                                   })
                                 .fail(function(data, textStatus, jqXHR)
                                   {
                                     show_voc_gritter(false, "Could not get cluster state2", true);
                                   });
  		  }	
                  
                  function changeClusterState(ctrlState)
                  {
                    var jqxhr = $.ajax('../util/vcput.php?a=changeClusterState'
                                     + '&courseid='+ 16642                                     + '&stepid='+ 201917                                     + '&userid='+ 1165740                                     + '&ctrlstate=' + ctrlState)
                                 .done(function(data, textStatus, jqXHR)
                                   {
                                     try 
                                     {
				       var result = JSON.parse(data);
                                       if (result['status'] == 'Error') 
                                       {
                                         show_voc_gritter(false, "Could not change cluster state: " + result['msg'], true);
                                       }
                                     }
                                     catch(err) 
                                     {
                                       show_voc_gritter(false, "Could not change cluster state1", true);
                                     }
                                   })
                                 .fail(function(data, textStatus, jqXHR)
                                   {
                                     show_voc_gritter(false, "Could not change cluster state2", true);
                                   });
                  }

                  $('#clusterStart').on('click', function (e) {
                    var str = "";
                    if (clusterState == "Ready") {
                      str = "The cluster is already in the Ready state; resetting the Idle timer...";
                      bootbox.dialog(str,
                                     [
                                       {
                                         "label" : "Ok",
                                         "class" : "btn vocbtn-ac vocbtn-action",
                                         "callback": function() {
                                           changeClusterState(4);
                                         }
                                       }
                                     ]);
                    } else {
                      str = "Are you sure you want to start the cluster?<br><br>Click Yes to continue or No to cancel.";
                      bootbox.dialog(str,
                                     [
                                       {
                                         "label" : "Yes",
                                         "class" : "btn vocbtn-ac vocbtn-action",
                                         "callback": function() {
                                                                                        changeClusterState(4);
                                                                                    }
                                       },
                                      {
                                        "label" : "No",
                                        "class" : "btn vocbtn-ac vocbtn-status"
                                      }
                                     ]);
                    }
                  });
                  $('#clusterStop').on('click', function (e) {
                    var str = "";

                    if (    (clusterState == "Ready")
                         || ((clusterState == "Starting" || clusterState == "Initializing") && (clusterStatus == "Error"))) {
                      str = "Are you sure you want to stop the cluster?<br><br>Click Yes to continue or No to cancel.";
                      bootbox.dialog(str,
                                     [
                                       {
                                         "label" : "Yes",
                                         "class" : "btn vocbtn-ac vocbtn-action",
                                         "callback": function() {
                                           changeClusterState(5);
                                         }
                                       },
                                      {
                                        "label" : "No",
                                        "class" : "btn vocbtn-ac vocbtn-status"
                                      }
                                     ]);
                    }
                    else {
                      str = "The cluster is neither running nor in an Error state.";
                      bootbox.dialog(str,
                                     [
                                       {
                                         "label" : "Ok",
                                         "class" : "btn vocbtn-ac vocbtn-action",
                                       }
                                     ]);
                    }
                  });

                  $('#clusterReInit').on('click', function (e) {
                    var str = "";
                    if ((clusterState != "Ready") && (clusterState != "Initializing")) {
                      str = "The cluster is not running.";
                      bootbox.dialog(str,
                                     [
                                       {
                                         "label" : "Ok",
                                         "class" : "btn vocbtn-ac vocbtn-action",
                                       }
                                     ]);
                    } else {
                      str = "The instructor's init script will be run on the cluster.<br><br><strong>Warning:</strong> This operation will <strong>re-format</strong> the namenode.<br><br>Click Ok to start the operation or Cancel to quit.";
                      bootbox.dialog(str,
                                     [
                                       {
                                         "label" : "Ok",
                                         "class" : "btn vocbtn-ac vocbtn-action",
                                         "callback": function() {
                                           changeClusterState(2);
                                         }
                                       },
                                      {
                                        "label" : "Cancel",
                                        "class" : "btn vocbtn-ac vocbtn-status"
                                      }
                                     ]);
                    }
                  });
                  $('#clusterTerminate').on('click', function (e) {
                    var str = "";
                    if (clusterState == "None") {
                      str = "The cluster is not running.";
                      bootbox.dialog(str,
                                     [
                                       {
                                         "label" : "Ok",
                                         "class" : "btn vocbtn-ac vocbtn-action",
                                       }
                                     ]);
                    } else {
                      str = "Are you sure you want to terminate the cluster?<br><br><strong>Warning:</strong> This operation <strong>cannot</strong> be undone.<br><br>Click Yes to continue or No to cancel.";
                      bootbox.dialog(str,
                                     [
                                       {
                                         "label" : "Yes",
                                         "class" : "btn vocbtn-ac vocbtn-action",
                                         "callback": function() {
                                           changeClusterState(6);
                                         }
                                       },
                                       {
                                         "label" : "No",
                                         "class" : "btn vocbtn-ac vocbtn-status"
                                       }
                                     ]);
                    }
                  });
                    
                  function showClouderaUI(type)
                  {
                    var str = "";
                    if (clusterState != 'Ready') {
                      str = "The cluster is not running at this time.";
                      bootbox.dialog(str,
                                     [
                                       {
                                         "label" : "Ok",
                                         "class" : "btn vocbtn-ac vocbtn-action",
                                       }
                                     ]);
                    } else {
                      if (clusterExtIp == "Unknown") {
                        str = "Could not determine cluster ip address";
                        bootbox.dialog(str,
                                       [
                                         {
                                           "label" : "Ok",
                                           "class" : "btn vocbtn-ac vocbtn-action",
                                         }
                                       ]);
                      } else {
                        if (type == "ssh") {
                          wcSendSshCmd();
                        }
                        else if (type == "manager") {
                          window.open("http://" + clusterExtIp + ":7180");
                        }
                        else {
                          window.open("http://" + clusterExtIp + ":8889");
                        }
                      }
                    }
                    $('#actionsdropdown_liactions2').parent().removeClass('open');
                  }

                  $(".clouderaButton").click(function() {
                    var $type = $(this).data("command");
                    showClouderaUI($type);
                  });


                  var last_saved_ide_indent = 4;
                  var last_saved_ide_t2s = "1";
                  
                  function saveIdeOptions()
                  {
                                        return;
                                        var ind = $("#ide_indent_size").find("option:selected").text();
                    var t2s = 0;
                    if ($('#ide_tab_to_spaces').is(':checked')) {
                      t2s = 1;
                    }
                    if ((ind != last_saved_ide_indent) || (t2s != last_saved_ide_t2s))
                    {
                      if (ind != last_saved_ide_indent)
                      {
                        last_saved_ide_indent = ind;
                        editor.setOption("indentUnit", last_saved_ide_indent);
                      }
                      if (t2s != last_saved_ide_t2s)
                      {
                        last_saved_ide_t2s = t2s;
                        if (t2s == 0)
                        {
                          editor.setOption("extraKeys", { Tab: vocDefaultTab });
                        }
                        else
                        {
                          editor.setOption("extraKeys", { Tab: vocBetterTab });
                        }
                      }
                      
                      var jqxhr = $.ajax('../util/vcput.php?a=saveIdeOptions'
                                       + '&stepid='+ 201917                                       + '&userid='+ 1165740                                       + '&indent_size=' + ind
                                       + '&tab_to_spaces=' + t2s)
                                   .done(function(data, textStatus, jqXHR)
                                     {
                                       try {
					 var result = JSON.parse(data);
                                         if (result['status'] == 'Error')
                                         {
                                           show_voc_gritter(false, "Saving of IDE data failed: " + result['msg'], true);
                                         }
				       } catch(err) {
                                         show_voc_gritter(false, "Saving of IDE data 1 failed", true);
                                       }
                                     })
                                   .fail(function(data, textStatus, jqXHR) {
                                     show_voc_gritter(false, "Saving of IDE data 2 failed", true);
                                   });
                      
                    }
                  }
                  
                  $('#actionsdropdown_liactions2').on('click', function (event) {
                    if ($('#actionsdropdown_liactions2').parent().hasClass('open'))
                    {
                      saveIdeOptions();
                    }
                    $(this).parent().toggleClass('open');
                  });

                  $('body').on('click', function (e) {
                    if (  !$('#liactions2').is(e.target)
                        && ($('#liactions2').has(e.target).length === 0)
                        && ($('.open').has(e.target).length === 0))
                    {
                      if ($('#actionsdropdown_liactions2').parent().hasClass('open'))
                      {
                        $('#actionsdropdown_liactions2').parent().removeClass('open');
                        saveIdeOptions();
                      }
                    }
                  });

                  $( document ).ready(function() {
                                          $('.linux_app').removeClass('disabled');
                                      });

                  function wcSetupTerminal()
                  {
                    // send the ssh cmd
                    // first check of terminal is still open
                    //     if yes - send cmd
                    //     if not - start it
                    var telement = document.getElementById('terminalIframe');
                    if (! telement.contentWindow.vocTerminalIsAvailable())
                    {
                      telement.contentWindow.vocStartTerminal();
                    }
                    else
                    {
                      telement.contentWindow.executeCommand(wcClusterSshCmd);
                    }
                  }

                  var wcShowClusterState = 'Unknown';
                  var wcClusterWaitAvgTime = 0;
                  var wcClusterTimeElapsed = 0;
                  var wcClusterShowProgressTimeout;

                  function wcPeriodicCheckClusterState()
                  {
                    getClusterState();
                    // has the state changed? the above function is non-blocking so we'll see it next time around
                    if (wcShowClusterState != showClusterState)
                    {
                      wcShowClusterState = showClusterState;
                      $('#waitCluster_header').text("Cluster: " + wcShowClusterState);
                      // state changed
                      // if Ready state, great
                      // otherwise it's Error state - what to do?? Show msg and "Ok" button
                      if (clusterStatus == 'Error')
                      {
                        $('#waitClusterMsg').text("There was an error starting your cluster; please terminate it and try again.");
                        $('#waitClusterButton').prop('disabled', false);
                      }
                      else
                      {
                        switch (clusterState)
                        {
                          case "Ready":
                            clearTimeout(wcClusterShowProgressTimeout);
                            wcSetProgressBar(100);
                            $('#waitClusterMsg').text("Your cluster is now ready for use.");
                            $('#waitClusterButton').prop('disabled', false);
                            wcSetupTerminal();
                            break;

                          case "Starting":
                          case "Initializing":
                          case "Launching":
                            setTimeout(wcPeriodicCheckClusterState, 3000);
                            break;

                          default:
                            $('#waitClusterMsg').text("The cluster is in an unexpected state; please terminate it and try again.");
                            clearTimeout(wcClusterShowProgressTimeout);
                            $('#waitClusterButton').prop('disabled', false);
                            break;
                        }
                      }
                    }
                    else
                    {
                      setTimeout(wcPeriodicCheckClusterState, 3000);
                    }
                  }

                  function wcSetProgressBar(val)
                  {
                    $progressBar = $('#waitClusterProgress');
                    $progressBar
                      .attr('data-percent', val + '%')
                      .find('.bar')
                      .css({
                        width: val + '%'
                      });
                  }

                  function wcPeriodicShowProgress()
                  {
                    wcClusterTimeElapsed += 0.5;
                    wcClusterWaitProgress = Math.floor(100 * wcClusterTimeElapsed / wcClusterWaitAvgTime);
                    if (wcClusterWaitProgress >= 100) { wcClusterWaitProgress = 99; } // 100 will be set when the state changes
                    wcSetProgressBar(wcClusterWaitProgress);
                    wcClusterShowProgressTimeout = setTimeout(wcPeriodicShowProgress, 500);
                  }
                  
                  function wcShowModal(clusterState)
                  {
                    // should we show the progress bar or the spinner?
                    wcClusterWaitAvgTime = 0;
                    switch (clusterState)
                    {
                      case "Terminated":
                      case "Launching":
                      case "None":
                        wcClusterWaitAvgTime = clusterLaunchTimeAvg;
                        break;

                      case "Stopped":
                      case "Starting":
                        wcClusterWaitAvgTime = clusterRestartTimeAvg;
                        break;
                    }
                    if (wcClusterWaitAvgTime > 0)
                    {
                      if (  (clusterState == "Launching")
                         || (clusterState == "Starting") )
                      {
                        if ((clusterActionTimeElapsed > 0) && (clusterActionTimeElapsed < wcClusterWaitAvgTime))
                        {
                          wcClusterTimeElapsed = clusterActionTimeElapsed;
                        }
                        else
                        {
                          wcClusterTimeElapsed = 0;
                        }
                      }
                      $('#waitClusterProgress').show();
                      $('#waitClusterSpinner').hide();
                      wcClusterShowProgressTimeout = setTimeout(wcPeriodicShowProgress, 500);
                    }
                    else
                    {
                      $('#waitClusterSpinner').show();
                      $('#waitClusterProgress').hide();
                    }

                    $('#waitCluster').modal();
                    // start the monitoring process
                    setTimeout(wcPeriodicCheckClusterState, 2000);
                  }
                  
                  function wcCheckForClusterState()
                  {
                    if (clusterState == "Unknown")
                    {
                      setTimeout(wcCheckForClusterState, 500);
                      return;
                    }
                    wcShowClusterState = showClusterState;
                    $('#waitCluster_header').text("Cluster: " + wcShowClusterState);

                    // If the state is Stopped/Terminated/Launching/Starting/Initializing, bring up modal
                    // If state is Stopped/Terminate, start cluster
                    switch (clusterState)
                    {
                      case "Stopped":
                      case "Terminated":
                      case "None":
                        changeClusterState(4);
                        if (clusterState == "Stopped")
                        {
                          stateStr = "Starting";
                        }
                        else
                        {
                          stateStr = "Launching";
                        }
                        $('#waitCluster_header').text("Cluster: " + stateStr);
                        wcShowModal(clusterState);
                        break;
                      case "Starting":
                      // case "Initializing":
                      case "Launching":
                        wcShowModal(clusterState);
                        break;
                    }
                  }

                  var wcSshWait = 0;
                  var wcClusterSshCmdWaitMax = 6;

                  function wcWaitForSshCmd()
                  {
                    while ((wcClusterSshCmd == '') && (wcSshWait < wcClusterSshCmdWaitMax))
                    {
                      wcSshWait += 1;
                      setTimeout(wcWaitForSshCmd, 500);
                    }
                    if (wcClusterSshCmd == '')
                    {
                      str = "Unable to determine cluster ssh cmd; please try again in a few seconds.";
                      bootbox.dialog(str,
                                     [
                                       {
                                         "label" : "Ok",
                                         "class" : "btn vocbtn-ac vocbtn-action",
                                       }
                                     ]);
                    }
                  }

                  function wcSendSshCmd()
                  {
                    if (wcClusterSshCmd != '')
                    {
                      document.getElementById('terminalIframe').contentWindow.executeCommand(wcClusterSshCmd);
                    }
                    else
                    {
                      wcSshWait = 0;
                      showclusteract(false);
                      setTimeout(wcWaitForSshCmd, 500);
                    }
                  }

                  function wcTestLater()
                  {
                    clearTimeout(wcClusterShowProgressTimeout);
                    wcSetProgressBar(100);
                    wcSendSshCmd();
                    $('#waitClusterMsg').text("Your cluster is now ready for use.");
                    $('#waitClusterButton').prop('disabled', false);
                  }
                  function wcTestSetupProgress()
                  {
                    // setup the variables and show the progress bar
                    wcClusterTimeElapsed = 0;
                    wcClusterWaitAvgTime = 8;
                    $('#waitClusterProgress').show();
                    wcClusterShowProgressTimeout = setTimeout(wcPeriodicShowProgress, 500);
                  }
                  function wcTest()
                  {
                    if (1)
                    {
                      $('#waitClusterSpinner').hide();
                      wcTestSetupProgress();
                    }
                    else
                    {
                      $('#waitClusterSpinner').show();
                      $('#waitClusterProgress').hide();
                    }
                    $('#waitCluster').modal();
                    setTimeout(wcTestLater, 20000);
                  }

                  function wcStartCluster()
                  {
                    // wcTest();
                    getClusterState();
                    setTimeout(wcCheckForClusterState, 500);                    
                  }

                  function wcAutoStartCluster()
                  {
                    // need to reset the modal elements first
                    $('#waitCluster_header').text("Cluster");
                    $('#waitClusterMsg').text("Your cluster is being started. This operation may take a few minutes.");
                    $('#waitClusterButton').prop('disabled', true);
                    wcClusterTimeElapsed = 0;
                    wcSetProgressBar(0);
                    setTimeout(wcStartCluster, 1000);
                  }

	          $(document).ready(function() {   
                                        
                  });
	</script>
	

	

<!-- PAGE CONTENT ENDS HERE -->
					</div><!--/row-->
				</div><!--/#page-content-->
		</div><!-- #main-content -->
	</div><!--/.fluid-container#main-container-->

<div id="push"></div>
</div>
	

		<!--[if lte IE 8]>
		  <script src="../shared/ace/assets/js/excanvas.min.js"></script>
		<![endif]-->		
		
		
		


		
		
		<script src="../shared/ace/assets/js/uncompressed2/ace-elements.js"></script>
       <!-- <script src="../shared/ace/assets/js/jquery.autosize-min.js"></script> -->
       <script src="../shared/ace/assets/js/jquery.colorbox-min.js"></script>
		
		<!-- functions start : remove unused ones -->

  <script type="text/javascript"> <!-- PCHECK -->


      function voc_set_tabindex() {
          console.log("voc_set_tabindex");
          $(".vocelem").each(function (i) { $(this).attr('tabindex', i + 1); console.log($(this)); });
      }

		$('#navbar-inner-div').off('keydown');
        $('#navbar-inner-div').attach_accesible_handler();

			$(function() {
			
					
			
				$('textarea[class*=autosize]').autosize({append: "\n"});
			
				$('#accordion2').on('hide', function (e) {
					$(e.target).prev().children(0).addClass('collapsed');
				})
				$('#accordion2').on('hidden', function (e) {
					$(e.target).prev().children(0).addClass('collapsed');
				})
				$('#accordion2').on('show', function (e) {
					$(e.target).prev().children(0).removeClass('collapsed');
				})
				$('#accordion2').on('shown', function (e) {
					$(e.target).prev().children(0).removeClass('collapsed');
				})

				$('#accordion-style').on('click', function(ev){
					var target = $('input', ev.target);
					var which = parseInt(target.val());
					if(which == 2) $('#accordion').addClass('accordion-style2');
					 else $('#accordion').removeClass('accordion-style2');
				});			
			
				var oldie = /msie\s*(8|7|6)/.test(navigator.userAgent.toLowerCase());
				$('.easy-pie-chart.percentage').each(function(){
					$(this).easyPieChart({
						barColor: $(this).data('color'),
						trackColor: '#EEEEEE',
						scaleColor: false,
						lineCap: 'butt',
						lineWidth: 8,
						animate: oldie ? false : 1000,
						size:75
					}).css('color', $(this).data('color'));
				});
			
				$('[data-rel=tooltip]').tooltip();
				$('[data-rel=popover]').popover({html:true});
			
			
				$('#gritter-regular').on(ace.click_event, function(){
					$.gritter.add({
						title: 'This is a regular notice!',
						text: 'This will fade out after a certain amount of time. Vivamus eget tincidunt velit. Cum sociis natoque penatibus et <a href="#" class="blue">magnis dis parturient</a> montes, nascetur ridiculus mus.',
						image: $assets+'/avatars/avatar1.png',
						sticky: false,
						time: '',
						class_name: (!$('#gritter-light').get(0).checked ? 'gritter-light' : '')
					});
			
					return false;
				});
			
				$('#gritter-sticky').on(ace.click_event, function(){
					var unique_id = $.gritter.add({
						title: 'This is a sticky notice!',
						text: 'Lorem ipsum dolor sit amet, consectetur adipiscing elit. Vivamus eget tincidunt velit. Cum sociis natoque penatibus et <a href="#" class="red">magnis dis parturient</a> montes, nascetur ridiculus mus.',
						image: $assets+'/avatars/avatar.png',
						sticky: true,
						time: '',
						class_name: 'gritter-info' + (!$('#gritter-light').get(0).checked ? ' gritter-light' : '')
					});
			
					return false;
				});
			
			
				$('#gritter-without-image').on(ace.click_event, function(){
					$.gritter.add({
						// (string | mandatory) the heading of the notification
						title: 'This is a notice without an image!',
						// (string | mandatory) the text inside the notification
						text: 'This will fade out after a certain amount of time. Vivamus eget tincidunt velit. Cum sociis natoque penatibus et <a href="#" class="orange">magnis dis parturient</a> montes, nascetur ridiculus mus.',
						class_name: 'gritter-success' + (!$('#gritter-light').get(0).checked ? ' gritter-light' : '')
					});
			
					return false;
				});
			
			
				$('#gritter-max3').on(ace.click_event, function(){
					$.gritter.add({
						title: 'This is a notice with a max of 3 on screen at one time!',
						text: 'This will fade out after a certain amount of time. Vivamus eget tincidunt velit. Cum sociis natoque penatibus et <a href="#" class="green">magnis dis parturient</a> montes, nascetur ridiculus mus.',
						image: $assets+'/avatars/avatar3.png',
						sticky: false,
						before_open: function(){
							if($('.gritter-item-wrapper').length >= 3)
							{
								return false;
							}
						},
						class_name: 'gritter-warning' + (!$('#gritter-light').get(0).checked ? ' gritter-light' : '')
					});
			
					return false;
				});
			
			
				$('#gritter-center').on(ace.click_event, function(){
					$.gritter.add({
						title: 'This is a centered notification',
						text: 'Just add a "gritter-center" class_name to your $.gritter.add or globally to $.gritter.options.class_name',
						class_name: 'gritter-info gritter-center' + (!$('#gritter-light').get(0).checked ? ' gritter-light' : '')
					});
			
					return false;
				});
				
				$('#gritter-error').on(ace.click_event, function(){
					$.gritter.add({
						title: 'This is a warning notification',
						text: 'Just add a "gritter-light" class_name to your $.gritter.add or globally to $.gritter.options.class_name',
						class_name: 'gritter-error' + (!$('#gritter-light').get(0).checked ? ' gritter-light' : '')
					});
			
					return false;
				});
					
			
				$("#gritter-remove").on(ace.click_event, function(){
					$.gritter.removeAll();
					return false;
				});
					
			
				///////
			
			
				$("#bootbox-regular").on(ace.click_event, function() {
					bootbox.prompt("What is your name?", function(result) {
						if (result === null) {
							//Example.show("Prompt dismissed");
						} else {
							//Example.show("Hi <b>"+result+"</b>");
						}
					});
				});
					
				$("#bootbox-confirm").on(ace.click_event, function() {
					bootbox.confirm("Are you sure?", function(result) {
						if(result) {
							bootbox.alert("You are sure!");
						}
					});
				});
					
				$("#bootbox-options").on(ace.click_event, function() {
					bootbox.dialog("I am a custom dialog with smaller buttons", [{
						"label" : "Success!",
						"class" : "btn-small btn-success",
						"callback": function() {
							//Example.show("great success");
						}
						}, {
						"label" : "Danger!",
						"class" : "btn-small btn-danger",
						"callback": function() {
							//Example.show("uh oh, look out!");
						}
						}, {
						"label" : "Click ME!",
						"class" : "btn-small btn-primary",
						"callback": function() {
							//Example.show("Primary button");
						}
						}, {
						"label" : "Just a button...",
						"class" : "btn-small"
						}]
					);
				});
			
			
			
				$('#spinner-opts small').css({display:'inline-block', width:'60px'})
			
				var slide_styles = ['', 'green','red','purple','orange', 'dark'];
				var ii = 0;
				$("#spinner-opts input[type=text]").each(function() {
					var $this = $(this);
					$this.hide().after('<span />');
					$this.next().addClass('ui-slider-small').
					addClass("inline ui-slider-"+slide_styles[ii++ % slide_styles.length]).
					css({'width':'125px'}).slider({
						value:parseInt($this.val()),
						range: "min",
						animate:true,
						min: parseInt($this.data('min')),
						max: parseInt($this.data('max')),
						step: parseFloat($this.data('step')),
						slide: function( event, ui ) {
							$this.attr('value', ui.value);
							spinner_update();
						}
					});
				});
			
			
			
			
			
				$.fn.spin = function(opts) {
					this.each(function() {
					  var $this = $(this),
						  data = $this.data();
			
					  if (data.spinner) {
						data.spinner.stop();
						delete data.spinner;
					  }
					  if (opts !== false) {
						data.spinner = new Spinner($.extend({color: $this.css('color')}, opts)).spin(this);
					  }
					});
					return this;
				};
			
				function spinner_update() {
					var opts = {};
					$('#spinner-opts input[type=text]').each(function() {
						opts[this.name] = parseFloat(this.value);
					});
					$('#spinner-preview').spin(opts);
				}
			
			
			
				$('#id-pills-stacked').removeAttr('checked').on('click', function(){
					$('.nav-pills').toggleClass('nav-stacked');
				});
			
			
			});
		</script>
		<!-- functions end -->
		

<!-- it might be used by both TA and grader so putting it under main.php -->
<script>
    function hideNamesOnDashboard() {
        $('.studentNameDashboard').addClass('hidden-1');
        $('.anonymousInfoDashboard').removeClass('hidden-1');
    }
    function showNamesOnDashboard() {
        $('.studentNameDashboard').removeClass('hidden-1');
        $('.anonymousInfoDashboard').addClass('hidden-1');
    }
    $('#showHideStudentNameDashboard').on('click', function() {
        if($(this).text() == 'Hide Names') {
            hideNamesOnDashboard();
            $(this).html('Show Names');
            hideNamesDashboard = 1;
        } else {
            showNamesOnDashboard();
            $(this).html('Hide Names');
            hideNamesDashboard = 0;
        }
    });
</script>

</body>	
</html>
